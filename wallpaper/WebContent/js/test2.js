(function(){document.cookie="js=1; path=/"})();function aaa(a){}$.G={gaq:function(b){var a=$.G.getUSERID(),c=a?"&userid="+a:"";typeof _gaq!="undefined"&&_gaq&&_gaq.push(["_trackPageview",b])},isRedirect:function(a){a=a.split("?")[0];return a.indexOf("/dj/go2/")>-1||a.indexOf("/redirect/")>-1},addfavorite:function(a,b){if(document.all){window.external.addFavorite(a,b);return true}else{if(window.sidebar&&window.sidebar.addPanel){window.sidebar.addPanel(b,a,"");return true}}return false},store:function(b){var a=$("#win-house");if(!a.length){a=$('<div id="win-house" class="h0"></div>').appendTo("body")}b&&a.append(b);return a},getToken:function(h){var d={},b="",g="",k="",c=$(window),a=c.data("verif")||[],j=$("input","#form-token");if(b=$.Bom.getCookie("csrftoken")){g="csrfmiddlewaretoken="+b;d.csrfmiddlewaretoken=b}else{if(j.length){b=j.val();d.csrfmiddlewaretoken=b;g=$.param(d)}}k='<input type="hidden" name="csrfmiddlewaretoken" value="'+b+'" />';if(a.length){g+="&ccode="+a[0];g+="&ctoken="+a[1];d.ccode=a[0];d.ctoken=a[1];k+='<input type="hidden" name="ccode" value="'+a[0]+'" /><input type="hidden" name="ctoken" value="'+a[1]+'" />'}return h?h==3?k:h==2?d:g:g},getTokenVal:function(){var a="",b=$("input","#form-token");if(a=$.Bom.getCookie("csrftoken")){}else{if(b.length){a=b.val()}}return a},setCookie:function(a,b){$.Bom.setSubCookie("sg",a,b)},setDayCookie:function(a,b){$.Bom.setSubCookie("sgd",a,b,{expires:1})},setWeekCookie:function(a,b){$.Bom.setSubCookie("sgw",a,b,{expires:7})},setMonthCookie:function(a,b){$.Bom.setSubCookie("sgm",a,b,{expires:30})},setYearCookie:function(a,b){$.Bom.setSubCookie("sgy",a,b,{expires:365})},getCookie:function(a){return $.Bom.getSubCookie("sg",a)},getDayCookie:function(a){return $.Bom.getSubCookie("sgd",a)},getWeekCookie:function(a){return $.Bom.getSubCookie("sgw",a)},getMonthCookie:function(a){return $.Bom.getSubCookie("sgm",a)},getYearCookie:function(a){return $.Bom.getSubCookie("sgy",a)},simpleMarqueeW:function(b,f,j,d){var k=$(b),c=k.find(":first-child"),h=k.parent();if(c.length){var f=f||4000,j=j||2,d=d||20,m,n=false,c,l;var a=function(){l=c.outerWidth(true);clearInterval(m);m=setInterval(g,d)};var g=function(){if(n){return}if(h.scrollLeft()+j>=l){clearInterval(m);k.append(c);h.scrollLeft(0);setTimeout(a,f)}else{h.scrollLeft(h.scrollLeft()+j)}};k.mouseover(function(){n=true});k.mouseout(function(){n=false});setTimeout(a,f)}},simpleMarqueeH:function(b,f,k,h,d){var j=$(b),c=j.find(":first-child");if(c.length){var f=f||4000,h=h||2,d=d||20,m,n=false,c,l;var a=function(){l=c.outerHeight(true);clearInterval(m);m=setInterval(g,d)};var g=function(){if(n){return}if(j.scrollTop()+h>=l){clearInterval(m);j.append(c);j.scrollTop(0);setTimeout(a,f)}else{j.scrollTop(j.scrollTop()+h)}};j.mouseover(function(){n=true});j.mouseout(function(){n=false});setTimeout(a,k)}},scrollToAnchor:function(c,g){var g=g||0,d=$(window),f=$("body,html"),b=$("a[name="+c+"]");if(c&&b.length){var a=b.offset().top-g||0;f.animate({scrollTop:a},200)}else{if(!!window.ActiveXObject&&!window.XMLHttpRequest){f.animate({scrollTop:a},200)}}},bindChecks:function(a,l,d,h,j,k){var g="input[type=checkbox],[checked],[checked=false]",m=$(a),c=$(l);function b(o){var p=[],n="",f=c.find(g);if(o.prop("checked")){f.each(function(t,s){var u=$(s),q=u.attr("value");u.prop("checked",true);if(q!==undefined){u.attr("dvalue",q)}p.push(u.attr("dvalue"))});m.prop("checked",true).add(f).addClass("checked")}else{f.each(function(s,q){$(q).prop("checked",false)});m.prop("checked",false).add(f).removeClass("checked")}n=$.trim(p.join(" ")).replace(/ /ig,",");m.attr("dvalue",n);m.filter("[type=checkbox]").val(n)}if(d){m.prop("checked",true)}else{if(d!==undefined){m.prop("checked",false)}else{if(m.attr("dchecked")=="true"){m.prop("checked",true)}else{if(!m.prop("checked")){m.prop("checked",false)}}}}b(m);if(m.attr("type")!="checkbox"){m.click(function(n){var f=true;if($.isFunction(h)){f=h()}if(f){m.prop("checked",!m.prop("checked"))}})}m.click(function(o){o.stopPropagation();var n=$(this),f=true;if($.isFunction(h)){f=h.call(this,m,c,g)}if(f){b(n);if($.isFunction(j)){j.call(this,m,c,g)}}});c.delegate(g,"click",function(t){t.stopPropagation();var s=$(this);if(s.attr("type")!="checkbox"){s.prop("checked",!s.prop("checked"))}var q=$.trim(m.attr("dvalue")),f=q?q.split(","):[],o="",n=s.attr("value");if(n!==undefined){s.attr("dvalue",n)}n=s.attr("dvalue");f=$(f).filter(function(v,u){return u!==n}).get();var p=s.prop("checked");if(p){f.push(n);s.addClass("checked")}else{s.removeClass("checked")}o=$.trim(f.join(" ")).replace(/ /ig,",");m.attr("dvalue",o);if(m.attr("type")=="checkbox"){m.val(o)}if($.isFunction(k)){k.call(this,m,c,g,p)}})},getCursorPosition:function(b){var a={text:"",start:0,end:0};if(b.setSelectionRange){a.start=b.selectionStart;a.end=b.selectionEnd;a.text=(a.start!=a.end)?b.value.substring(a.start,a.end):""}else{if(document.selection){var c,d=document.selection.createRange(),f=document.body.createTextRange();f.moveToElementText(b);a.text=d.text;a.bookmark=d.getBookmark();for(c=0;f.compareEndPoints("StartToStart",d)<0&&d.moveStart("character",-1)!==0;c++){if(b.value.charAt(c)=="\n"){c++}}a.start=c;a.end=a.text.length+a.start}}return a},setCursorPosition:function(b,a){if(!a){alert("You must get cursor position first.")}if(b.setSelectionRange){b.focus();b.setSelectionRange(a.start,a.end)}else{if(b.createTextRange){var c=b.createTextRange();if(b.value.length===a.start){c.collapse(false);c.select()}else{c.moveToBookmark(a.bookmark);c.select()}}}},getSelectedText:function(){var a=window,b=document;if(a.getSelection){return a.getSelection().toString()}else{if(b.getSelection){return b.getSelection()}else{if(b.selection){return b.selection.createRange().text}}}},blinkIt:function(d,b,a,f,c){c=c||1000;if(f===0){a();return}if($.isFunction(d)){d()}window.setTimeout(function(){$.G.blinkIt(b,d,a,--f,c)},c)},recurseDo:function(c,a,f,b,d){if(f==0){if($.isFunction(d)){d()}return}a=c.apply(null,a);if(a[0].length){setTimeout(function(){$.G.recurseDo(c,a,--f,b,d)},b)}else{if($.isFunction(d)){d()}}},getUSERID:function(){if(typeof USER!=="undefined"&&USER.ID){return USER.ID}else{return""}},isSTAFF:function(){if(typeof USER!=="undefined"&&USER.ISSTAFF){return true}else{return false}},dtImageTrans:function(d,f,a,g,k){var b=$.trim(d).replace(/^http(s)?:\/\//ig,""),b=b.split("/"),j=b[0],b=b[1];if(j.indexOf("duitang.com")==-1||!b||b!="uploads"&&b!="misc"){return d}if(f){a=a||0;g=g||0;k=k?"_"+k:"";return $.G.dtImageTrans(d).replace(/(\.[a-z_]+)$/ig,".thumb."+a+"_"+g+k+"$1")}else{return d.replace(/(?:\.thumb\.\w+|\.[a-z]+!\w+)(\.[a-z_]+)$/ig,"$1")}},getFitSize:function(d,c){if(d[0]&&d[1]&&c[0]){if(!c[1]){c[1]=c[0]}if(d[0]>c[0]||d[1]>c[1]){var g=d[0]/d[1],f=g>=c[0]/c[1];return f?[c[0],parseInt(c[0]/g)]:[parseInt(c[1]*g),c[1]]}}return d},setImgSize:function(b,a,f){b.onload=null;b.removeAttribute("width");b.removeAttribute("height");var c=b;if(c&&c.width&&c.height&&a){if(!f){f=a}if(c.width>a||c.height>f){var g=c.width/c.height,d=g>=a/f;b[d?"width":"height"]=d?a:f;if(document.all){b[d?"height":"width"]=(d?a:f)*(d?1/g:g)}}}b.style.visibility="visible"},setImgSizeByAncestor:function(f,b){f.onload=null;var d=$(f).parent(b)[0];if(d){var c=parseInt($(d).css("width"));c=c?c:d.offsetWidth;$.G.setImgSize(f,c)}},getNum:function(a){return a?+a.replace(/^[^\d]*(\d+\.?\d*).*/,"$1")||0:0},isFromDomain:function(a){a=a.replace("http://","").replace("https://","");a=a.split("?");a=a[0].split("/");a=a[0];for(var b=1;b<arguments.length;b++){if(a.indexOf(arguments[b])>-1){return true}}return false},trimLink:function(a,b){return a.replace(/(?:http(?:s)?:\/\/)(?:(?:[\w-]+\.)+[\w-]+)(?:\:\d+)?(?:\/[\w-\.\/%]*)?(?:[?][\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?(?:#[\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?/ig,function(c){return b?'<a href="'+c+'" target="_blank">'+c+"</a>":""})},isLink:function(a){return !!a.match(/^(?:http(?:s)?:\/\/)(?:(?:[\w-]+\.)+[\w-]+)(?:\:\d+)?(?:\/[^ \t\n]*)?$/ig)},removeParam:function(c,b){var d=new RegExp("\\?"+b+"(=[^&]*)?"),a=new RegExp("\\&"+b+"(=[^&]*)?");return c.replace(d,"?").replace(a,"").replace(/\?&/,"?").replace(/\?$/,"")},getParams:function(b){var a={},c,h,f,b=b.split("#")[0],j=b.indexOf("?"),l=j>-1?b.substr(j+1):"",g=l.split("&");for(f=0,len=g.length;f<len;f++){var k=g[f].indexOf("=");if(k>0){c=g[f].substring(0,k);h=g[f].substr(k+1);try{if(h.indexOf("+")>-1){h=h.replace(/\+/g," ")}a[c]=decodeURIComponent(h)}catch(d){}}}return a},addParam:function(b,f,d){var c=new RegExp("([&\\?])"+f+"=[^& ]*","g");b=b.replace(c,function(h,g){return g=="?"?"?":""});var a=b.indexOf("?");b+=(a>-1?a+1!=b.length?"&":"":"?")+f+"="+d;return b}};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,b){if(b==null){b=0}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a<this.length;a++){if(this[a]===c){return a}}return -1}}if(!String.prototype.lenB){String.prototype.lenB=function(){return this.replace(/[^\x00-\xff]/g,"**").length}}if(!String.prototype.leftB){String.prototype.leftB=function(h){var g=this,d=g.slice(0,h),f=d.replace(/[^\x00-\xff]/g,"**").length;if(f<=h){return d}f-=d.length;switch(f){case 0:return d;case h:return g.slice(0,h>>1);default:var b=h-f,a=g.slice(b,h),c=a.replace(/[\x00-\xff]/g,"").length;return c?g.slice(0,b)+a.leftB(c):g.slice(0,b)}}}if(!String.prototype.cut){String.prototype.cut=function(g,d,c){var f=this;r=c?f.substr(0,g):f.leftB(g);return r==f?r:r+(typeof d==="undefined"?"…":d)}}Date.prototype.pattern=function(a){var d={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours()%12==0?12:this.getHours()%12,"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};var c={"0":"\u65e5","1":"\u4e00","2":"\u4e8c","3":"\u4e09","4":"\u56db","5":"\u4e94","6":"\u516d"};if(/(y+)/.test(a)){a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}if(/(E+)/.test(a)){a=a.replace(RegExp.$1,((RegExp.$1.length>1)?(RegExp.$1.length>2?"\u661f\u671f":"\u5468"):"")+c[this.getDay()+""])}for(var b in d){if(new RegExp("("+b+")").test(a)){a=a.replace(RegExp.$1,(RegExp.$1.length==1)?(d[b]):(("00"+d[b]).substr((""+d[b]).length)))}}return a};function getToken(h){var d={},b="",g="",k="",c=$(window),a=c.data("verification")||[],j=$("input","#form-token");if(b=$.Bom.getCookie("csrftoken")){g="csrfmiddlewaretoken="+b;d.csrfmiddlewaretoken=b}else{if(j.length){b=j.val();d.csrfmiddlewaretoken=b;g=$.param(d)}}k='<input type="hidden" name="csrfmiddlewaretoken" value="'+b+'" />';if(b&&a.length){g+="&recaptcha_response_field="+a[0];g+="&recaptcha_challenge_field="+a[1];d.recaptcha_response_field=a[0];d.recaptcha_challenge_field=a[1];k+='<input type="hidden" name="recaptcha_response_field" value="'+a[0]+'" /><input type="hidden" name="recaptcha_challenge_field" value="'+a[1]+'" />'}return h?h==3?k:h==2?d:g:g}function getTokenVal(){var a="",b=$("input","#form-token");if(a=$.Bom.getCookie("csrftoken")){}else{if(b.length){a=b.val()}}return a}function mergeServerMessage(d){var c="";if($.isArray(d)){for(var b=0;b<d.length;b++){if($.isArray(d[b])){var a=d[b][1]||d[b][0]||"";c+=a+","}c+=d[b]+";"}c=c.slice(0,-1)}else{if($.isPlainObject(d)){for(e in d){c+=d[e].toString()+";"}c=c.slice(0,-1)}else{c=d}}c=c||"";return c.split(";")[0].split(",")[0]}$.ajaxSetup({type:"POST",timeout:20000,wrongmsg:function(b){var a=$.trim(mergeServerMessage(b.message));if(a&&SUGAR){SUGAR.PopOut.alert('<div class="prompt prompt-fail"><h3>'+a+"</h3></div>");$({}).delay(4000).queue(function(){SUGAR.PopOut.closeMask()})}},errormsg:function(){if(SUGAR){SUGAR.PopOut.alert('<div class="prompt prompt-fail"><h3>网络出问题了，请稍后再试</h3></div>');$({}).delay(2000).queue(function(){SUGAR.PopOut.closeMask()})}},success:function(f,b,a){if($.inArray("html",this.dataTypes)!=-1){return}var d=$.isPlainObject(f)?f:$.parseJSON(f);if(!d){$.G.gaq("/_trc/Error/ajax/json_parse_fail_"+this.url);return}if(d.success||d.status==1){if($.isFunction(this.mysuccess)){this.mysuccess(d,f)}}else{if($.isFunction(this.myfailure)){this.myfailure(d,f)}else{this.wrongmsg(d)}var c=mergeServerMessage(d.message);if(c){$.G.gaq("/_trc/Error/ajax/response_"+c+"_"+this.url)}}},error:function(b,a){$.G.gaq("/_trc/Error/ajax/status_"+a+"_"+(this.url?this.url:"null_"+window.location.href));if($.isFunction(this.myerror)){this.myerror(b,a)}}});(function(d){var b=d.event,a=b.special;function c(f){f.preventDefault();f.type="safeSubmit";if(b.handle){b.handle.apply(this,arguments)}else{if(b.dispatch){b.dispatch.apply(this,arguments)}}}b.special.safeSubmit={setup:function(){var f=this,g=d(f);b.add(f,"submit",c)},teardown:function(){var f=this,g=d(f);b.remove(f,"submit",c)}};d.fn.safeSubmit=function(h,g,f){if(typeof f!=="function"){f=g;g=h;h=null}f=f||function(){alert("请输入内容")};return arguments.length>0?this.unbind("safeSubmit").bind("safeSubmit",h,function(m){var k=this,n=d(k),l=d("input[type=text],textarea",n).not("[name=]").not("[data-optional]"),j=d("[type=submit]",n);safe=true;l.each(function(o,p){if(d.trim(d(p).val())===""&&safe){safe=false}});j.each(function(o,p){if(d(p).prop("disabled")&&safe){safe=false}});if(safe){g.call(this,arguments)}else{f.call(this,arguments)}}):this.trigger("safeSubmit")}})(jQuery);(function(a){a.fn.getFormAction=function(){var c=this,b=c[0];if(b&&b.tagName.toLowerCase()==="form"){return encodeURI(c.attr("action"))}return null};a.fn.paramForm=function(c){var d=a(this),b={};d.find("input,select,textarea").not("[type=submit]").filter("[name]").each(function(g,f){if((a(f).attr("type")==="checkbox"||a(f).attr("type")==="radio")&&a(f).prop("checked")===true||(a(f).attr("type")!=="checkbox"&&a(f).attr("type")!=="radio")){if(a.type(b[f.name])!=="undefined"){b[f.name]+=","+f.value}else{b[f.name]=f.value}}});if(a.isPlainObject(c)){a.extend(b,c)}return a.param(b)};a.fn.lengthLimit=function(b){this.filter("textarea,input[type=text]").each(function(){var f=a(this),d=f.attr("maxlength");var c=function(k){var j=k?k.keyCode:null;if(!j||j===8||j===13||j>36&&j<41){return}var h=this,g=h.value,l=g.cut(d,"");if(l.length<g.length){h.value=l;h.scrollTop=h.scrollHeight}};a(this).change(function(g){c.call(this,g)}).keyup(function(g){c.call(this,g)});c.apply(this)});return this};a.fn.inputTagLimit=function(b){var c=a.extend(true,{},{invalid:new RegExp("/"),taglen:20},b);this.filter("textarea,input[type=text]").each(function(){var h=a(this),g=c.taglen,d;var f=function(o){var n=o?o.keyCode:null;if(!n||n===8||n===13||n>36&&n<41){return}var l=h.val(),j=l.split(" "),j=j[j.length-1],k=l.substring(0,l.length-j.length);if(l[l.length-1]!=" "&&j&&j.lenB()>g){j=j.cut(g,"");l=k+j}h.val(l.replace(c.invalid,""));vl=h.val().length;a.G.setCursorPosition(h[0],{start:vl,end:vl})};a(this).change(function(j){f.call(this,j)}).keyup(function(j){f.call(this,j)});f.apply(this)});return this};a.fn.pagelimit=function(f){var g=a(this),d=f.length||0;function b(){var h=parseInt(this.value)||0;var j=d||0;if(h>j){this.value=j}else{if(h<1){this.value=1}else{this.value=h}}}function c(h){if(!(h.keyCode>=37&&h.keyCode<=40||h.keyCode==46||h.keyCode==8)){b.call(this)}}g.change(c).keyup(c);b.call(this)}})(jQuery);(function(a){function b(c,g){for(var d=0,f="";d<g;d++){f+=c}return f}a.fn.autogrow=function(c){this.filter("textarea").each(function(){this.timeoutId=null;var j=a(this),f=j.height();var h=a("<div></div>").css({position:"absolute",wordWrap:"break-word",top:0,left:-9999,display:"none",width:j.width(),fontSize:j.css("fontSize"),fontFamily:j.css("fontFamily"),lineHeight:j.css("lineHeight")}).appendTo(document.body);var g=function(){var k=this.value.replace(/</g,"<").replace(/>/g,">").replace(/&/g,"&").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(l){return b("&nbsp;",l.length-1)+" "});h.html(k);a(this).css("overflow","hidden").css("height",Math.max(h.height()+(parseInt(j.css("lineHeight"))||0),f))};var d=function(){clearTimeout(this.timeoutId);var k=this;this.timeoutId=setTimeout(function(){g.apply(k)},100)};a(this).change(g).keyup(d).keydown(d);g.apply(this)});return this}})(jQuery);(function(k){k.fn._fadeIn=k.fn.fadeIn;var c=function(){};var l=document.documentMode||0;var f=k.browser.msie&&((k.browser.version<8&&!l)||l<8);var g=k.browser.msie&&/MSIE 6.0/.test(navigator.userAgent)&&!l;k.blockUI=function(s){d(window,s)};k.unblockUI=function(s){j(window,s)};k.growlUI=function(w,u,v,s){var t=k('<div class="growlUI"></div>');if(w){t.append("<h1>"+w+"</h1>")}if(u){t.append("<h2>"+u+"</h2>")}if(v==undefined){v=3000}k.blockUI({message:t,fadeIn:700,fadeOut:1000,centerY:false,timeout:v,showOverlay:false,onUnblock:s,css:k.blockUI.defaults.growlCSS})};k.fn.block=function(s){return this.unblock({fadeOut:0}).each(function(){if(k.css(this,"position")=="static"){this.style.position="relative"}if(k.browser.msie){this.style.zoom=1}d(this,s)})};k.fn.unblock=function(s){return this.each(function(){j(this,s)})};k.blockUI.version=2.39;k.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:true,theme:false,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"none",backgroundColor:"#fff"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:0.2},growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:0.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:false,baseZ:1000,centerX:true,centerY:true,allowBodyStretch:true,bindEvents:true,constrainTabKey:true,fadeIn:200,fadeOut:200,timeout:0,showOverlay:true,focusInput:false,applyPlatformOpacityRules:true,onBlock:null,onUnblock:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg"};var b=null;var h=[];function d(w,I){var D=(w==window);var A=I&&I.message!==undefined?I.message:undefined;I=k.extend({},k.blockUI.defaults,I||{});I.overlayCSS=k.extend({},k.blockUI.defaults.overlayCSS,I.overlayCSS||{});var F=k.extend({},k.blockUI.defaults.css,I.css||{});var Q=k.extend({},k.blockUI.defaults.themedCSS,I.themedCSS||{});A=A===undefined?I.message:A;if(D&&b){j(window,{fadeOut:0})}if(A&&typeof A!="string"&&(A.parentNode||A.jquery)){var L=A.jquery?A[0]:A;var S={};k(w).data("blockUI.history",S);S.el=L;S.parent=L.parentNode;S.display=L.style.display;S.position=L.style.position;if(S.parent){S.parent.removeChild(L)}}k(w).data("blockUI.onUnblock",I.onUnblock);var E=I.baseZ;var P=(k.browser.msie||I.forceIframe)?k('<iframe class="blockUI" style="z-index:'+(E++)+';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+I.iframeSrc+'"></iframe>'):k('<div class="blockUI" style="display:none"></div>');var O=I.theme?k('<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+(E++)+';display:none"></div>'):k('<div class="blockUI blockOverlay" style="z-index:'+(E++)+';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>');var N,J;if(I.theme&&D){J='<div class="blockUI '+I.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(E+10)+';display:none;position:fixed"><div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(I.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>'}else{if(I.theme){J='<div class="blockUI '+I.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(E+10)+';display:none;position:absolute"><div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(I.title||"&nbsp;")+'</div><div class="ui-widget-content ui-dialog-content"></div></div>'}else{if(D){J='<div class="blockUI '+I.blockMsgClass+' blockPage" style="z-index:'+(E+10)+';display:none;position:fixed"></div>'}else{J='<div class="blockUI '+I.blockMsgClass+' blockElement" style="z-index:'+(E+10)+';display:none;position:absolute"></div>'}}}N=k(J);if(A){if(I.theme){N.css(Q);N.addClass("ui-widget-content")}else{N.css(F)}}if(!I.theme&&(!I.applyPlatformOpacityRules||!(k.browser.mozilla&&/Linux/.test(navigator.platform)))){O.css(I.overlayCSS)}O.css("position",D?"fixed":"absolute");if(k.browser.msie||I.forceIframe){P.css("opacity",0)}var C=[P,O,N],R=D?k("body"):k(w);k.each(C,function(){this.appendTo(R)});if(I.theme&&I.draggable&&k.fn.draggable){N.draggable({handle:".ui-dialog-titlebar",cancel:"li"})}var y=f&&(!k.boxModel||k("object,embed",D?null:w).length>0);if(g||y){if(D&&I.allowBodyStretch&&k.boxModel){k("html,body").css("height","100%")}if((g||!k.boxModel)&&!D){var H=o(w,"borderTopWidth"),M=o(w,"borderLeftWidth");var B=H?"(0 - "+H+")":0;var G=M?"(0 - "+M+")":0}k.each([P,O,N],function(t,V){var z=V[0].style;z.position="absolute";if(t<2){D?z.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.boxModel?0:"+I.quirksmodeOffsetHack+') + "px"'):z.setExpression("height",'this.parentNode.offsetHeight + "px"');D?z.setExpression("width",'jQuery.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):z.setExpression("width",'this.parentNode.offsetWidth + "px"');if(G){z.setExpression("left",G)}if(B){z.setExpression("top",B)}}else{if(I.centerY){if(D){z.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"')}z.marginTop=0}else{if(!I.centerY&&D){var T=(I.css&&I.css.top)?parseInt(I.css.top):0;var U="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+T+') + "px"';z.setExpression("top",U)}}}})}if(A){if(I.theme){N.find(".ui-widget-content").append(A)}else{N.append(A)}if(A.jquery||A.nodeType){k(A).show()}}if((k.browser.msie||I.forceIframe)&&I.showOverlay){P.show()}if(I.fadeIn){var K=I.onBlock?I.onBlock:c;var v=(I.showOverlay&&!A)?K:c;var u=A?K:c;if(I.showOverlay){O._fadeIn(I.fadeIn,v)}if(A){N._fadeIn(I.fadeIn,u)}}else{if(I.showOverlay){O.show()}if(A){N.show()}if(I.onBlock){I.onBlock()}}n(1,w,I);if(D){b=N[0];h=k(":input:enabled:visible",b).not("[type=file]");if(I.focusInput){setTimeout(q,20)}}else{a(N[0],I.centerX,I.centerY)}if(I.timeout){var x=setTimeout(function(){D?k.unblockUI(I):k(w).unblock(I)},I.timeout);k(w).data("blockUI.timeout",x)}}function j(v,w){var u=(v==window);var t=k(v);var x=t.data("blockUI.history");var y=t.data("blockUI.timeout");if(y){clearTimeout(y);t.removeData("blockUI.timeout")}w=k.extend({},k.blockUI.defaults,w||{});n(0,v,w);if(w.onUnblock===null){w.onUnblock=t.data("blockUI.onUnblock");t.removeData("blockUI.onUnblock")}var s;if(u){s=k("body").children().filter(".blockUI").add("body > .blockUI")}else{s=k(".blockUI",v)}if(u){b=h=null}if(w.fadeOut){s.fadeOut(w.fadeOut);setTimeout(function(){m(s,x,w,v)},w.fadeOut)}else{m(s,x,w,v)}}function m(s,v,u,t){s.each(function(w,x){if(this.parentNode){this.parentNode.removeChild(this)}});if(v&&v.el){v.el.style.display=v.display;v.el.style.position=v.position;if(v.parent){v.parent.appendChild(v.el)}k(t).removeData("blockUI.history")}if(typeof u.onUnblock=="function"){u.onUnblock(t,u)}}function n(s,w,x){var v=w==window,u=k(w);if(!s&&(v&&!b||!v&&!u.data("blockUI.isBlocked"))){return}if(!v){u.data("blockUI.isBlocked",s)}if(!x.bindEvents||(s&&!x.showOverlay)){return}var t="mousedown mouseup keydown keypress";s?k(document).bind(t,x,p):k(document).unbind(t,p)}function p(w){if(w.keyCode&&w.keyCode==9){if(b&&w.data.constrainTabKey){var u=h;var t=!w.shiftKey&&w.target===u[u.length-1];var s=w.shiftKey&&w.target===u[0];if(t||s){setTimeout(function(){q(s)},10);return false}}}var v=w.data;if(k(w.target).parents("div."+v.blockMsgClass).length>0){return true}return k(w.target).parents().children().filter("div.blockUI").length==0}function q(s){if(!h){return}var t=h[s===true?h.length-1:0];if(t){t.focus()}}function a(A,u,C){var B=A.parentNode,z=A.style;var v=((B.offsetWidth-A.offsetWidth)/2)-o(B,"borderLeftWidth");var w=((B.offsetHeight-A.offsetHeight)/2)-o(B,"borderTopWidth");if(u){z.left=v>0?(v+"px"):"0"}if(C){z.top=w>0?(w+"px"):"0"}}function o(s,t){return parseInt(k.css(s,t))||0}})(jQuery);SUGAR=function(){var g=$.browser.msie,f=$.browser.mozilla,d=g&&$.browser.version==="6.0",c=g&&$.browser.version==="7.0",a=g&&$.browser.version==="8.0",h=g&&$.browser.version==="9.0",b=$.browser.opera;return{PopOut:function(){return{fnCloseMask:function(){this.closeMask()},poptorylen:10,poptory:[],WD:[400,484,660],STR:['<a href="javascript:;" target="_self" class="abtn l" onclick="SUGAR.PopOut.closeMask();"><button type="button"><u>关闭</u></button></a>','<a href="javascript:;" target="_self" class="abtn l" onclick="SUGAR.PopOut.closeMask();"><button type="button"><u>取消</u></button></a>'],go:function(j){j=-j;if(j<0||j>9){return}var m=this,l;if(l=m.poptory[j]){var k=m.setCont([l.head,l.cont],l.n);m.blockPop(k,l.n,l.ht,l.opt)}},alert:function(o,l,k){var u=this,l=l==="s"?0:l==="m"?1:l==="l"?2:l,l=l||0,m=u.WD,j=$.G.store();if($.type(o)==="string"||$.type(o)==="number"){o=["",o+""]}o[0]=o[0];o[1]=o[1]||"";var p=$.type(o[1])==="string",s=u.setCont(o,l);var q=s.outerHeight();if(p){var t=s.html();s.remove();s='<div class="mask-body">'+t+"</div>"}else{u.poptory=[{head:o[0],cont:$(o[1]),n:l,ht:q,opt:k}].concat(u.poptory),u.poptory.length=u.poptorylen}u.blockPop(s,l,q,k)},setCont:function(l,q){var p=this,m=p.WD,k=$.G.store(),j,o;j=l[0]==null?"":$('<div class="tt-s"><span>'+l[0]+'</span><a class="mask-close" target="_self" href="javascript:;" onclick="SUGAR.PopOut.closeMask();">关闭</a></div>'),o=$('<div class="mask-body"></div>').css("width",m[q]).appendTo(k),o.append(j).append($('<div class="mask-cont"></div>').append(l[1]));return o},blockPop:function(u,m,t,l){var v=this,o=v.WD,k=$.G.store();l=$.extend({position:"fixed"},l);var p=false,s,j,q;if(l.position==="fixed"){p=true}else{s=$(window),j=s.scrollTop(),q=s.height()}$.blockUI({message:u,baseZ:9000,focusInput:(l&&l.focus!==undefined)?l.focus:true,onUnblock:function(){k.find(".mask-cont:empty").closest(".mask-body").remove();if(l&&$.isFunction(l.fn)){l.fn()}},css:{position:l.position,top:(p?"50%":j),left:"50%",textAlign:"left",marginLeft:-(o[m]/2),marginTop:p?-(t/2)-20:(t>=q?0:(q-t)/2),width:o[m],height:t,border:"none",background:"none"},fadeIn:$(".blockOverlay:visible").length?0:200});if(m<1){v.setOverLay()}},setOverLay:function(){if(d){return}var l=$("div.blockPage"),j=l.outerWidth(),n=l.outerHeight(),m=parseInt(l.css("marginTop")),k=parseInt(l.css("marginLeft"));$("div.blockOverlay").css({width:j+24,height:n+24,top:"50%",left:"50%",marginTop:m-12,marginLeft:k-12,"border-radius":"8px","-moz-border-radius":"8px","-webkit-border-radius":"8px"})},closeMask:function(){$.unblockUI()}}}()}}();(function(c){var b=c.browser.msie&&c.browser.version==="6.0",a=c.browser.opera;c.fn.sidepop=function(d){var g={_create:function(l,o){var n=o.id,k=l.$pop;var m=["none","none","none"];if(o.btnset==1){m[2]=""}else{if(o.btnset==2){m[0]=""}else{if(o.btnset==3){m[2]="";m[0]=""}}}l.$bar=c(o.btnset?['<div class="',o.btnClass.bars,'" ',o.seat?"":'style="display:none;"','><a  class="',o.btnClass.min,'" style="display:',m[0],'" href="javascript:;" target="_self">-</a><a class="',o.btnClass.max,'" style="display:',m[1],'" href="javascript:;" target="_self">+</a><a class="',o.btnClass.close,'" style="display:',m[2],'" href="javascript:;" target="_self">X</a></div>'].join(""):"");l.$cont=c('<div class="'+o.btnClass.cont+'"></div>');if(o.seat){l.$dom=c('<div class="'+n+'"></div>').append(l.$bar).append(l.$cont);l.$wrap=c("<div>").append(l.$dom);k.before(l.$wrap);l.$cont.append(k)}else{l.$dom=c('<div class="'+n+'"></div>').append(l.$bar).append(l.$cont.append(k)).appendTo(o.position)}},_feature:function(s,q){var n=s.$pop,v=s.$dom,u=s.$cont,l=c(window),m=l.width(),k=l.height(),o=l.scrollTop();s.size=[q.width===null?u.outerWidth():q.width,q.height===null?u.outerHeight():q.height];var t="absolute";if(q.seat){v.removeClass(".SG-posfollow");t="relative";var p=v.offset();s.inittop=p.top;s.initleft=p.left;s.$wrap.css({width:q.width,height:q.height})}else{if(!b&&q.isFixed==1){t="fixed"}}v.css({position:t,bottom:"auto",zIndex:q.zIndex,width:s.size[0],height:s.size[1]});s.bias=q.bias==="middle"?(k-s.size[1])/2:q.bias;s.departure=q.departure==="center"?(m-s.size[0])/2:q.departure;if(b&&q.baseline=="bottom"||a&&q.baseline=="bottom"){s.bias-=2}v.css({left:q.dockSide==="right"?"auto":s.departure,right:q.dockSide==="left"?"auto":s.departure});if(q.baseline=="bottom"){if(!q.seat&&!b&&q.isFixed==1){v.css({top:"auto",bottom:s.bias})}}else{if(q.baseline=="top"){if(!q.seat&&!b&&q.isFixed==1){v.css({bottom:"auto",top:s.bias})}}}},_bindBars:function(k,n){var m=k.$bar,l=n.btnClass;m.delegate("a","click",function(o){var p=c(this);if(p.hasClass(l.close)){g.close(k,n)}else{if(p.hasClass(l.show)){g.show(k,n)}else{if(p.hasClass(l.min)){g.min(k,n)}else{if(p.hasClass(l.max)){g.max(k,n)}}}}})},_scrollAnim:function(k,l){if(l.scroll===2){k.$dom.stop().css({opacity:0,top:g._getTop(k,l)[0]}).animate({opacity:1},l.fadeSpeed,function(){k.$bar.css("display","block")})}else{k.$dom.animate({top:g._getTop(k,l)[0]},l.floatSpeed,function(){k.$bar.css("display","block")})}},_eventScroll:function(l){var k=l.data.props,m=l.data.c;if(m.scroll===2){k.$dom.not(":animated").css({opacity:0})}if(c.isFunction(m.withScroll)){m.withScroll()}window.clearTimeout(k.scrollTimer);k.scrollTimer=window.setTimeout(function(){g._scrollAnim(k,m)},m.scrollDelayTime)},_scrollSeatAnim:function(m,n){var k=m.$dom,l=g._getTop(m,n);m.inittop=m.$wrap.offset().top;if(!m.$wrap.find(":first-child").length){m.$wrap.append(k)}if(l[0]<m.inittop){k.removeClass("SG-posfollow");k.css({position:"relative",top:0,left:0})}else{if(n.seatrange&&l[0]>m.inittop+n.seatrange-l[2]){k.css({position:"relative",top:n.seatrange-l[2]+n.seattop,left:0})}else{k.addClass("SG-posfollow");if(!b&&n.isFixed==1){k.css({position:"fixed",top:l[0]-l[1]+n.seattop,left:m.initleft})}else{k.appendTo(n.position).css({position:"absolute",top:l[0],left:m.initleft})}}}},_eventScrollSeat:function(l){var k=l.data.props,m=l.data.c;if(c.isFunction(m.withScroll)){m.withScroll()}g._scrollSeatAnim(k,m)},_bindScroll:function(k,l){if(!l.seat&&!b&&l.isFixed==1||l.scroll===0){k.$bar.css("display","block");return}else{if(l.seat){k.$bar.css("display","block");c(window).scroll({props:k,c:l},g._eventScrollSeat);g._scrollSeatAnim(k,l)}else{c(window).scroll({props:k,c:l},g._eventScroll);g._scrollAnim(k,l)}}},_unbindScroll:function(){c(window).unbind("scroll",g._eventScroll)},_getTop:function(p,o){var q=p.bias,t=p.$dom,s=t.outerHeight(false),m=c(window).width(),k=c(window).height(),n=c(window).scrollTop(),l=s+q-k;l=l<0?0:l;switch(o.baseline){case"top":return[n+q-l,n,s];case"bottom":return[n+k-s-q+l,n,s]}},close:function(m,o){var k=m.$dom,n=o.btnClass;k.css("display","none");g._unbindScroll(m,o);var l=n.close;c("."+l,k).removeClass(l).addClass(n.show);if(c.isFunction(o.fnAfterClose)){o.fnAfterClose.call(g,m,o)}},show:function(m,o){var k=m.$dom,n=o.btnClass;k.css("display","block");g._bindScroll(m,o);var l=n.show;c("."+l,k).removeClass(l).addClass(n.close)},min:function(m,p){var l=m.$dom,n=p.btnClass,o=p.expandDir==="left-right",k=o?{width:p.remainArea}:{height:p.remainArea};if(!o&&p.baseline==="bottom"){k.marginTop=m.size[1]-p.remainArea}l.animate(k,function(){c("."+n.min,l).css("display","none");c("."+n.max,l).css("display","inline")})},max:function(m,p){var l=m.$dom,n=p.btnClass,o=p.expandDir==="left-right",k=o?{width:m.size[0]}:{height:m.size[1]};if(!o&&p.baseline==="bottom"){k.marginTop=0}l.animate(k,function(){c("."+n.min,l).css("display","inline");c("."+n.max,l).css("display","none")})},_noop:c.noop};var j=c.extend(true,{},c.fn.sidepop.defaults,d);var f=c(this),h={};if(!f.length){return}h.$pop=f;g._create(h,j);g._feature(h,j);g._bindBars(h,j);g._bindScroll(h,j);if(c.isFunction(j.fnInitExe)){j.fnInitExe.call(g,h,j)}return this};c.fn.sidepop.defaults={id:"",position:"body",width:null,height:null,remainArea:25,initTop:null,btnClass:{min:"SG-sidemin",max:"SG-sidemax",close:"SG-sideclose",show:"SG-sideshow",bars:"SG-sidebar",cont:"SG-sidecont"},btnset:1,scroll:2,fnInitExe:null,fnAfterClose:null,dockSide:"left",departure:0,baseline:"bottom",seat:false,seatrange:null,seattop:0,withScroll:null,isFixed:0,bias:100,expandDir:"top-down",floatSpeed:150,fadeSpeed:250,scrollDelayTime:350,zIndex:1000}})(jQuery);(function(b){var a=1;b.fn.tippop=function(c){var d={_create:function(h,k){var j=k.id,g=h.$pop;h.$dom=b('<div class="'+j+' SG-tippop"></div>').append(b('<div class="pr"><u></u></div>')).append(g).appendTo("body");h.size=[k.width,k.height];a=Math.max(a,k.zIndex);h.$dom.css({position:"absolute",bottom:"auto",zIndex:k.zIndex,width:h.size[0],height:h.size[1],display:"none"})},_bind:function(k,l){var g=k.$dom,h=b(l.triger),j=l.delegateSelector;b(".SG-close",g).click(function(m){m.preventDefault();d.close(k)});b(".SG-close-e",g).click(function(m){m.preventDefault();d.close(k);h.unbind(l.eventType);g.remove()});g.bind("mouseenter",function(m){clearTimeout(g.data("timer"));g.css({zIndex:++a})}).bind("mouseleave",function(m){g.data("timer",setTimeout(function(){d.close(k)},l.holdon))});if(j===null){h.bind(l.eventType,function(m){d._show.call(this,k,l)}).bind("mouseleave",function(){g.mouseleave()})}else{h.delegate(j,l.eventType,function(m){d._show.call(this,k,l)}).delegate(j,"mouseleave",function(){g.mouseleave()})}},close:function(g,h){g.$dom.css("display","none")},_show:function(t,q){var m=t.$pop,w=t.$dom,j=w.outerWidth(),v=w.outerHeight(),g=b(document).width(),s=b(document).height(),p=this===d||q.triger0?b(q.triger):b(this),u=p.offset(),n=p.outerWidth(),h=p.outerHeight(),k;clearTimeout(w.data("timer"));t.offset=[u.left+q.biasX,u.top+q.biasY];var o=t.offset[0],l=t.offset[1];t.offset[0]=o+j>g?g-j-20:o;t.offset[1]=l+v>s?s-v-20:l;w.css({left:t.offset[0],top:t.offset[1],zIndex:++a,display:"block"})},_noop:b.noop};var f=b.extend(true,{},b.fn.tippop.defaults,c);return this.each(function(){var g=b(this),h={};if(!g.data("tippop")){h.$pop=g;d._create(h,f);d._bind(h,f);if(f.loadShow){d._show(h,f)}if(b.isFunction(f.fnInitExe)){f.fnInitExe.call(d,h,f)}g.data("tippop",true)}}).closest("."+f.id)};b.fn.tippop.defaults={id:"",triger:null,triger0:false,eventType:"mouseover",holdon:1000,delegateSelector:null,width:"auto",height:"auto",biasX:0,biasY:0,loadShow:false,fnInitExe:null,zIndex:3000}})(jQuery);(function(){$.SGAlert=$.SGAlert||{};$.SGAlert.show=function(c,g,j,d){var j=j||".mask-body:visible";var a=$(j);var d=d||{visibility:"hidden",position:"absolute",zIndex:999999999,width:"auto",padding:"4px 12px",margin:"4px 0 0",lineHeight:"21px",fontSize:"12px",background:"#4c4c4c",borderRadius:"4px",color:"#fff"};if(!a.length){a=$("body")}var k=parseInt(a.css("width"))||a.outerWidth();var b=a.find(".SGAlert-holder");if(!b.length){b=$('<div class="SGAlert-holder"></div>').appendTo(a)}b.css(d).html(c);window.clearTimeout(b.data("timer"));var l=b.outerWidth(),f=b.outerHeight(true),h=200;b.css({top:-f,visibility:"visible",left:(k-l)/2}).animate({top:0,opacity:1},h);if(g&&g>0){b.data("timer",window.setTimeout(function(){b.animate({top:-f,opacity:0},h,function(){b.css("visibility","hidden")})},g))}};$.SGAlert.clean=function(){$(".SGAlert-holder").remove()}})();function setIptFocus(a){function b(d){var c=d.target;c.style.color="#333";c.value="";$(a).unbind("focus",arguments.callee)}$(a).focus(b)}function setLabelIptFocus(c,b){function a(){if($.trim($(c).val())!==""){clearTimeout($(b).data("timer"));$(b).css("display","none")}else{$(b).data("timer",setTimeout(function(){$(b).css("display","block")},150))}}$(c).bind("blur",function(d){a()}).bind("focus click",function(){clearTimeout($(b).data("timer"));$(b).css("display","none")});a()}function resetTags(a,j){var h=$("a",a),g=[];for(var d=0;d<h.length&&d<12;d++){var b=$.trim(h[d].innerHTML);g.push(b)}var c=$(j).val(),f=false;h.each(function(m,o){var l=$(o),k=$.trim(l.text()),n=$.inArray(k,g)!=-1;if((" "+c+" ").match(new RegExp("\\s"+k+"\\s","ig"))){$(o).addClass("added");if(!f&&n){f=true}}else{$(o).removeClass("added")}});if(f){h.each(function(m,o){var l=$(o),k=$.trim(l.text()),n=$.inArray(k,g)!=-1;if(f&&n){$(o).addClass("added")}})}}function tagSelectBind(a,b,c){$(a).delegate("a","click",function(m){m.preventDefault();m.stopPropagation();var k=$(this),h=$.trim(k.text()),n=k.parent().find("a"),d=[];for(var g=0;g<n.length&&g<12;g++){var p=$.trim(n[g].innerHTML);d.push(p)}if(!k.hasClass("added")){var f=$(b),q=$.trim(f.val()),o=$.trim(q.replace(/,/ig," ").replace(/\s{2,}/ig," ")),j=o.split(" "),l=j.length;if(l>=c){alert("最多只能添加"+c+"个标签哦");return false}f.focus();f.val(f.val()+(q==""||q.charAt(q.length-1)==" "?k.text()+" ":" "+k.text()+" "));k.addClass("added")}if($.inArray(h,d)!=-1){n.each(function(s,u){var t=$(u);if($.inArray($.trim(t.text()),d)!=-1){t.addClass("added")}})}});$(b).keyup(function(j){j.stopPropagation();var g=$.trim(this.value),h=$.trim(g.replace(/,/ig," ").replace(/\s{2,}/ig," ")),f=h.split(" "),d=f.length;if(d>c){this.value=g.replace(/([ ,])+?[^ ,]*$/ig,function(l,k){return k});j.preventDefault();return false}resetTags(a,this)})}function setTagsHTML(b,a){var c=[];if($.isArray(a)){$(a).each(function(f,d){if(d!=="|"){c.push('<a href="#"><i>'+d+"</i></a>")}});$(b).find("a").remove();$(b).append(c.slice(0,20).join(""))}}function setDefaultTags(p){var l=$("a",p),g=$.G.getMonthCookie("usedtags"),m=g?g.split(";"):[],o=l.length,h=o>12?12:o,a;var b=[];for(var f=0;f<h;f++){var n=$.trim($(l[f]).text());b.push(n)}b.push("|");for(var d=0,c=m.length;d<c;d++){if($.inArray(m[d],b)===-1){b.push(m[d])}}if(o>12){for(var f=12;f<o;f++){var n=$.trim($(l[f]).text());if(b.length<21&&$.inArray(n,b)===-1){b.push(n)}}}$.G.setMonthCookie("usedtags",b.join(";"));setTagsHTML(p,b)}function setUsedTags(c,h){var j=$(h);var g=$.trim(j.val());if(g){var b=$.trim(g.replace(/\s{2,}/g," ")).split(" "),f=$.G.getMonthCookie("usedtags"),a=f.split(";"),d=$.inArray("|",a);$(b).each(function(l,k){if($.inArray(k,a)===-1){a=$.grep(a,function(m){return m!==k&&$.trim(m)!==""});a=a.slice(0,d).concat([k],a.slice(d))}});a=a.slice(0,20);$.G.setMonthCookie("usedtags",a.join(";"));setTagsHTML(c,a)}}function showSelectTags(a,d,c){var f;function g(){if($(a).data("mouselock")){return}window.clearTimeout(f);if($.isFunction(c)){c(a,d,1)}else{$(a).css("display","block")}}function b(){if($(a).data("mouselock")){return}window.clearTimeout(f);f=window.setTimeout(function(){if($.isFunction(c)){c(a,d)}else{$(a).css("display","none")}},200)}$(d).bind("click focus mouseenter",g).blur(b);$(a).bind("mouseenter",g);$(a).bind("mouseleave",b)}function keyupLenLimitForU(b,x,v,t,k){if(!b||typeof b.value=="undefined"){return}var n=/(?:http(?:s)?:\/\/)(?:(?:[\w-]+\.)+[\w-]+)(?:\:\d+)?(?:\/[\w-\.\/%]*)?(?:[?][\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?(?:#[\w-\.\/%!*\(\);\:@&=+$,\[\]]*)?(?=\s)/g,w=[],a=[],x=x||300,v=!!v,k=$(k),s=0,q=b.value.replace(n,function(l,j,o){w.push(l);a.push(j-s);s+=l.length;return""}),f,m=false;if(v){f=x-q.length}else{f=Math.floor((2*x-q.lenB())/2)}f-=w.length*8;if(f<0){if(v&&t){q=q.substr(0,x)}else{if(t){q=q.cut(x*2,"")}}var d=[];for(var h=0,g=0,c=w.length;h<c&&h<8;h++){d.push(q.slice(g,a[h]));d.push(w[h]);g=a[h]}d.push(q.slice(g,q.length));b.value=d.join("");$(b).scrollTop(1000);m=true}k.html(t&&f<0?0:f);return m}(function(){if(SUGAR&&SUGAR.PopOut){var d=$.browser.msie,c=d&&$.browser.version==="6.0",b=d&&$.browser.version==="7.0",a=d&&$.browser.version==="8.0",f=d&&$.browser.version==="9.0";$.extend(SUGAR.PopOut,{login:function(g){var m=this;var n=$("#poplogin"),j=$.G.store(),h=g;if(!h){h=location.pathname+location.search+location.hash}n.find("[name=next]").val(h);if(!j.length){j=$('<div id="win-house" class="h0"></div>').appendTo("body")}if(!n.length){n=$('<div id="poplogin" class="win-wraper clr"><div class="login clr"><div class="cont"><form method="POST"  action="/login/?next='+h+'" method="POST" ><div class="unme cnt-i clr"><label for="username"></label><i>用户名/邮箱</i><input type="text" id="p-username" name="login_name" placeholder="用户名/邮箱" /></div><div class="pswd cnt-i clr"><label for="password"></label><i>密码</i><input type="password" id="p-password" name="pswd" placeholder="密码" /></div><div class="submit clr"><a class="abtn l" href="javascript:;" onmousedown="$.G.gaq(\'/_trc/Login/pop/direct\');"><button id="loginbtn" type="submit"><u>登录</u></button></a><div class="u-chk clr"><input class="chk" type="checkbox" name="remember" id="poplogin-rem" value="记住我" checked /><label for="poplogin-rem" >记住我</label><u>|&nbsp;</u><a href="/getpasswd/">忘记密码？</a></div></div></form><div class="toreg clr"><a href="/reg/" onmousedown="$.G.gaq(\'/_trc/Login/pop/reg\');">注册</a></div></div><div class="sites"><p>使用合作网站账号登录：</p><div class="clr"><a class="qqsite" href="/connect/qq/?next='+h+'" onmousedown="$.G.gaq(\'/_trc/Login/pop/connect_qq\');">QQ</a><a class="weibo" href="/connect/sina/?next='+h+'" onmousedown="$.G.gaq(\'/_trc/Login/pop/connect_sina\');">新浪微博</a><a class="douban" href="/connect/douban/?next='+h+'" onmousedown="$.G.gaq(\'/_trc/Login/pop/connect_douban\');">豆瓣</a><a class="qqweib" href="/connect/qweibo/?next='+h+'" onmousedown="$.G.gaq(\'/_trc/Login/pop/connect_qweibo\');">腾讯微博</a><a class="taobao" href="/connect/taobao/?next='+h+'" onmousedown="$.G.gaq(\'/_trc/Login/pop/connect_taobao\');">淘宝</a></div></div></div></div>');j.append(n)}var k=$("#p-username, #p-password");if(k.length&&typeof k.get(0).placeholder=="undefined"){var l=$("#poplogin").find("i");l.css("display","block");l.click(function(o){$(this).css("display","none");$(this).siblings("input").focus()});k.focusin(function(o){$(this).siblings("i").css("display","none")});k.focusout(function(o){if($.trim(this.value)==""){$(this).siblings("i").css("display","block")}});if(a){k.keydown(function(o){if(o.keyCode==13&&$.trim($("#p-username").val())&&$.trim($("#p-password").val())){o.preventDefault();o.stopPropagation();n.find("form").submit()}})}}m.alert(["登录堆糖网",n,""],2);$({}).delay(100).queue(function(){var o;if((o=$("#p-username")[0])){o.focus()}})}})}})();function mblogTagsInit(h){var c=$(h[0]),k=$(h[1]),l=$(h[2]),m=$(h[3]),g=$(h[4]),b=$(h[5]),a=h[6],j,d;g.lengthLimit();var f={tags:{user_tags:[],def_tags:[],used_tags:[],added_tags:[]},_init:function(){for(var q in this.tags){this.tags[q]=[]}var o=c.find(".added-tag"),s;for(var q=0,n=o.length,p;q<n;q++){p=$.trim($(o[q]).text());p&&this.tags.user_tags.push(p)}if($.fn.comtags){m.append(function(){var v="",t=$.fn.comtags.tags;for(var u=0;u<t.length;u++){v+='<a href="#">'+t[u]+"</a>"}return v})}this._initSysTags();this._flashHotTagHtml()},_initSysTags:function(){var u=$.G.getMonthCookie("usedtags"),s=u?u.split(";"):[],v=m.find("a"),x=v.length,p=x>=12?12:x,n;for(var q=0,w;q<p;q++){w=$.trim($(v[q]).text());w&&this.tags.def_tags.push(w)}for(var q=0,o=s.length,w;q<o;q++){w=$.trim(s[q]);if(w&&$.inArray(w,this.tags.def_tags)===-1&&w!=="|"){this.tags.used_tags.push(w)}}if(x>12){for(var q=12,w;q<x;q++){w=$.trim($(v[q]).text());if(this.tags.used_tags.length>8){break}if($.inArray(w,this.tags.used_tags)===-1){this.tags.used_tags.push(w)}}}this._saveToCookie()},_saveToCookie:function(){$.G.setMonthCookie("usedtags",this.tags.def_tags.join(";")+";|;"+this.tags.used_tags.slice(0,20).join(";"))},_escapeHTML:function(o){var n={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return o.replace(/[&<>"'\/]/g,function(p){return n[p]})},_flashHotTagHtml:function(){var v=this.tags.def_tags,n=this.tags.used_tags,s=this._getCurTags(),w=[],u=false;for(var q=0,o=s.length,x;q<o;q++){x=s[q];if($.inArray(x,v)>-1){u=true;break}}for(var q=0,o=v.length,x,p;q<o;q++){p="";x=v[q];p+='<a class="def-tags';if($.inArray(x,s)>-1){p+=" locked"}if(u){p+=" locked"}p+='" href="javascript:;"><i>'+this._escapeHTML(x)+"</i></a>";w.push(p)}for(var q=0,o=n.length,x;q<o;q++){x=n[q];if($.inArray(x,s)>-1){w.push('<a class="user-tags locked" href="javascript:;"><i>'+this._escapeHTML(x)+"</i></a>")}else{w.push('<a class="user-tags" href="javascript:;"><i>'+this._escapeHTML(x)+"</i></a>")}}m.find("a").remove();m.append(w.slice(0,20).join(""))},_removeFromSelect:function(n){var p=c.find(".added-tag"),s=this.tags.user_tags,q=this.tags.added_tags,t=this.tags.used_tags,o=$.inArray(n,s);if(o!==-1){this.tags.user_tags=s.slice(0,o).concat(s.slice(o+1,s.length))}o=$.inArray(n,q);if(o!==-1){this.tags.added_tags=q.slice(0,o).concat(q.slice(o+1,q.length));tf=false}this._flashHotTagHtml();c.find(".added-tag").each(function(w,u){if($.trim($(u).text())===n){$(u).remove()}});c.closest("div").find(".tag-tips").removeClass("red")},_flashPageCnt:function(){if(l.length){var o=this._getCurTags(),s=[],u;for(var q=0,p,n=o.length;q<n;q++){s.push('<a class="mytag" href="'+a+o[q]+'/"><i>'+this._escapeHTML(o[q])+"</i></a>")}l.find("a").not("#addnewtag").remove();l.prepend(s.join(""))}g.focus()},_remove:function(n){if(k.hasClass("form-locked")){return}k.addClass("form-locked");if(!n){n=$.trim(g.prev().text())}if(!n){return}if($.inArray(n,this.tags.user_tags)===-1){this._removeFromSelect(n);k.removeClass("form-locked");return}if(k.length){c.find(".abtn").addClass("abtn-no");$.ajax({url:k.getFormAction(),data:k.paramForm(getToken(2))+"&tags="+encodeURIComponent(n),mysuccess:function(o,p){f._removeFromSelect(n);f._flashPageCnt()}}).always(function(){k.removeClass("form-locked");c.find(".abtn").removeClass("abtn-no")})}else{k.removeClass("form-locked");f._removeFromSelect(n);f._flashPageCnt()}},_add:function(u){var q={},p=u.split(","),w=[],v=this.tags.user_tags.concat(this.tags.added_tags),n;g.val("");for(var s=0,x,o=p.length;s<o;s++){x=p[s];if(v.length>=5){c.closest("div").find(".tag-tips").addClass("red");return}if(x&&$.inArray(x,this.tags.user_tags)===-1&&$.inArray(x,this.tags.added_tags)===-1){v.push(x);this.tags.added_tags.push(x);g.before('<a class="added-tag" href="javascript:;"><i>'+this._escapeHTML(x)+"</i></a>");if($.inArray(x,this.tags.used_tags)===-1&&$.inArray(x,this.tags.def_tags)===-1){this.tags.used_tags.unshift(x)}}}this._flashHotTagHtml();this._saveToCookie()},_checkLength:function(){return c.find(".added-tag").length},_getCurTags:function(){return this.tags.user_tags.concat(this.tags.added_tags)},_beforeSubmit:function(){var n=$.trim(g.val());if(n.length){this._add(n)}},_afterSubmit:function(){this.tags.user_tags=this._getCurTags();this.tags.added_tags=[]}};b.bind("click",function(n){f.tags.added_tags=[];m.find(".locked").removeClass("locked")});m.delegate("a","click",function(o){var p=$(this),n=$.trim(p.text());if(p.hasClass("locked")){return}if(f._checkLength()>=5){c.closest("div").find(".tag-tips").addClass("red");return}if(p.hasClass("def-tags")){m.find(".def-tags").each(function(){if(!$(this).hasClass("locked")){$(this).addClass("locked")}})}else{p.addClass("locked")}f._add(n);g.focus()});g.bind("keyup",function(q){var s=$(this),o=s.val().slice(-1);if((q.keyCode===188&&!q.shiftKey)||q.keyCode===13||(q.keyCode===229&&o==="，")){var n=s.val(),p=n.length;p=q.keyCode===13?p:p-1;n=n.substr(0,p),n=n.replace(/,/ig," ");s.val(n);n.length&&f._add(n)}});g.bind("keydown",function(o){var p=$(this),n=$.trim(p.val());if(o.keyCode===8&&!n&&f._getCurTags().length){f._remove()}if(o.keyCode===13){o.preventDefault();return}});c.click(function(n){g.focus()});c.delegate("a","click",function(n){f._remove($.trim($(this).text()))});c.submit(function(q){var n=$(this),p=n.find(".abtn"),o=p.find("[type=submit]");var s;f._beforeSubmit();s=f.tags.added_tags.join(",");if(!s){f._flashPageCnt();SUGAR.PopOut.closeMask(0);return}if(p.hasClass("abtn-no")){return}p.addClass("abtn-no");n.find("input[name=tags]").val(s);$.ajax({url:n.getFormAction(),data:n.paramForm(getToken(2)),mysuccess:function(t,u){SUGAR.PopOut.closeMask(0);f._flashPageCnt();f._afterSubmit()}}).always(function(){p.removeClass("abtn-no")})});f._init()}(function(a){a.fn.comtags={tags:["家居","设计","插画","电影","旅行","手工","女装","男装","配饰","美食","摄影","艺术","封面","动漫","怀旧","街拍","小孩","宠物","植物","人物"]}})(jQuery);function taobaoThumbPic(b,a,c){if(/^http:\/\/[^\/]*(alicdn|taobaocdn|aliimg)\.com/.test(b)){var b=b.replace(/_\.webp\w{0,10}$/ig,"");b=b.replace(/_\d+x[\da-z]{1,10}\.jpg$/ig,"");if(a){return b+"_"+a+"x"+c+".jpg"}else{return b}}else{return b}}(function(){$.SGColl=function(){var h,l,u,n,x,f,E,q,d,y,b,o,t,k,g,s,B,v,w,c,m,A,p,D={upload:"上传图片",fetch:"抓取网页图片"},C=[],z,a=4000,j;return{type:"upload",init:function(H,G){var I=this;if(!$.G.getUSERID()){SUGAR.PopOut.login();return}if(typeof H!=="function"){G=H;H=$.noop}A=H;if(G&&$.isPlainObject(G)){p=$.extend({},G)}if(p&&p.type){I.type=p.type}if(!I.inited){I.inited=true;l=$("#sgcoll-up"),h=$.G.store(),j;if(!h.length){h=$('<div id="win-house" class="h0"></div>').appendTo("body")}if(!l.length){var L='<form id="form-sgcoll-poststatus" action="/people/mblog/add/" method="post" target="_blank"><input type="hidden" id="sgcoll-sourcetitle" name="source_title" value=""/><input type="hidden" id="sgcoll-sourcelink"  name="source_link" value=""/><!-- 图片区域 --> <div id="sgcoll-pics"></div><div id="sgcoll-panel"><!-- 专辑区域 --> <div class="sgcoll-album"><div id="sgcoll-albumsel" class="sgcoll-albumsel"><input id="sgcoll-albumsel-v" type="text" name="album" value="" data-optional="1"/><a class="sgcoll-shw" href="javascript:;">默认专辑</a></div></div> <!-- 输入框 --> <div class="sgcoll-cxa"><textarea name="content" class="txa" id="sgcoll-txa" data-optional="1"></textarea><span class="sgcoll-wremain dn"><b id="sgcoll-rmn">300</b> 字</span><label for="sgcoll-txa" id="sgcoll-txa-lb">写点介绍，让更多人喜欢ta</label></div> <!-- 标签区域 --> <div class="sgcoll-tags-wrp"><div id="sgcoll-tags-add" class="da tag-sel-cnt tag-use-cnt clr"><input id="sgcoll-tags-inp" class="tag-edt-ipt" autocomplete="off" type="text" value="" maxlength="20" /></div><label for="sgcoll-tags-inp" id="sgcoll-tags-lb"><i>&nbsp;</i>添加适合的标签，方便大家找到</label><button class="dn" id="dopost-tags-reset" type="button" /><div class="tag-use-cnt tag-def-cnt da" id="sgcoll-tags-sel"><span id="sgcoll-tags-cls"><span>关闭</span></span><span class="tag-use-desc">热门标签：</span></div></div> <!-- 发布按钮 --> <div id="sgcoll-subarea" class="u-chk clr"><a class="abtn l" href="javascript:;" target="_self"><button id="sgcoll-abtnpost" type="submit"><u>发布</u></button></a><input type="checkbox" name="syncpost" class="chk s-sina dn" value="sina" id="sgcoll-sync"><label for="sgcoll-sync" title="同步到新浪微博" class="s-sina dn" >同步</label><div class="sgcoll-mbsite s-sina dn">新浪</div><div id="sgcoll-poststat"></div></div></div><input id="sgcoll-tags-val" type="hidden" name="tags" value=""/><input type="hidden" name="source" value=""/><input type="hidden" value="" name="" id="sgcoll-imgcont" /><input id="sgcoll-grpid" type="hidden" name="group" value/></form>';l=$('<div id="sgcoll-up"><div id="sgcoll-fetch-in" class="dn clr"><div class="sgcoll-dragdr"><a href="/about/collectit/?from=postbg" target="_blank">使用堆糖收集工具，抓取图片更简单 &gt;</a></div><div class="sgcoll-drgbox"><div class="gray sgcoll-fetch-normal" id="sgcoll-fchk">将图片所在页面网址完整地粘贴到这里</div><form id="form-sgcoll-fetchpic" class="sgcoll-fetch-normal" action="/mblog/fetch/" method="post" target="_self"><input type="text" value="http://" autocomplete="off" class="ipt" name="url" id="sgcoll-fipt"><div class="tc"><a target="_self" href="javascript:;" class="abtn dib" id="sgcoll-fchab"><button type="submit"><u>确定</u></button></a></div></form><div id="sgcoll-fetching" class="l loading3 dn">正在抓取<br/><a id="sgcoll-fetch-cancel" class="lkl" href="javascript:;">取消</a></div></div></div><div id="sgcoll-up-in" class="dn clr"><div id="sgcoll-dropimgcov">拖拽图片到这里可直接上传</div><div id="sgcoll-dropimg" class="sgcoll-dbox"><a id="sgcoll-upbtn" href="javascript:;" class="abtn abtn-up dib sgcoll-up-normal"><u><i></i>上传图片</u><form id="form-sgcoll-upic" target="alupifr" enctype="multipart/form-data" method="POST" action="/upload/photo/"><input name="img" hidefocus="true" type="file" /><input type="hidden" name="tid" value=""/><input type="hidden" name="callback" value="$.fn.uploadpic.upPicCallBack"><iframe name="alupifr" src="about:blank" class="dn" scrolling="no" frameborder="0" height="0" width="0"></iframe><input type="hidden" name="type" value="blog"/></form></a><div id="sgcoll-up-mess" class="sgcoll-up-normal">图片需小于10M；如有来源，请注明</div><div id="sgcoll-uploading" class="l loading3 dn">正在上传<br/><a id="sgcoll-up-cancel" class="uploadpic-delthepic lkl" href="javascript:;">取消</a></div></div></div><div id="sgcoll-uploaded" class="dn">'+L+"</div></div>").appendTo(h);n=$("#form-sgcoll-fetchpic"),x=$("#sgcoll-fipt"),f=$("#sgcoll-pics"),E=$("#sgcoll-uploaded"),q=$("#sgcoll-txa"),d=$("#sgcoll-txa-lb"),y=$("#sgcoll-imgcont"),b=$("#sgcoll-tags-add"),o=$("#sgcoll-tags-val"),t=$("#sgcoll-tags-inp"),k=$("#sgcoll-tags-lb"),g=$("#sgcoll-tags-sel"),s=$("#sgcoll-tags-cls").find("span"),B=$("#dopost-tags-reset"),v=$("#sgcoll-albumsel"),w=$("#sgcoll-subarea"),c=$("#form-sgcoll-poststatus"),m=$("#sgcoll-abtnpost"),j;if(typeof BIND_SITES=="undefined"||!BIND_SITES.sina){w.find(".s-sina").remove()}else{w.find(".s-sina").removeClass("dn")}I.resetType(I.type,true);var F=!!($.browser.webkit&&navigator.userAgent.toString().match("Chrome"));if(F&&window.File&&window.FileList){var K=$("#sgcoll-dropimg,#sgcoll-dropimgcov");K.bind("dragenter",function(N){if(N.originalEvent.dataTransfer.types.toString()==="Files"){window.clearTimeout(K.data("timer"));K.css("backgroundPosition","0 -300px");$("#sgcoll-dropimgcov").css("display","block")}}).bind("dragleave",function(N){window.clearTimeout(K.data("timer"));K.eq(0).data("timer",window.setTimeout(function(){K.css("backgroundPosition","0 0");$("#sgcoll-dropimgcov").css("display","none")},100))}).bind("dragover",function(N){N.preventDefault();N.stopPropagation();window.clearTimeout(K.data("timer"))}).bind("drop",function(P){P.preventDefault();P.stopPropagation();$("#sgcoll-dropimgcov").css("display","none");var O=P.originalEvent.dataTransfer.files;if(O.length){var N=$("#form-sgcoll-upic input[type=file]").get(0);N.files=O}})}n.submit(function(N){N.preventDefault();$.SGColl.doFetchPic()});$("#sgcoll-fetch-cancel").click(function(N){N.preventDefault();$.SGColl.resetFetch()});x.focus(function(O){var N=this;if($.browser.webkit){setTimeout(function(){N.select()},10)}else{N.select()}});$("#sgcoll-upbtn").uploadpic(function(N,P,O){if(N.success){$.G.gaq("/_trc/Post/_/uppicok");$.SGColl.resetPost();f.html('<img id="sgcoll-upimg" data-iid="'+N.picid+'" src="'+$.G.dtImageTrans(N.src,true,120,120,"c")+'" />');y.val(N.picid);$("#sgcoll-up-in").addClass("dn");$.SGColl.repop();if(p.tags){t.val(p.tags),k.css("display","none")}}else{$.SGAlert.show(N.message,a);$.SGColl.resetFile();$("#sgcoll-upbtn,#sgcoll-up-mess").removeClass("dn")}},{onupload:function(){$.G.gaq("/_trc/Post/_/uppicsubmit");$.SGAlert.clean()},sel_holder:"#sgcoll-up",sel_form:"#form-sgcoll-upic",sel_normal:".sgcoll-up-normal",sel_uploading:"#sgcoll-uploading",sel_uploaded:"#sgcoll-uploaded"});$("#sgcoll-up-cancel").click(function(N){l.find("input[name=tid]").data("uploadpic-tid","")});u=$("#sgcoll-albumsel").find("a").myalbums({sel_valueipt:$("#sgcoll-albumsel-v"),sel_holder:$("#sgcoll-uploaded")});mblogTagsInit(["#sgcoll-tags-add",null,null,"#sgcoll-tags-sel","#sgcoll-tags-inp","#dopost-tags-reset",""]);q.bind("focus click",function(N){N.stopPropagation();$.SGColl.showLabel(this,"#sgcoll-txa-lb",true)}).blur(function(){$.SGColl.showLabel(this,"#sgcoll-txa-lb")});var J=300;function M(N){keyupLenLimitForU(N.currentTarget,J,true,true)}q.keyup(M).blur(M).focus(M);keyupLenLimitForU(q[0],J,true,true);q.keydown(function(N){if(N.metaKey&&N.which==13){c.submit()}});$.fn.at&&q.at({isFixed:true,upper:true});t.bind("focus click",function(N){N.stopPropagation();window.clearTimeout(z);$.SGColl.showTagLabel(b,k,true)}).blur(function(N){z=window.setTimeout(function(){$.SGColl.showTagLabel(b,k)},100)});t.bind("focus",function(N){if($.browser.msie&&$.browser.version==="6.0"){g.css({display:"block",visibility:"hidden"});g.css({top:-g.outerHeight()+1,bottom:"auto",visibility:"visible"})}else{g.css({top:"auto",bottom:b.outerHeight()-1,display:"block"})}});s.add($(document)).click(function(){g.css("display","none")});b.add(g).click(function(N){N.stopPropagation()});c.submit(function(N){N.preventDefault();$.SGColl.doPost()})}}I.resetType(I.type,true);I.repop()},repop:function(){SUGAR.PopOut.alert([D[this.type],l,""],"m");if(x.filter(":visible").length){var F=x.val();x.focus().val("").val(F).focus()}},checkFetchUrl:function(F){if(!$.G.isLink(F)){$.SGAlert.show("请输入正确的网址",a);return false}else{var G=F.split("://")[1].split("/")[0];if(G.match(/\bduitang\.com/ig)){$.SGAlert.show("仅支持外站网址，站内请直接收集",a);return false}return true}},isPicUrl:function(G){var F=G.lastIndexOf("."),H=F>-1?G.substr(F+1):"";if(H&&H.match(/^(jpg|png|gif)$/ig)){return true}else{return false}},doFetchPic:function(){var G=this;$.G.gaq("/_trc/Post/_/dofetch");$.SGAlert.clean();var F=$.trim(x.val());if(!F.match(/^http(?:s)?:\/\//ig)){F="http://"+F;x.val(F)}F=taobaoThumbPic(F);if(G.isPicUrl(F)){G.afterFetch(F,true);return}if(!G.checkFetchUrl(F)){return}x.blur();$("#sgcoll-fetching").removeClass("dn");$("#sgcoll-fetch-in").find(".sgcoll-fetch-normal").addClass("dn");$.ajax({url:n.getFormAction(),data:n.paramForm(getToken(2)),mysuccess:function(H,I){if(!$("#sgcoll-fetch-cancel:visible").length){return}G.afterFetch(F,false,H.data)},myfailure:function(H,I){if(!$("#sgcoll-fetch-cancel:visible").length){return}G.resetFetch();$.SGAlert.show(mergeServerMessage(H.message),a)},myerror:function(){G.resetFetch();$.SGAlert.show("网络出问题了，请稍后再试",a)}})},afterFetch:function(H,F,J){var I=this;if(F){J={images:[H],title:"图片"}}var K=J.images;if(K.length){if(!f.data("choose")){f.data("choose",true).delegate(".vm","click",function(L){L.stopPropagation();L.preventDefault();var M=$(this);f.find(".cur").removeClass("cur");y.val(M.addClass("cur").find("img").attr("src"))})}I.resetPost();$("#sgcoll-sourcelink").val(H);$("#sgcoll-sourcetitle").val(J.title);var G=K.length<10?K.length:10;f.html(['<div class="sgcoll-finfo"><div><span>来源：</span>'+J.title.cut(60,"…")+"</div><div><span>链接：</span>"+H.cut(60,"…")+'</div></div><div id="sgcoll-picselect" class="sgcoll-picselect" ',(G>3?'style="overflow-x:scroll;"':""),'><div class="sgcoll-piclist clr" style="width:',(147*G-13),'px;"><!-- 循环单元开始 -->',(function(){var M="";for(var L=0;L<G;L++){var N=K[L],N=N.charAt(0)==="/"?"http://"+window.location.hostname+N:N;M+='<div class="vm ct l '+(L===G-1?"last":"")+" "+(L===0?"cur":"")+'"><div class="vma"><div class="vmb"> <img src="'+N+'" /></div></div></div>'}return M})(),"<!-- 循环单元结束 --></div></div>",].join(""));$("#sgcoll-picselect").scrollTop(0);y.val(f.find("img:first").attr("src"));$("#sgcoll-fetch-in").addClass("dn");$("#sgcoll-uploaded").removeClass("dn");I.repop();if(p.tags){t.val(p.tags),k.css("display","none")}$.G.gaq("/_trc/Post/_/dofetchok")}else{I.resetFetch();$.SGAlert.show("很抱歉，未能抓取到合适图片",a)}},doPost:function(){var I=this;if(!q.val()){$.G.blinkIt(function(){q.css({backgroundColor:"#ffffcc"})},function(){q.css({backgroundColor:"transparent"})},function(){q.focus()},4,200);return}if(!y.val()){$.SGAlert.show("没有图片无法发布哟",a)}var H=m.closest(".abtn");if(H.hasClass("abtn-no")){return}H.addClass("abtn-no");$.SGAlert.show("正在提交，请稍候");if(window.location.pathname.indexOf("/collect/")===0){$.G.gaq("/_trc/Post/_/dopost_outside")}else{$.G.gaq("/_trc/Post/_/dopost")}var G=[],F=$.trim(t.val());b.find(".added-tag").each(function(K,L){var J=$(L);G.push($.trim(J.text()))});if($.inArray(F,G)===-1){G.push(F)}o.val(G.join(" "));$.ajax({url:c.getFormAction(),data:c.paramForm(getToken(2)),mysuccess:function(L,M){$.G.gaq("/_trc/Post/_/dopostok");var Q=v.find("[name=album]").val(),O=v.find(".sgcoll-shw").html(),J;if(Q&&Q!="0"){$.Bom.removeCookie("sgt");$.Bom.setSubCookie("sgt","ai"+$.G.getUSERID(),Q,{expires:30});$.Bom.setSubCookie("sgt","an"+$.G.getUSERID(),O,{expires:30})}C.unshift({id:L.data.id,val:q.val().cut(10,"…")});C=C.slice(0,5);var R=Q&&Q!="0"?"/album/"+Q+"/":"/album/people/"+$.G.getUSERID()+"/";var N=I.type==="upload"?'<a id="sgcoll-continue" href="javascript:;">继续上传</a><span>&nbsp;|&nbsp;</span><a href="/about/collectit/?from=postup" target="_blank">使用堆糖收集工具</a>':'<a href="/about/collectit/?from=postcoll" target="_blank">安装糖收集工具, 帮你轻松保存图片</a>';var K='<div id="sgcoll-over"><div class="prompt prompt-success"><h3>收集成功！<a href="'+R+'" target="_blank">进入专辑查看 &gt;</a></h3><p></p></div><div class="sgcoll-over-bot lkl"><span>或：</span>'+N+"</div></div>";SUGAR.PopOut.alert([D[I.type],K,""],"m");$("#sgcoll-continue").click(function(S){I.resetType(I.type,true);I.repop()});if($.isFunction(A)){A(L)}else{if($("#dymcare").length){var P=$.History.getHash();if(P!=""&&P!="!dym"){$.History.setHash("!dym")}else{$("#dymcare").click()}}}},myfailure:function(J,L){var K=mergeServerMessage(J.message);$.G.gaq("/_trc/Post/_/"+K);$.SGAlert.show(K)},myerror:function(){$.SGAlert.show("网络出问题了，请稍后再试")}}).always(function(){H.removeClass("abtn-no")})},showLabel:function(I,G,F){var J=$(I),H=$(G);H.css("display",$.trim(J.val())!==""||F?"none":"block")},showTagLabel:function(H,G,F){var J=$(H),K=J.find("input"),I=$(G);I.css("display",J.find(".added-tag").length||$.trim(K.val())||F?"none":"block")},resetPost:function(){var F=this;f.html("");q.val("");d.css("display","block");b.find(".added-tag").remove();o.val("");t.val("");k.css("display","block");g.find(".locked").removeClass("locked");$("#sgcoll-sourcetitle").val("");$("#sgcoll-sourcelink").val("");if(F.type==="upload"){y.attr("name","photo_id")}else{if(F.type==="fetch"){y.attr("name","image_src")}}y.val("");c.find("[name=source]").attr("value",F.type);B.click()},resetType:function(F,H){var G=this;if(F==="upload"){G.resetUpload()}else{if(F==="fetch"){G.resetFetch(H)}}},resetFetch:function(F){this.type="fetch";$("#sgcoll-up-in,#sgcoll-uploaded,#sgcoll-fetching").addClass("dn");$("#sgcoll-fetch-in").removeClass("dn").find(".sgcoll-fetch-normal").removeClass("dn");if(F){x.val("http://")}},resetUpload:function(){this.type="upload";$("#sgcoll-fetch-in,#sgcoll-uploaded,#sgcoll-uploading").addClass("dn");$("#sgcoll-up-in,#sgcoll-upbtn,#sgcoll-up-mess").removeClass("dn abtn-no");this.resetFile()},resetFile:function(){var F=$("#form-sgcoll-upic input[type=file]");F.after(F.clone(true).val(""));F.remove()}}}()})();$(function(){});$(function(){var b=$.G.store();$(document).delegate("#mynavtools-create,#createalbum-pp,#createalbum","click",function(g){f()});function f(){var g=$("#popcreatealbum");if(!g.length){g=$('<div id="popcreatealbum" class="popcreatealbum"> <form id="form-popcreatealbum" method="post" action="/album/add/"> <table cellspacing="0" cellpadding="0"> <tr> <td width="60" align="right">专辑名</td> <td><input class="ipt" type="text" name="name" value="" maxlength="40"/></td> <td rowspan="4"> <h6>常用标签</h6> <div class="usetag da" id="popal-mbaddtagsel"> </div> </td> </tr> <tr> <td align="right">描述</td> <td><textarea class="txa" name="desc" maxlength="600" data-optional="1"></textarea></td> </tr> <tr> <td align="right">标签</td> <td> <div class="pr"> <div class="divipt clr"><input id="popal-mbaddtagipt" class="l ipt mr8" autocomplete="off" type="text" name="tags" value=""  maxlength="100" data-optional="1"/></div> <label for="popal-mbaddtagipt" id="popal-mbaddtag-lb">多个标签用空格隔开</label> </div> </td> </tr> <tr> <td>&nbsp;</td> <td><a class="abtn l" href="javascript:;" target="_self"><button type="submit"><u>创建</u></button></a></td> </tr> </table> </form> </div>').appendTo(b);if($.fn.comtags){$("#popal-mbaddtagsel").html(function(){var k="",h=$.fn.comtags.tags;for(var j=0;j<h.length;j++){k+='<a href="#">'+h[j]+"</a>"}return k})}tagSelectBind("#popal-mbaddtagsel","#popal-mbaddtagipt",5);setLabelIptFocus("#popal-mbaddtagipt","#popal-mbaddtag-lb");g.find("[name=name],[name=desc]").lengthLimit();$("#form-popcreatealbum").safeSubmit(function(l){if(!$.G.getUSERID()){return}var h=$(this),k=h.find("a.abtn"),j=k.find("[type=submit]");if(k.hasClass("abtn-no")){return}k.addClass("abtn-no");$.ajax({url:h.getFormAction(),data:h.paramForm($.G.getToken(2)),mysuccess:function(m,n){location.href="/album/"+m.data.id},myfailure:function(m,n){if(m.data&&m.data.robot_check){j.verif({w:1})}else{this.wrongmsg(m)}},myerror:function(){this.errormsg()}}).always(function(){k.removeClass("abtn-no")})})}g.find("[name=name],[name=desc]").val("");SUGAR.PopOut.alert(["创建专辑",g,""],2)}var d=null;$("#woo-holder").delegate("a.blockthisalbum","click",function(j){var h=$(this),g=h.hasClass("ohblocked")?"pass":"blocked";j.preventDefault();d=this;a(g)});$("#woo-holder").delegate("a.delthisalbum","click",function(g){g.preventDefault();d=this;c()});$("#albumdelbtn").click(function(g){g.preventDefault();d=this;c()});function a(j){var h=$("#popalbumblock"),k=(j==="pass"?"解屏":"屏蔽"),g=(j==="pass"?"/operate/audit/unblock_album/":"/operate/audit/block_album/");if(!h.length){h=$('<div id="popalbumblock" class="prompt"><form id="form-albumblock" method="post" action="'+g+'"><p class="albumconfirm" >将<span class="albumbock-sw">'+k+'</span>该专辑以及其中的图片。</p><div class="album-pop-action clr"><a class="abtn abtn-w4 l" href="javascript:;" target="_self"><button type="submit"><u>确定<span class="albumbock-sw">'+k+"</span></u></button></a></div></form></div>").appendTo(b);$("#form-albumblock").delegate(".cancel","click",function(l){SUGAR.PopOut.closeMask(0)});$("#form-albumblock").safeSubmit(function(n){if(!$.G.getUSERID()){return}var l=$(this),m=l.find('button[type="submit"]').closest(".abtn");if(m.hasClass("abtn-no")){return}m.addClass("abtn-no");$.ajax({type:"POST",cache:false,url:l.getFormAction(),data:{album_id:d.title},mysuccess:function(p){var o=$(d).closest(".woo");if(o.length){if($(d).hasClass("ohblocked")){$(d).removeClass("ohblocked").text("屏蔽")}else{$(d).addClass("ohblocked").text("解屏")}}if($("#albumblockbtn").length&&d.title==$("#albumblockbtn").attr("title")){}}}).always(function(){SUGAR.PopOut.closeMask();m.removeClass("abtn-no")})})}else{h.find("form").attr("action",g);h.find(".albumbock-sw").text(k)}SUGAR.PopOut.alert([k+"专辑",h,""])}function c(){var g=$("#popalbumdel");if(!g.length){g=$('<div id="popalbumdel" class="prompt"><form id="form-albumdel" method="post" action="/album/delete/"><p class="albumconfirm" >将删除该专辑以及其中的图片。</p><div class="album-pop-action clr"><a class="abtn abtn-w4 l" href="javascript:;" target="_self"><button type="submit"><u>确定删除</u></button></a></div></form></div>').appendTo(b);$("#form-albumdel").delegate(".cancel","click",function(h){SUGAR.PopOut.closeMask(0)});$("#form-albumdel").safeSubmit(function(k){if(!$.G.getUSERID()){return}var h=$(this),j=h.find('button[type="submit"]').closest(".abtn");if(j.hasClass("abtn-no")){return}j.addClass("abtn-no");$.ajax({cache:false,url:h.getFormAction()+d.title+"/",data:h.paramForm(getToken(2)),mysuccess:function(l){SUGAR.PopOut.alert('<div class="prompt prompt-success"><h3>删除成功！</h3></div>');if($("#albumdelbtn").length&&d.title==$("#albumdelbtn").attr("title")){$({}).delay(1000).queue(function(){SUGAR.PopOut.closeMask(0);var n="/people/"+$.G.getUSERID()+"/#album",m=$("#ppuserlnk");if(m.length){n=m.attr("href")}window.location.href=n})}else{$({}).delay(1000).queue(function(){SUGAR.PopOut.closeMask(0)});$(d).closest("div.woo").remove()}}}).always(function(){j.removeClass("abtn-no")})})}SUGAR.PopOut.alert(["删除专辑",g,""])}});
/*
 * Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net) Licensed under the
 * MIT License (LICENSE.txt).
 * 
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 * 
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(d){var b=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks){for(var a=b.length;a;){d.event.fixHooks[b[--a]]=d.event.mouseHooks}}d.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var f=b.length;f;){this.addEventListener(b[--f],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var f=b.length;f;){this.removeEventListener(b[--f],c,false)}}else{this.onmousewheel=null}}};d.fn.extend({mousewheel:function(f){return f?this.bind("mousewheel",f):this.trigger("mousewheel")},unmousewheel:function(f){return this.unbind("mousewheel",f)}});function c(l){var j=l||window.event,h=[].slice.call(arguments,1),m=0,k=true,g=0,f=0;l=d.event.fix(j);l.type="mousewheel";if(j.wheelDelta){m=j.wheelDelta/120}if(j.detail){m=-j.detail/3}f=m;if(j.axis!==undefined&&j.axis===j.HORIZONTAL_AXIS){f=0;g=-1*m}if(j.wheelDeltaY!==undefined){f=j.wheelDeltaY/120}if(j.wheelDeltaX!==undefined){g=-1*j.wheelDeltaX/120}h.unshift(l,m,g,f);return(d.event.dispatch||d.event.handle).apply(this,h)}})(jQuery);
/*
 * jScrollPane - v2.0.19 - 2013-11-16 http://jscrollpane.kelvinluck.com/
 * 
 * Copyright (c) 2013 Kelvin Luck Dual licensed under the MIT or GPL licenses.
 */
(function(c,b){var a=function(d){return c(d,b)};if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{if(typeof exports==="object"){module.exports=a}else{a(jQuery)}}}(function(b,a,c){b.fn.jScrollPane=function(f){function d(G,R){var aB,T=this,ab,am,y,ao,W,ac,B,u,aC,aH,ax,k,L,j,l,ad,X,at,aa,w,D,au,ai,ap,J,n,aw,aA,A,ay,aK,g,O,al=true,S=true,aJ=false,m=false,ar=G.clone(false,false).empty(),af=b.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";if(G.css("box-sizing")==="border-box"){aK=0;g=0}else{aK=G.css("paddingTop")+" "+G.css("paddingRight")+" "+G.css("paddingBottom")+" "+G.css("paddingLeft");g=(parseInt(G.css("paddingLeft"),10)||0)+(parseInt(G.css("paddingRight"),10)||0)}function av(aT){var aO,aQ,aP,aM,aL,aS,aR=false,aN=false;aB=aT;if(ab===c){aL=G.scrollTop();aS=G.scrollLeft();G.css({overflow:"hidden",padding:0});am=G.innerWidth()+g;y=G.innerHeight();G.width(am);ab=b('<div class="jspPane" />').css("padding",aK).append(G.children());ao=b('<div class="jspContainer" />').css({width:am+"px",height:y+"px"}).append(ab).appendTo(G)}else{G.css("width","");aR=aB.stickToBottom&&N();aN=aB.stickToRight&&E();aM=G.innerWidth()+g!=am||G.outerHeight()!=y;if(aM){am=G.innerWidth()+g;y=G.innerHeight();ao.css({width:am+"px",height:y+"px"})}if(!aM&&O==W&&ab.outerHeight()==ac){G.width(am);return}O=W;ab.css("width","");G.width(am);ao.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}ab.css("overflow","auto");if(aT.contentWidth){W=aT.contentWidth}else{W=ab[0].scrollWidth}ac=ab[0].scrollHeight;ab.css("overflow","");B=W/am;u=ac/y;aC=u>1;aH=B>1;if(!(aH||aC)){G.removeClass("jspScrollable");ab.css({top:0,left:0,width:ao.width()-g});p();H();U();z()}else{G.addClass("jspScrollable");aO=aB.maintainPosition&&(L||ad);if(aO){aQ=aF();aP=aD()}aI();C();I();if(aO){Q(aN?(W-am):aQ,false);P(aR?(ac-y):aP,false)}M();aj();aq();if(aB.enableKeyboardNavigation){V()}if(aB.clickOnTrack){t()}F();if(aB.hijackInternalLinks){o()}}if(aB.autoReinitialise&&!ay){ay=setInterval(function(){av(aB)},aB.autoReinitialiseDelay)}else{if(!aB.autoReinitialise&&ay){clearInterval(ay)}}aL&&G.scrollTop(0)&&P(aL,false);aS&&G.scrollLeft(0)&&Q(aS,false);G.trigger("jsp-initialised",[aH||aC])}function aI(){if(aC){ao.append(b('<div class="jspVerticalBar" />').append(b('<div class="jspCap jspCapTop" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragTop" />'),b('<div class="jspDragBottom" />'))),b('<div class="jspCap jspCapBottom" />')));X=ao.find(">.jspVerticalBar");at=X.find(">.jspTrack");ax=at.find(">.jspDrag");if(aB.showArrows){au=b('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",aG(0,-1)).bind("click.jsp",aE);ai=b('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",aG(0,1)).bind("click.jsp",aE);if(aB.arrowScrollOnHover){au.bind("mouseover.jsp",aG(0,-1,au));ai.bind("mouseover.jsp",aG(0,1,ai))}an(at,aB.verticalArrowPositions,au,ai)}w=y;ao.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){w-=b(this).outerHeight()});ax.hover(function(){ax.addClass("jspHover")},function(){ax.removeClass("jspHover")}).bind("mousedown.jsp",function(aL){b("html").bind("dragstart.jsp selectstart.jsp",aE);ax.addClass("jspActive");var s=aL.pageY-ax.position().top;b("html").bind("mousemove.jsp",function(aM){Y(aM.pageY-s,false)}).bind("mouseup.jsp mouseleave.jsp",az);return false});q()}}function q(){at.height(w+"px");L=0;aa=aB.verticalGutter+at.outerWidth();ab.width(am-aa-g);try{if(X.position().left===0){ab.css("margin-left",aa+"px")}}catch(s){}}function C(){if(aH){ao.append(b('<div class="jspHorizontalBar" />').append(b('<div class="jspCap jspCapLeft" />'),b('<div class="jspTrack" />').append(b('<div class="jspDrag" />').append(b('<div class="jspDragLeft" />'),b('<div class="jspDragRight" />'))),b('<div class="jspCap jspCapRight" />')));ap=ao.find(">.jspHorizontalBar");J=ap.find(">.jspTrack");j=J.find(">.jspDrag");if(aB.showArrows){aA=b('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",aG(-1,0)).bind("click.jsp",aE);A=b('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",aG(1,0)).bind("click.jsp",aE);if(aB.arrowScrollOnHover){aA.bind("mouseover.jsp",aG(-1,0,aA));A.bind("mouseover.jsp",aG(1,0,A))}an(J,aB.horizontalArrowPositions,aA,A)}j.hover(function(){j.addClass("jspHover")},function(){j.removeClass("jspHover")}).bind("mousedown.jsp",function(aL){b("html").bind("dragstart.jsp selectstart.jsp",aE);j.addClass("jspActive");var s=aL.pageX-j.position().left;b("html").bind("mousemove.jsp",function(aM){Z(aM.pageX-s,false)}).bind("mouseup.jsp mouseleave.jsp",az);return false});n=ao.innerWidth();ak()}}function ak(){ao.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){n-=b(this).outerWidth()});J.width(n+"px");ad=0}function I(){if(aH&&aC){var aL=J.outerHeight(),s=at.outerWidth();w-=aL;b(ap).find(">.jspCap:visible,>.jspArrow").each(function(){n+=b(this).outerWidth()});n-=s;y-=s;am-=aL;J.parent().append(b('<div class="jspCorner" />').css("width",aL+"px"));q();ak()}if(aH){ab.width((ao.outerWidth()-g)+"px")}ac=ab.outerHeight();u=ac/y;if(aH){aw=Math.ceil(1/B*n);if(aw>aB.horizontalDragMaxWidth){aw=aB.horizontalDragMaxWidth}else{if(aw<aB.horizontalDragMinWidth){aw=aB.horizontalDragMinWidth}}j.width(aw+"px");l=n-aw;ah(ad)}if(aC){D=Math.ceil(1/u*w);if(D>aB.verticalDragMaxHeight){D=aB.verticalDragMaxHeight}else{if(D<aB.verticalDragMinHeight){D=aB.verticalDragMinHeight}}ax.height(D+"px");k=w-D;ag(L)}}function an(aM,aO,aL,s){var aQ="before",aN="after",aP;if(aO=="os"){aO=/Mac/.test(navigator.platform)?"after":"split"}if(aO==aQ){aN=aO}else{if(aO==aN){aQ=aO;aP=aL;aL=s;s=aP}}aM[aQ](aL)[aN](s)}function aG(aL,s,aM){return function(){K(aL,s,this,aM);this.blur();return false}}function K(aO,aN,aR,aQ){aR=b(aR).addClass("jspActive");var aP,aM,aL=true,s=function(){if(aO!==0){T.scrollByX(aO*aB.arrowButtonSpeed)}if(aN!==0){T.scrollByY(aN*aB.arrowButtonSpeed)}aM=setTimeout(s,aL?aB.initialDelay:aB.arrowRepeatFreq);aL=false};s();aP=aQ?"mouseout.jsp":"mouseup.jsp";aQ=aQ||b("html");aQ.bind(aP,function(){aR.removeClass("jspActive");aM&&clearTimeout(aM);aM=null;aQ.unbind(aP)})}function t(){z();if(aC){at.bind("mousedown.jsp",function(aQ){if(aQ.originalTarget===c||aQ.originalTarget==aQ.currentTarget){var aO=b(this),aR=aO.offset(),aP=aQ.pageY-aR.top-L,aM,aL=true,s=function(){var aU=aO.offset(),aV=aQ.pageY-aU.top-D/2,aS=y*aB.scrollPagePercent,aT=k*aS/(ac-y);if(aP<0){if(L-aT>aV){T.scrollByY(-aS)}else{Y(aV)}}else{if(aP>0){if(L+aT<aV){T.scrollByY(aS)}else{Y(aV)}}else{aN();return}}aM=setTimeout(s,aL?aB.initialDelay:aB.trackClickRepeatFreq);aL=false},aN=function(){aM&&clearTimeout(aM);aM=null;b(document).unbind("mouseup.jsp",aN)};s();b(document).bind("mouseup.jsp",aN);return false}})}if(aH){J.bind("mousedown.jsp",function(aQ){if(aQ.originalTarget===c||aQ.originalTarget==aQ.currentTarget){var aO=b(this),aR=aO.offset(),aP=aQ.pageX-aR.left-ad,aM,aL=true,s=function(){var aU=aO.offset(),aV=aQ.pageX-aU.left-aw/2,aS=am*aB.scrollPagePercent,aT=l*aS/(W-am);if(aP<0){if(ad-aT>aV){T.scrollByX(-aS)}else{Z(aV)}}else{if(aP>0){if(ad+aT<aV){T.scrollByX(aS)}else{Z(aV)}}else{aN();return}}aM=setTimeout(s,aL?aB.initialDelay:aB.trackClickRepeatFreq);aL=false},aN=function(){aM&&clearTimeout(aM);aM=null;b(document).unbind("mouseup.jsp",aN)};s();b(document).bind("mouseup.jsp",aN);return false}})}}function z(){if(J){J.unbind("mousedown.jsp")}if(at){at.unbind("mousedown.jsp")}}function az(){b("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp");if(ax){ax.removeClass("jspActive")}if(j){j.removeClass("jspActive")}}function Y(s,aL){if(!aC){return}if(s<0){s=0}else{if(s>k){s=k}}if(aL===c){aL=aB.animateScroll}if(aL){T.animate(ax,"top",s,ag)}else{ax.css("top",s);ag(s)}}function ag(aL){if(aL===c){aL=ax.position().top}ao.scrollTop(0);L=aL;var aO=L===0,aM=L==k,aN=aL/k,s=-aN*(ac-y);if(al!=aO||aJ!=aM){al=aO;aJ=aM;G.trigger("jsp-arrow-change",[al,aJ,S,m])}x(aO,aM);ab.css("top",s);G.trigger("jsp-scroll-y",[-s,aO,aM]).trigger("scroll")}function Z(aL,s){if(!aH){return}if(aL<0){aL=0}else{if(aL>l){aL=l}}if(s===c){s=aB.animateScroll}if(s){T.animate(j,"left",aL,ah)}else{j.css("left",aL);ah(aL)}}function ah(aL){if(aL===c){aL=j.position().left}ao.scrollTop(0);ad=aL;var aO=ad===0,aN=ad==l,aM=aL/l,s=-aM*(W-am);if(S!=aO||m!=aN){S=aO;m=aN;G.trigger("jsp-arrow-change",[al,aJ,S,m])}v(aO,aN);ab.css("left",s);G.trigger("jsp-scroll-x",[-s,aO,aN]).trigger("scroll")}function x(aL,s){if(aB.showArrows){au[aL?"addClass":"removeClass"]("jspDisabled");ai[s?"addClass":"removeClass"]("jspDisabled")}}function v(aL,s){if(aB.showArrows){aA[aL?"addClass":"removeClass"]("jspDisabled");A[s?"addClass":"removeClass"]("jspDisabled")}}function P(s,aL){var aM=s/(ac-y);Y(aM*k,aL)}function Q(aL,s){var aM=aL/(W-am);Z(aM*l,s)}function ae(aY,aT,aM){var aQ,aN,aO,s=0,aX=0,aL,aS,aR,aV,aU,aW;try{aQ=b(aY)}catch(aP){return}aN=aQ.outerHeight();aO=aQ.outerWidth();ao.scrollTop(0);ao.scrollLeft(0);while(!aQ.is(".jspPane")){s+=aQ.position().top;aX+=aQ.position().left;aQ=aQ.offsetParent();if(/^body|html$/i.test(aQ[0].nodeName)){return}}aL=aD();aR=aL+y;if(s<aL||aT){aU=s-aB.horizontalGutter}else{if(s+aN>aR){aU=s-y+aN+aB.horizontalGutter}}if(!isNaN(aU)){P(aU,aM)}aS=aF();aV=aS+am;if(aX<aS||aT){aW=aX-aB.horizontalGutter}else{if(aX+aO>aV){aW=aX-am+aO+aB.horizontalGutter}}if(!isNaN(aW)){Q(aW,aM)}}function aF(){return -ab.position().left}function aD(){return -ab.position().top}function N(){var s=ac-y;return(s>20)&&(s-aD()<10)}function E(){var s=W-am;return(s>20)&&(s-aF()<10)}function aj(){ao.unbind(af).bind(af,function(aP,aQ,aN,aL){var aM=ad,s=L,aO=aP.deltaFactor||aB.mouseWheelSpeed;T.scrollBy(aN*aO,-aL*aO,false);return aM==ad&&s==L})}function p(){ao.unbind(af)}function aE(){return false}function M(){ab.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(s){ae(s.target,false)})}function H(){ab.find(":input,a").unbind("focus.jsp")}function V(){var s,aL,aN=[];aH&&aN.push(ap[0]);aC&&aN.push(X[0]);ab.focus(function(){G.focus()});G.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(aQ){if(aQ.target!==this&&!(aN.length&&b(aQ.target).closest(aN).length)){return}var aP=ad,aO=L;switch(aQ.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:s=aQ.keyCode;aM();break;case 35:P(ac-y);s=null;break;case 36:P(0);s=null;break}aL=aQ.keyCode==s&&aP!=ad||aO!=L;return !aL}).bind("keypress.jsp",function(aO){if(aO.keyCode==s){aM()}return !aL});if(aB.hideFocus){G.css("outline","none");if("hideFocus" in ao[0]){G.attr("hideFocus",true)}}else{G.css("outline","");if("hideFocus" in ao[0]){G.attr("hideFocus",false)}}function aM(){var aP=ad,aO=L;switch(s){case 40:T.scrollByY(aB.keyboardSpeed,false);break;case 38:T.scrollByY(-aB.keyboardSpeed,false);break;case 34:case 32:T.scrollByY(y*aB.scrollPagePercent,false);break;case 33:T.scrollByY(-y*aB.scrollPagePercent,false);break;case 39:T.scrollByX(aB.keyboardSpeed,false);break;case 37:T.scrollByX(-aB.keyboardSpeed,false);break}aL=aP!=ad||aO!=L;return aL}}function U(){G.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function F(){if(location.hash&&location.hash.length>1){var aN,aL,aM=escape(location.hash.substr(1));try{aN=b("#"+aM+', a[name="'+aM+'"]')}catch(s){return}if(aN.length&&ab.find(aM)){if(ao.scrollTop()===0){aL=setInterval(function(){if(ao.scrollTop()>0){ae(aN,true);b(document).scrollTop(ao.position().top);clearInterval(aL)}},50)}else{ae(aN,true);b(document).scrollTop(ao.position().top)}}}}function o(){if(b(document.body).data("jspHijack")){return}b(document.body).data("jspHijack",true);b(document.body).delegate("a[href*=#]","click",function(s){var aL=this.href.substr(0,this.href.indexOf("#")),aN=location.href,aR,aS,aM,aP,aO,aQ;if(location.href.indexOf("#")!==-1){aN=location.href.substr(0,location.href.indexOf("#"))}if(aL!==aN){return}aR=escape(this.href.substr(this.href.indexOf("#")+1));aS;try{aS=b("#"+aR+', a[name="'+aR+'"]')}catch(aT){return}if(!aS.length){return}aM=aS.closest(".jspScrollable");aP=aM.data("jsp");aP.scrollToElement(aS,true);if(aM[0].scrollIntoView){aO=b(a).scrollTop();aQ=aS.offset().top;if(aQ<aO||aQ>aO+b(a).height()){aM[0].scrollIntoView()}}s.preventDefault()})}function aq(){var aM,aL,aO,aN,aP,s=false;ao.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(aQ){var aR=aQ.originalEvent.touches[0];aM=aF();aL=aD();aO=aR.pageX;aN=aR.pageY;aP=false;s=true}).bind("touchmove.jsp",function(aT){if(!s){return}var aS=aT.originalEvent.touches[0],aR=ad,aQ=L;T.scrollTo(aM+aO-aS.pageX,aL+aN-aS.pageY);aP=aP||Math.abs(aO-aS.pageX)>5||Math.abs(aN-aS.pageY)>5;return aR==ad&&aQ==L}).bind("touchend.jsp",function(aQ){s=false}).bind("click.jsp-touchclick",function(aQ){if(aP){aP=false;return false}})}function h(){var s=aD(),aL=aF();G.removeClass("jspScrollable").unbind(".jsp");G.replaceWith(ar.append(ab.children()));ar.scrollTop(s);ar.scrollLeft(aL);if(ay){clearInterval(ay)}}b.extend(T,{reinitialise:function(aL){aL=b.extend({},aB,aL);av(aL)},scrollToElement:function(aM,aL,s){ae(aM,aL,s)},scrollTo:function(aM,s,aL){Q(aM,aL);P(s,aL)},scrollToX:function(aL,s){Q(aL,s)},scrollToY:function(s,aL){P(s,aL)},scrollToPercentX:function(aL,s){Q(aL*(W-am),s)},scrollToPercentY:function(aL,s){P(aL*(ac-y),s)},scrollBy:function(aL,s,aM){T.scrollByX(aL,aM);T.scrollByY(s,aM)},scrollByX:function(s,aM){var aL=aF()+Math[s<0?"floor":"ceil"](s),aN=aL/(W-am);Z(aN*l,aM)},scrollByY:function(s,aM){var aL=aD()+Math[s<0?"floor":"ceil"](s),aN=aL/(ac-y);Y(aN*k,aM)},positionDragX:function(s,aL){Z(s,aL)},positionDragY:function(aL,s){Y(aL,s)},animate:function(aL,aO,s,aN){var aM={};aM[aO]=s;aL.animate(aM,{duration:aB.animateDuration,easing:aB.animateEase,queue:false,step:aN})},getContentPositionX:function(){return aF()},getContentPositionY:function(){return aD()},getContentWidth:function(){return W},getContentHeight:function(){return ac},getPercentScrolledX:function(){return aF()/(W-am)},getPercentScrolledY:function(){return aD()/(ac-y)},getIsScrollableH:function(){return aH},getIsScrollableV:function(){return aC},getContentPane:function(){return ab},scrollToBottom:function(s){Y(k,s)},hijackInternalLinks:b.noop,destroy:function(){h()}});av(R)}f=b.extend({},b.fn.jScrollPane.defaults,f);b.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){f[this]=f[this]||f.speed});return this.each(function(){var g=b(this),h=g.data("jsp");if(h){h.reinitialise(f)}else{b("script",g).filter('[type="text/javascript"],:not([type])').remove();h=new d(g,f);g.data("jsp",h)}})};b.fn.jScrollPane.defaults={showArrows:false,maintainPosition:true,stickToBottom:false,stickToRight:false,clickOnTrack:true,autoReinitialise:false,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:c,animateScroll:false,animateDuration:300,animateEase:"linear",hijackInternalLinks:false,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:false,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:true,hideFocus:false,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:0.8}},this));$(function(){var f=$(document);var b=$(".dt-menu-inner-content-item");var o;f.on("click",".dt-menu-inner-content-item .dt-people-avatar",function(s){s.preventDefault();s.stopPropagation();var t=$(this);var q=t.find("img").data("pdetail");window.location.href=q});f.on("click",".dt-coalbum li",function(v){var x=$(this);var s=x.parent("a").attr("href");var u=x.parent("a").data("dtactived");s=s.split("/")[2];var w="co_album_visted_"+s,t=$.Store.get(w),q=t!==u;if(q){$.Store.set(w,u)}});function m(){var q=$("#dt-notification");var t=q.find(".dt-notification-btn");var s=$(".dt-menu-inner-nav-tab");f.on("click",function(){if($(".dt-co-menu").length){$(".dt-co-menu").hide()}});f.on("click",".dt-menu-message",function(u){u.stopPropagation()});t.click(function(v){v.preventDefault();v.stopPropagation();$(".dt-co-menu").show();var u=s.eq(0)[0];d(u)});s.click(function(){this.switchTab=d;this.switchTab(this)})}f.on("click",".dt-hdeny",function(t){t.preventDefault();t.stopPropagation();var s=$(this);var q=s.data("albumid");if(s.hasClass("abtn-no")){return}s.addClass("abtn-no");$.ajax({url:"/napi/album/co_album_invitation/reject/",data:{album_id:q},mysuccess:function(u,v){s.closest("li").remove()}}).always(function(){s.removeClass("abtn-no")})});f.on("click",".dt-haccept",function(u){u.preventDefault();u.stopPropagation();var t=$(this);var s=t.data("albumid");var q=t.closest(".dt-inviter").find(".dt-inviter-hidecover").attr("src");if(t.hasClass("abtn-no")){return}t.addClass("abtn-no");$.ajax({url:"/napi/album/co_album_invitation/accept/",data:{album_id:s},mysuccess:function(w,A){var z=w.data,x=z.album,y=x.user,E=y&&y.avatar,B=x.id,v=x.name,D=x.desc;var E=$.G.dtImageTrans(E,true,48,48,"c");var C='<li><a href="/album/'+B+'/"><div class="dt-opeople-avatar"><img src="'+q+'" alt="" class="dt-opeople-image"></div><div class="dt-people-info clr"><p class="dt-people-name">'+v+'</p><p class="dt-people-msg"></p><img class="dt-people-image2" src="'+E+'" alt=""></div></a></li>';t.closest(".dt-inviter").prepend(C).end().closest("li").remove()}}).always(function(){t.removeClass("abtn-no")})});$(".dt-friend").SGfollow("a[data-follow]");function d(u){var B=$(u);var z=B.index();var C=B.find(".dt-tab-realnum").text();var y=$(".dt-notification-count");var w=$(".dt-allcount");var E=w.text();var x=$(".dt-bottom-location");if(!b.eq(z).find(".dt-nonoti").length){o=window.setTimeout(function(){g(z)},1500)}switch(z){case 0:var v=B.find(".dt-tab-hidenum");var s={};for(i=0;i<v.length;i++){var A=v.eq(i).data("cleanname");var q=v.eq(i).text();s[A]=q}var D=0;for(var G in s){D+=+s[G]}if(D>0){h(s)}x.attr({href:"/notification/list/#/napi/notification/list/?read_all=0&limit=20&start=0"});if(!b.eq(z).find("li").length&&!b.eq(z).find(".dt-nonoti").length){l()}break;case 1:x.attr({href:"/notification/list/#/napi/album/co_album/list/?start=0"});if(!b.eq(z).find("li").length&&!b.eq(z).find(".dt-nonoti").length){a()}break;case 2:x.attr({href:"/notification/list/#/napi/letter/list/?limit=20&start=0"});if(!b.eq(z).find("li").length&&!b.eq(z).find(".dt-nonoti").length){k()}break;case 3:var s={};var t=B.find(".dt-tab-realnum").text();var F=B.find(".dt-tab-numclean").data("cleanname");s[F]=t;if(t>0){h(s)}x.attr({href:"/notification/list/#/napi/people/list/by_recommend/?limit=20&start=0"});if(!b.eq(z).find("li").length&&!b.eq(z).find(".dt-nonoti").length){n()}break}E=E-C;if(E<999){y.text(E)}if(E===0){y.hide().text("")}w.text(E);B.addClass("tab-highlight").siblings().removeClass("tab-highlight").end().children("i").hide().text("");b.eq(z).show().siblings().hide();f.ajaxComplete(function(I,J,H){if(H.url.indexOf("/napi/")>-1){if(J.status===200){if(J.responseText.indexOf('"blogs":[]')<0){c(b,z)}else{}}}});c(b,z)}function g(q){if(!b.eq(q).find("li").length){if(q===1){}else{b.eq(q).find("ul").append('<img src="http://img4.duitang.com/uploads/people/201307/30/20130730175612_KU2dF.gif" alt="" class="pg-loadgif">')}}}function h(q){$.ajax({url:"/napi/read/",data:q,mysuccess:function(s,t){}})}function p(){$.ajax({type:"GET",cache:false,url:"/napi/unread/",mysuccess:function(F,K){if(!F.data){return}var A=F.data;var q=0;var t=A.recommend_friend_count,N=A.blog_forward_count,O=A.letter_count,E=A.album_like_count,s=A.blog_like_count,I=A.blog_comment_count;var H=$("#dt-notification"),u=H.find(".dt-notification-btn"),z=H.find(".dt-notification-count"),w=H.find(".dt-menu-inner-notifi"),G=w.find(".dt-menu-inner-nav-tab"),C=G.children("span"),x=G.children(".dt-tab-numclean"),y=G.children(".dt-tab-realnum");nofi_num=parseInt(N)+parseInt(E)+parseInt(s)+parseInt(I);q=nofi_num+parseInt(t)+parseInt(O);var J=[N,E,s,I];var v=$(".dt-tab-hidenum");for(i=0;i<v.length;i++){v.eq(i).html(J[i])}y.eq(0).html(nofi_num);y.eq(2).html(O);y.eq(3).html(t);if(q>0){var D=999,B=q>D?D+"+":q;if(!z.length){u.append('<span class="dt-notification-count">'+B+"</span>");u.append('<i class="dt-allcount dn">'+q+"</i>")}else{z.html(B)}w.parent(".dt-menu").removeClass("disable");x.hide()}else{if(z){z.remove()}w.parent(".dt-menu").hide().addClass("disable");x.hide()}var L=99;if(nofi_num>0){nofi_num=nofi_num>L?L+"+":nofi_num;x.eq(0).show().html(nofi_num)}if(O>0){O=O>L?L+"+":O;x.eq(2).show().html(O)}if(t>0){t=t>L?L+"+":t;x.eq(3).show().html(t)}}})}if($("#dt-notification").length){window.setTimeout(function(){p()},500);if(window.location.href.toString().match(/duitang\.com\/myhome/ig)){window.setInterval(p(),20000)}}function c(t,q){var s=t.eq(q);s.jScrollPane({horizontalGutter:5,verticalGutter:5,showArrows:false,mouseWheelSpeed:50}).bind("mousewheel",function(u){u.preventDefault()});$(".jspDrag").hide();$(".jspScrollable").mouseenter(function(){$(this).find(".jspDrag").stop(true,true).fadeIn("slow")});$(".jspScrollable").mouseleave(function(){$(this).find(".jspDrag").stop(true,true).fadeOut("slow")})}function l(){$.ajax({type:"GET",cache:false,url:"/napi/notification/list/?read_all=0&&types=BLOG_FORWARD,BLOG_COMMENT,ALBUM_LIKE,BLOG_LIKE",dataType:"json",mysuccess:function(x,F){window.clearTimeout(o);var K=x.data,H=K.object_list,y=$(".dt-all");y.html("");for(var D=0;D<H.length;D++){var I=H[D],s=I.actor,A=I.album,q=I.comment,J=I.blog,t=J&&J.photo.path,M=A&&A.name,w=A&&A.covers[0],E=A&&A.id,C=q&&q.content,v=J&&J.msg,B=J&&J.id,G=s.avatar,u=s.username,z=s.id;var t=$.G.dtImageTrans(t,true,48,48,"c"),w=$.G.dtImageTrans(w,true,48,48,"c"),G=$.G.dtImageTrans(G,true,48,48,"c");if(v&&v.length>12){var v=$.trim(v).substring(0,12).trim(this)+"..."}if(I.type==="BLOG_FORWARD"){var L='<a href="/people/mblog/'+B+'/detail/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+z+'/"><i class="dt-people-icon people-forward"></i></div><div class="dt-people-info"><p class="dt-people-name">'+u+'</p><p class="dt-people-msg">收集了你的'+v+'</p><img class="dt-opeople-image" src="'+t+'" alt=""></div></li></a>';y.append(L)}else{if(I.type==="BLOG_COMMENT"){if(C!==undefined){var L='<a href="/people/mblog/'+B+'/detail/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+z+'/"><i class="dt-people-icon people-comment"></i></div><div class="dt-people-info clr"><p class="dt-people-name">'+u+'</p><p class="dt-people-msg">评论了你的 '+v+'</p><p class="people-content">'+C+'</p><img class="dt-opeople-image" src="'+t+'" alt=""></div></li></a>';y.append(L)}}else{if(I.type==="ALBUM_LIKE"){var L='<a href="/album/'+E+'/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+z+'/"><i class="dt-people-icon people-like"></i></div><div class="dt-people-info"><p class="dt-people-name">'+u+'</p><p class="dt-people-msg">喜欢了你的专辑 '+M+'</p><img class="dt-opeople-image" src="'+w+'" alt=""></div></li></a>';y.append(L)}else{if(I.type==="BLOG_LIKE"){var L='<a href="/people/mblog/'+B+'/detail/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+z+'/"><i class="dt-people-icon people-zan"></i></div><div class="dt-people-info"><p class="dt-people-name">'+u+'</p><p class="dt-people-msg">赞了你的 '+v+'</p><img class="dt-opeople-image" src="'+t+'" alt=""></div></li></a>';y.append(L)}}}}}if(!y.find("li").length){y.append('<div clr class="dt-nonoti">这里空荡荡</div>')}},myerror:function(q,s){window.clearTimeout(o);var t=$(".dt-all");t.html("");if(!t.find("li").length){t.append('<div clr class="dt-nonoti">这里出错了哟</div>')}}})}function k(){$.ajax({type:"GET",cache:false,url:"/napi/letter/list/?read_all=0",dataType:"json",mysuccess:function(y,E){window.clearTimeout(o);var L=y.data,H=L.object_list,v=$(".dt-message");v.html("");for(var D=0;D<H.length;D++){var I=H[D],F=I.participant,J=I.last_letter.blog,q=J&&J.photo.path,s=F.username,G=F.avatar,w=F.id,B=I.last_letter,z=B.message_type,t=B.msg,u=I.unread_count,A=I.id;var q=$.G.dtImageTrans(q,true,48,48,"c"),G=$.G.dtImageTrans(G,true,48,48,"c");if(t&&t.length>12){var t=$.trim(t).substring(0,12)}switch(z){case"text":v.append('<a class="dt-link-letter" href="/letter/thread/'+A+'/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+w+'/"><i class="dt-icon-letter dt-icon-letter'+D+'"></i></div><div class="dt-people-info clr"><p class="dt-people-name">'+s+'</p><p class="people-msg">'+t+"</p></div></li></a>");if(u>0){$(".dt-icon-letter"+D).addClass("on")}break;case"share_blog":v.append('<a class="dt-link-letter" href="/letter/thread/'+A+'/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+w+'/"><i class="dt-icon-letter dt-icon-letter'+D+'"></i></div><div class="dt-people-info clr"><p class="dt-people-name">'+s+'</p><p class="people-msg">'+t+'</p><img class="dt-opeople-image" src="'+q+'" alt=""></div></li></a>');if(u>0){$(".dt-icon-letter"+D).addClass("on")}break;case"share_album":var C=B.album,x=C.covers[0],x=$.G.dtImageTrans(x,true,48,48,"c");v.append('<a class="dt-link-letter" href="/letter/thread/'+A+'/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+w+'/"><i class="dt-icon-letter dt-icon-letter'+D+'"></i></div><div class="dt-people-info clr"><p class="dt-people-name">'+s+'</p><p class="people-msg">'+t+'</p><img class="dt-opeople-image" src="'+x+'" alt=""></div></li></a>');if(u>0){$(".dt-icon-letter"+D).addClass("on")}break;case"banner":var M=B.banner,K=M.image_url,K=$.G.dtImageTrans(K,true,48,48,"c");v.append('<a class="dt-link-letter" href="/letter/thread/'+A+'/"><li class="clr"><div class="dt-people-avatar"><img src="'+G+'" alt="" class="dt-people-image" data-pdetail="/people/'+w+'/"><i class="dt-icon-letter dt-icon-letter'+D+'"></i></div><div class="dt-people-info clr"><p class="dt-people-name">'+s+'</p><p class="people-msg">'+t+'</p><img class="dt-opeople-image" src="'+K+'" alt=""></div></li></a>');if(u>0){$(".dt-icon-letter"+D).addClass("on")}break;case"co_album_invitation":break}}if(!v.find("li").length){v.append('<div clr class="dt-nonoti">这里空荡荡</div>')}},myerror:function(s,t){window.clearTimeout(o);var q=$(".dt-message");q.html("");if(!q.find("li").length){q.append('<div clr class="dt-nonoti">这里出错了哟</div>')}}})}function n(){$.ajax({type:"GET",cache:false,url:"/napi/people/list/by_recommend/",dataType:"json",mysuccess:function(q,x){window.clearTimeout(o);var v=q.data,z=v.object_list,B=$(".dt-friend");B.html("");for(var w=0;w<z.length;w++){var C=z[w],y=C.relationship,u=C.username,s=C.recommend,A=C.avatar,t=C.id;var A=$.G.dtImageTrans(A,true,48,48,"c");if(y===0){B.append('<li class="clr"><div class="dt-people-avatar"><img src="'+A+'" alt="" class="dt-people-image" data-pdetail="/people/'+t+'/"></div></a><div class="dt-people-info"><p class="dt-people-name"><a href="/people/'+t+'/">'+u+"</a></p><p>"+s+'</p></div><a class="btn-green follow" href="javascript:;">关注</a></li>');B.find("li:last .follow").attr({"data-follow":'{"id":"'+t+'","rel":"0"}'})}else{if(y===1){B.append('<li class="clr"><div class="dt-people-avatar"><img src="'+A+'" alt="" class="dt-people-image" data-pdetail="/people/'+t+'/"></div></a><div class="dt-people-info"><p class="dt-people-name"><a href="/people/'+t+'/">'+u+"</p></a><p>"+s+'</p></div><a class="btn-white unfollow" href="javascript:;">已关注</a></li>');B.find("li:last .unfollow").attr({"data-follow":'{"id":"'+t+'","rel":"1"}'})}else{if(y===2){B.append('<li class="clr"><div class="dt-people-avatar"><img src="'+A+'" alt="" class="dt-people-image" data-pdetail="/people/'+t+'/"></div></a><div class="dt-people-info"><p class="dt-people-name"><a href="/people/'+t+'/">'+u+"</a></p><p>"+s+'</p></div><a class="btn-green follow" href="javascript:;">关注</a></li>');B.find("li:last .follow").attr({"data-follow":'{"id":"'+t+'","name":"'+u+'","rel":"2"}'})}else{if(y===3){B.append('<li class="clr"><div class="dt-people-avatar"><img src="'+A+'" alt="" class="dt-people-image" data-pdetail="/people/'+t+'/"></div></a><div class="dt-people-info"><p class="dt-people-name"><a href="/people/'+t+'/">'+u+"</p></a><p>"+s+'</p></div><a class="btn-white unfollow" href="javascript:;">相互关注</a></li>');B.find("li:last .unfollow").attr({"data-follow":'{"id":"'+t+'","name":"'+u+'","rel":"3"}'})}}}}}if(!B.find("li").length){B.append('<div clr class="dt-nonoti">这里空荡荡</div>')}},myerror:function(q,s){window.clearTimeout(o);var t=$(".dt-friend");t.html("");if(!t.find("li").length){t.append('<div clr class="dt-nonoti">这里出错了哟</div>')}}})}function a(){$.ajax({type:"GET",cache:false,url:"/napi/album/co_album_invitation/list/",dataType:"json",mysuccess:function(y,C){window.clearTimeout(o);var H=y.data,F=H.object_list,t=$(".dt-inviter"),v=$(".dt-coalbum");$(".dt-coalbum").html("");$(".dt-inviter").html("");for(var A=0;A<F.length;A++){var G=F[A],D=G.inviter,x=D.id,u=D.username,E=D.avatar,z=G.album,w=z.covers[0],J=z.name,B=z.id,I=z.user,q=I.id;var E=$.G.dtImageTrans(E,true,48,48,"c");w=$.G.dtImageTrans(w,true,48,48,"c");t.append('<li class="clr"><div class="people-outer"><div class="dt-people-avatar"><img src="'+E+'" alt="" class="dt-people-image" data-pdetail="/people/'+x+'/"></div><div class="dt-people-info clr"><p class="dt-people-name">'+u+'</p><p class="dt-people-msg">邀请你加入共建专辑 <a href="/album/'+B+'/">'+J+'</a></p><div class="dt-pOpreate"><a href="javascript:;" class="btn-green dt-haccept" data-albumid="'+B+'">接受</a><a href="javascript:;" class="btn-white dt-hdeny" data-albumid="'+B+'">拒绝</a></div></div></div><img class="dt-inviter-hidecover" src="'+w+'"/></li>')}var s=t.find("li").length;$(".dt-item2-inviter_num").text(s);j()},myerror:function(s,u){var t=$(".dt-inviter");var q=$(".dt-coalbum");t.html("");if(!q.find("li").length){q.append('<div clr class="dt-nonoti">这里出错了哟</div>')}}})}function j(){$.ajax({type:"GET",cache:false,url:"/napi/album/co_album/list/",dataType:"json",mysuccess:function(y,D){var I=y.data,E=I.object_list,q=0;$pCoalbum=$(".dt-coalbum");$(".dt-coalbum").html("");for(var B=0;B<E.length;B++){var F=E[B],H=F.blog,u=H?H.msg:"",x=F.covers[0],t=F.last_active_user,s=t&&t.avatar,A=t&&t.id,J=F.name,C=F.id,v=F.actived_at;var x=$.G.dtImageTrans(x,true,48,48,"c");var s=$.G.dtImageTrans(s,true,48,48,"c");if(u&&u.length>12){var u=$.trim(u).substring(0,12).trim(this)+"..."}if(t){$pCoalbum.append('<a href="/album/'+C+'/" data-dtactived="'+v+'"><li class="clr"><div class="dt-people-outer"><div class="dt-opeople-avatar"><img src="'+x+'" alt="" class="dt-opeople-image"></div><div class="dt-people-info dt-people-info2 clr"><p class="dt-people-name">'+J+'</p><p class="dt-people-msg">'+u+'</p><img class="dt-people-image2" src="'+s+'" alt=""><i class="dt-icon-inviter off"></i></div></div></li></a>');var w="co_album_visted_"+C,z=$.Store.get(w),G=z!==v;if(G){$(".dt-icon-inviter").eq(B).removeClass("off").addClass("on");q=q+1}}else{$pCoalbum.append('<a href="/album/'+C+'/"><li class="clr"><div class="dt-opeople-avatar"><img src="'+x+'" alt="" class="dt-opeople-image"></div><div class="dt-people-info clr"><p class="dt-people-name">'+J+'</p><p class="dt-people-msg">'+u+"</p></div></li></a>")}}$(".dt-item2-coalbum_num").text(q);if(!$(".dt-inviter").find("li").length&&!$(".dt-coalbum").find("li").length){$(".dt-coalbum").append('<div clr class="dt-nonoti">这里空荡荡</div>')}}})}m()});$(function(){$.fn.extend({hasMenu:function(j){if(!j){j=".dt-menu"}var k=$(this);k.each(function(n,q){var l=$(q);var p=l.find(j),m,o;l.mouseover(function(){clearTimeout(o);if(!p.hasClass("disable")){m=setTimeout(function(){if(p.length){p.addClass("show")}else{l.addClass("show")}},200)}}).mouseout(function(){clearTimeout(m);if(!p.hasClass("disable")){o=setTimeout(function(){if(p.length){p.removeClass("show")}else{l.removeClass("show")}},400)}})})}});var g="<i></i>",c=$("#dt-nav-btn"),b=$(".dt-trend"),h=$("#dt-notification"),f=window.location.pathname,d=window.location.hash;(function(){var j,k;$(document).delegate("#dt-nav","mouseover",function(){clearTimeout(k);var m=$(this);var l=$("#dt-search-list");j=setTimeout(function(){m.addClass("show");l.removeClass("show")},200)}).delegate("#dt-nav","mouseout",function(){clearTimeout(j);var l=$(this);k=setTimeout(function(){l.removeClass("show")},400)})})();$(".dt-has-menu").hasMenu();$("#dt-add").one("mouseover",function(){$("#mynavtools-src").click(function(j){$.SGColl.init({type:"fetch"})});$("#mynavtools-local").click(function(j){$.SGColl.init({type:"upload"})})});$(document).delegate("#dt-login","click",function(j){j.preventDefault();SUGAR.PopOut.login()});if(!$.browser.msie||$.browser.version!=="6.0"){$("#header-wrap").sidepop({id:"pnav-header",width:"100%",height:65,scroll:1,baseline:"top",bias:0,seat:true,isFixed:true,zIndex:998,btnset:0})}var a="  __              __                                \n /\\ \\          __/\\ \\__                             \n \\_\\ \\  __  __/\\_\\ \\ ,_\\    __      ___      __     \n /'_` \\/\\ \\/\\ \\/\\ \\ \\ \\/  /'__`\\  /' _ `\\  /'_ `\\   \n/\\ \\L\\ \\ \\ \\_\\ \\ \\ \\ \\ \\_/\\ \\L\\.\\_/\\ \\/\\ \\/\\ \\L\\ \\  \n\\ \\___,_\\ \\____/\\ \\_\\ \\__\\ \\__/.\\_\\ \\_\\ \\_\\ \\____ \\ \n \\/__,_ /\\/___/  \\/_/\\/__/\\/__/\\/_/\\/_/\\/_/\\/___L\\ \\\n                                             /\\____/\n                                             \\_/__/ \n\n想来堆糖工作？请发送邮件到 hr@duitang.com";window.console&&console.info&&console.info("%c   ","font-size:60px;background:url('http://img4.duitang.com/uploads/people/201312/26/20131226165635_LNYCt.png') no-repeat -10px -25px");window.console&&console.info&&console.info(a);$(document).delegate("#dt-nav-hot-link, #dt-nav-new-link","click",function(){$("#dt-nav").removeClass("show")});$("#dt-nav-content").delegate("a","mousedown",function(k){var l=$(this),j=l.text();$.G.gaq("/_trc/Nav/_/cate_link_"+j)});$("#dt-search").find("form").submit(function(){$.G.gaq("/_trc/Nav/_/search_submit");if(window.location.pathname.indexOf("/category/")==0){$.G.gaq("/_trc/Nav/search/cate_"+window.location.pathname+"_"+$("#kw").val())}if(window.location.pathname.indexOf("/shopping/")==0){$.G.gaq("/_trc/Nav/search/shop_"+window.location.pathname+"_"+$("#kw").val())}});$("#mynavtools-src").mousedown(function(){$.G.gaq("/_trc/Post/nav/fetch_entry")});$("#mynavtools-local").mousedown(function(){$.G.gaq("/_trc/Post/nav/uppic_entry")});$("#mynavtools-create").mousedown(function(){$.G.gaq("/_trc/AlbumPost/nav/entry")});$(".dt-notification-btn").mousedown(function(){$.G.gaq("/_trc/Nav/_/message_entry")});$(".dt-notification-btn .dt-menu-bottom a").mousedown(function(){$.G.gaq("/_trc/Nav/_/tip_know")});$("#mynavtools-home").mousedown(function(){$.G.gaq("/_trc/Nav/_/tools_home")});$("#mynavtools-find").mousedown(function(){$.G.gaq("/_trc/Nav/_/tools_find")});$("#mynavtools-setting").mousedown(function(){$.G.gaq("/_trc/Nav/_/tools_setting")});$("#mynavtools-logout").mousedown(function(){$.G.gaq("/_trc/Nav/_/tools_logout")});$("#dt-login").mousedown(function(){$.G.gaq("/_trc/Nav/_/bar_login")});$("#dt-register").mousedown(function(){$.G.gaq("/_trc/Nav/_/bar_register")});$("#dt-ologin").delegate("a","mousedown",function(){var j=$(this).attr("class");$.G.gaq("/_trc/Nav/_/bar_outlogin_"+j)})});$(function(){var j;var b=$("#dt-search form");var d=b.find("input#kw");var h=b.find("button[type=submit]");var g=$("#dt-search .dt-search-line");var f=b.find("input#type");var a=$("#dt-search-list");var c=["feed","feed","album","people"];d.bind("keydown",function(p){var o=p.keyCode,n=$("#dt-search .dt-search-line.hover"),l=g.length,k=0;if(n.length){var m=g.index(n[0])}else{var m=l-1}if(o===40||o===38){if(o===40){if(m===(l-1)){k=0}else{k=m+1}}else{if(o===38){if(!n.length){m=0}if(m===0){k=l-1}else{k=m-1}}}n.removeClass("hover");$(g[k]).addClass("hover").trigger("mouseover")}});d.bind("keyup paste",function(m){var l=$(this);var k=l.val();if(m.type==="paste"){if(window.clipboardData&&window.clipboardData.getData){k+=window.clipboardData.getData("Text")}else{k+=m.originalEvent.clipboardData.getData("Text")}}if(k.length>0){a.addClass("show");if(k.length>10){k=k.cut(20)}a.find(".red").html(k)}else{a.removeClass("show")}}).click(function(m){var l=$(this);var k=l.val();if(k.length>0){clearTimeout(j);l.trigger("keyup")}}).blur(function(l){var k=$("#dt-search-list");j=setTimeout(function(){k.removeClass("show")},400)});g.mouseover(function(m){var n=$(".dt-search-line");var k=n.index(this);var l=$("#navsch-onlypd");n.removeClass("hover");$(this).addClass("hover");if(!l.length){l=$('<input id="navsch-onlypd" type="hidden" name="fq" value="1"/>')}if(k===1){b.append(l)}else{$("#navsch-onlypd").remove()}f.val(c[k])}).mouseout(function(k){$(g[0]).trigger("mouseover")}).click(function(k){h.click()});if(window.location.pathname.match(/^\/shopping\/.*$/)){g.removeClass("hover");$(g[1]).addClass("hover").trigger("mouseover")}else{g.removeClass("hover");$(g[0]).addClass("hover").trigger("mouseover")}});(function(c){function a(){var g=this,f=g.data("albumlike"),k=g.siblings("i"),d=c("span.like-count"),j=g.siblings(".act-i"),h;f.cancel=1;if(k.length){if(parseInt(k.html())>=0){k.html(parseInt(k.html())+1+"人喜欢")}}if(d.length){if(parseInt(d.html())>=0){d.html(parseInt(d.html())+1+"人喜欢")}}if(j.length){j.find("em").html(parseInt(j.find("em").html())+1)}g.addClass("albumliked").find("span").html("已喜欢")}function b(){var g=this,f=g.data("albumlike"),k=c("span.like-count"),d=g.siblings("span"),j=g.siblings(".act-i"),h;f.cancel=0;if(k.length){if(parseInt(k.html())>=0){k.html(parseInt(k.html())-1+"人喜欢")}}if(d.length>=1&&parseInt(d.html())>=0){g.siblings("span").html(parseInt(g.siblings("span").html())-1+"人喜欢")}if(j.length){j.find("em").html(parseInt(j.find("em").html())-1)}if(g.hasClass("act-o")){g.removeClass("albumliked")}else{g.removeClass("albumliked").addClass("albumtolike").find("span").html("喜欢")}}c.fn.SGalbumlike=function(h,f,g){if(typeof h!=="function"){g=f;f=h;h=c.noop}if(typeof f!=="string"){g=f;f=""}g=c.extend({},g);function d(m){m.stopPropagation();m.preventDefault();if(!c.G.getUSERID()){SUGAR.PopOut.login();return}var p=c(this),k=p.data("albumlike"),o=k.id,l="",j="/unlike/",n="/like/";if(p.data("locked")){return}p.data("locked",1);if(p.data("like")){l=p.data("like").like_id}if(k.cancel){c.ajax({url:j,data:"like_id="+l,mysuccess:function(s,q){b.call(p);p.removeData("locked")},myerror:function(){this.errormsg()}}).always(function(){p.removeData("locked")})}else{c.ajax({url:n,data:"object_id="+o+"&category=0&"+getToken(1),mysuccess:function(q,s){p.data("like",{like_id:q.data.like_id+""});a.call(p)},myerror:function(){this.errormsg()}}).always(function(){p.removeData("locked")})}}if(f){this.delegate(f,"click",d)}else{this.click(d)}return this}})(jQuery);$(function(){$(document).SGalbumlike(".albumlikebtn",{})});(function(a){a.fn.myalbums=function(n,h,k){var j=this;if(j.length<=0){return}if(typeof n!=="function"){k=h;h=n;n=a.noop}if(typeof h!=="string"){k=h;h=""}var b=a.extend({},a.fn.myalbums.defaults,k),q=!!h,f=q?a(h,j):j,l,p,c,g;b.fn=n;m();function d(s){if(!a.G.getUSERID()){return}if(a(b.sel_holder)!=a("body")){l.appendTo(b.sel_holder)}else{l.css({position:"absolute",zIndex:30001,left:s.left+b.biasleft,top:s.top+b.biasleft})}l.css("display",l.css("display")=="block"?"none":"block");if(!j.data("loaded")&&a("a",c).length<=1){c.addClass("loading");a.ajax({cache:false,type:"GET",url:"/album/collect/list/?count=0",mysuccess:function(w,y){c.removeClass("loading");var z=w.data.albums,u=p.val();if(z&&z.length){for(var x=0,t=z.length;x<t;x++){if(!z[x].is_default_album){a("<a "+(u==z[x].id?'class="cur"':"")+' href="#" data-albumid="'+z[x].id+'">'+z[x].name.cut(40,"…")+"</a>").appendTo(c)}}if(u==0){c.find("a").eq(0).addClass("cur")}}j.data("loaded",1)},myfailure:function(t,u){c.removeClass("loading")}})}else{l.find(".cur").removeClass("cur").end().find("a[data-albumid="+p.val()+"]").addClass("cur")}}function o(s,t){p.val(s);j.html(t);c.find(".cur").removeClass("cur").end().find("a[data-albumid="+s+"]").addClass("cur").prependTo(c);c.scrollTop(0);l.css("display","none")}function m(){p=a(b.sel_valueipt);if(!p.length){p=a('<input class="dn" type="text" value="">').appendTo(j)}l=a("#myalbums-wrap");if(!l.length){l=a('<div id="myalbums-wrap" style="display:none"><div id="myalbums-albs"><a data-albumid="0" href="javascript:;">默认专辑</a></div><div class="clr"><form action="/album/add/" method="post"><input type="text" value="" name="name" class="ipt l" maxlength="40"><a target="_self" href="javascript:;" class="abtn l"><button type="submit"><u>创建</u></button></a></form></div></div>').click(function(t){t.stopPropagation()}).appendTo("body");l.find("input").lengthLimit()}a(document).click(function(t){l.css("display","none")});c=a("#myalbums-albs");c.delegate("a","click",function(w){w.preventDefault();var u=this.innerHTML,t=a(this).data("albumid")||0;o(t,u)});var s=a.browser.mozilla?"DOMMouseScroll":"mousewheel";if(navigator.userAgent.toString().match(/ipad/ig)){a('<a id="ipadalbumselectordown" class="ipadalbumsel" href="javascript:;"></a>').appendTo(l).click(function(t){c.get(0).scrollTop+=26}).bind("dblclick",function(t){t.preventDefault();t.stopPropagation()});a('<a id="ipadalbumselectorup" class="ipadalbumsel" href="javascript:;"></a>').appendTo(l).click(function(t){c.get(0).scrollTop-=26}).bind("dblclick",function(t){t.preventDefault();t.stopPropagation()})}c.bind(s,function(t){if(t.originalEvent.wheelDelta){this.scrollTop+=-1*t.originalEvent.wheelDelta}else{this.scrollTop+=t.originalEvent.detail>0?60:-60}t.preventDefault()});l.find("input").click(function(){a(this).focus()});l.find("form").safeSubmit(function(x){var w=this,t=a(w),v=t.find(".abtn"),u=v.find("[type=submit]");if(v.hasClass("abtn-no")){return}v.addClass("abtn-no");a.ajax({url:t.getFormAction(),data:t.paramForm(a.G.getToken(2)),mysuccess:function(z,A){var B=t.find("input"),y=a.trim(B.val());B.val("");c.prepend(a('<a href="#" data-albumid="'+z.data.id+'">'+y.cut(40,"…")+"</a>")).scrollTop(0);o(z.data.id,y)},myfailure:function(y,z){if(y.data&&y.data.robot_check){u.verif({w:1})}else{this.wrongmsg(y)}}}).always(function(){v.removeClass("abtn-no")})});f.bind(b.event,function(t){t.stopPropagation();t.preventDefault();var u=a(this).offset();d(u)})}return l};a.fn.myalbums.defaults={sel_holder:"body",sel_valueipt:"",event:"click",biastop:0,biasleft:0}})(jQuery);(function(m){var j,l=false,d,p,A,a,v,g,f,z=false,q=["收集","收集到","收集"],o;function s(B){SUGAR.PopOut.alert([null,d,""],2)}function n(){g.find("a.abtn").addClass("abtn-no");g.find(".s-sina").css({opacity:0.5,color:"#aaa"})}function t(){g.find("a.abtn").removeClass("abtn-no");g.find(".s-sina").css({opacity:1,color:"#333"})}function c(B,C){v.find("input[name=album]").val(B).end().find("a,span").html(C)}function k(C,B){f.html(B).attr("class",C)}function x(){p.val("");k("","")}function y(B,C){m.G.blinkIt(function(){k("re-postsuc",q[0]+"成功！")},null,function(){SUGAR.PopOut.closeMask();m.isFunction(C)&&C(B);x()},1,800);var D=m(".collection").find("em");if(D.length===1&&B.blog){D.each(function(){D.html(parseInt(D.html())+1)})}}function u(F,C){if(F){var G=m(j);G.addClass("re-done").attr("href","/people/mblog/"+F+"/detail/").attr("target","_blank").attr("title","去看我的收集");if(C){var D=G.closest(".woo").find(".d1"),B="",H=m(".otheralbums h4").find("span").text(),E=parseInt(D.text())||parseInt(H)||0;D.html(E+1).removeClass("dn");if(G.find("em").length){G.find("i").addClass("y-done").end().find("em").html("已收集 "+(E+1))}}}}function w(L,F,C,J,K){z=false;q=["收集","收集到","收集"];b("/people/mblog/forward/",K,C);d.css("display","block");x();t();var D=L.closest(".center");var G,I="";if(D.length){G=D.find(".js-favorite-blogtit");I=G.text()}else{G=L.closest(".woo").find("div.g");I=m("<div>"+G.html()+"</div>").find("a").remove().end().text()}p.val(m.trim(I));m("#re-inp-parent").attr("name","parent").val(F);A.empty().scrollTop(0);var E=D.find(".js-favorite-blogimg"),H,B;if(E.length){H=E.data("width"),B=E.data("height")}else{E=L.closest("div.woo").find("div.mbpho img");H=E.outerWidth(),B=parseInt(E.attr("height"))}if(H>200){B=B*200/H,H=200}$i=m("<img />").attr("src",E.attr("src")).appendTo(A);$i.css({width:H,height:B,marginTop:B<=200?(200-B)/2:0,cursor:B<=200?"default":"move"});m.data(A[0],"imgProp",{height:B});s(L)}function h(O,F,C,M,N,L,K,H){z=H;q=["编辑","转移到","提交"];b("/blog/edit/",N,C,L,K,H);d.css("display","block");x();t();var D=O.closest(".center");var G,J="";if(D.length){G=D.find(".js-favorite-blogtit");J=G.text()}else{G=O.closest(".woo").find("div.g");J=m("<div>"+G.html()+"</div>").find("a").remove().end().text()}p.val(m.trim(J));m("#re-inp-parent").attr("name","blog").val(F);A.empty().scrollTop(0);var E=D.find("img.js-favorite-blogimg");if(E.length){var B=E.data("height"),I=E.data("width"),B=B*200/I,P=m("<img />").attr("src",E.attr("src")).appendTo(A)}else{E=O.closest("div.woo").find("div.mbpho img");var B=parseInt(E.attr("height")),P=m("<img />").attr("src",E.attr("src")).appendTo(A)}P.css({width:200,marginTop:B<200?(200-B)/2:0,cursor:B<=200?"default":"move"});m.data(A[0],"imgProp",{height:B});s(O)}function b(B,I,C,G,F,D){if(!d||!d.length){d=m('<div id="re-favorite"><form action="'+B+'" target="_self"><div id="re-head"><a id="re-close" target="_self" href="javascript:;" onclick="SUGAR.PopOut.closeMask();">关闭</a><h1>'+q[0]+'</h1></div><div id="re-cont" class="clr"><div id="re-left" class="l"></div> <div id="re-right" class="r"> <p>'+q[1]+'</p> <div id="re-albumsel"><input class="dn" type="text" data-optional="1" value="0" name="album"><a id="re-albumtrig" href="javascript:;">默认专辑</a><span id="re-onlyeditwds"></span></div><textarea name="content"'+(q[0]=="编辑"&&(C==m.G.getUSERID()||m.G.isSTAFF())?' class="txa" ':' class="txa txa-no" disabled ')+' data-optional="1" ></textarea> <div id="re-subpan" class="u-chk clr"> <a href="javascript:;" class="abtn l "><button type="submit"><u>'+q[2]+"</u></button></a>"+(typeof BIND_SITES!=o&&BIND_SITES.sina?'<input id="re-sycn-sina" type="checkbox" value="sina" class="chk s-sina" name="syncpost" /><label class="s-sina" title="同步到新浪微博" for="re-sycn-sina">同步</label><div class="re-mbsite s-sina">新浪</div>':"")+'<div id="re-poststat"></div></div></div></div><input id="re-inp-parent" type="hidden" name="parent" value="" data-optional="1" /></form></div>');m.G.store(d);var H=m.G.getYearCookie("sync");m("#re-sycn-sina").prop("checked",H.indexOf("sina")===-1?false:true).change(function(){var M=m(this),L=M.attr("value");H=H.replace(new RegExp(","+L,"ig"),"");if(!M.prop("checked")&&H.indexOf(L)===-1){m.G.setYearCookie("sync",H)}else{if(M.prop("checked")){m.G.setYearCookie("sync",H+","+L)}}});f=m("#re-poststat");v=d.find("#re-albumsel");v.removeClass("re-onlyedit").find("a").myalbums({sel_valueipt:v.find("input[name=album]"),sel_holder:d});A=m("#re-left").mousemove(function(P){P.stopPropagation();if(m.data(this,"movelock")){return}var S=m(this),O=m.data(this,"imgProp")||{},N=O.height;if(N>200){var R=P.pageY,M=A.offset().top,L=R-M-50,L=L<0?0:L,Q;m.data(this,"movelock",true);S.stop().animate({scrollTop:L*(N-200)*2/200},50,"linear",function(){m.data(S[0],"movelock",false)})}});p=d.find("textarea.txa");function E(L){keyupLenLimitForU(L.currentTarget,300,true,true)}p.keyup(E).blur(E).focus(E);keyupLenLimitForU(p[0],300,true,true);m.fn.at&&p.at({isFixed:true});g=d.find("form").safeSubmit(function(P){var M=m(this),R=p.val(),L=v.find("input").val(),Q=m("#re-albumtrig").text(),O=M.find("a.abtn"),N=O.find("[type=submit]");if(O.hasClass("abtn-no")){return}n();k("re-inpost","正在提交，请稍候");m.ajax({url:M.getFormAction(),data:M.paramForm(getToken(2)),success:function(T){var S=m.isPlainObject(T)?T:m.parseJSON(T);if(!S||typeof S!="object"){k("re-posterr","出现异常，可能是网络原因");return}if(!S.data){S.data={}}S.data.content=R;S.data.albumid=L;S.data.albumname=Q;if(S.success){var U=v.find("[name=album]").val(),V=v.find("a").html();if(!z&&U&&U!="0"){m.Bom.removeCookie("sgt");m.Bom.setSubCookie("sgt","ai"+m.G.getUSERID(),U,{expires:30});m.Bom.setSubCookie("sgt","an"+m.G.getUSERID(),V,{expires:30})}y(S.data,I);u(S.data&&S.data.blog,1)}else{if(S.data&&S.data.robot_check){}else{var W=m.trim(mergeServerMessage(S.message));k("re-posterr",W);t();if(W=="你已经收集了该分享"){u()}else{t()}m.G.gaq("/_trc/Error/ajax/response_"+W+"_forward")}}},myerror:function(){k("re-posterr","网络原因导致失败，请稍候再试");t()}}).always(function(){})},function(L){m.G.blinkIt(function(){p.css({backgroundColor:"#d7ebf7"})},function(){p.css({backgroundColor:"#fff"})},function(){p.focus()},4,200)})}else{m.G.store(d)}if(D){v.addClass("re-onlyedit");m("#re-subpan").find("input,label,div.re-mbsite").css("visibility","hidden")}else{v.removeClass("re-onlyedit");m("#re-subpan").find("input,label,div.re-mbsite").css("visibility","visible")}if(typeof G!="undefined"){G=G||"";F=F||"默认专辑";c(G,F)}else{var K=m.Bom.getSubCookie("sgt","ai"+m.G.getUSERID())||"",J=m.Bom.getSubCookie("sgt","an"+m.G.getUSERID())||"默认专辑";c(K,J)}g.attr("action",B);d.find("h1").html(q[0]).end().find("#re-right p").eq(0).html(q[1]).end().find(".abtn u").html(q[2])}m.fn.SGfavorite=function(C){C=C||{};var E=C.etype||"click",D=C.callback;function B(K){if(m(this).hasClass("re-done")){return true}K.stopPropagation();K.preventDefault();var J=m(this),N=J.data("favorite"),N=N?N:J.closest(".collbtn").data("favorite"),I=N?N.id:0,L=m.G.getUSERID(),M=N.owner,G=N.rooter,H;j=this;if(N.edit==true&&(M==L||m.G.isSTAFF())){h(J,I,G,M,D,N.belongalbumid,N.belongalbumname,N.onlyedit)}else{if(M==L){alert("你收集过的，不能再收集哦~");return}if(G==L){alert("你第一次发布的，不能再收集哦~");return}var F=J.parent();if(F.hasClass("collbtn")){m.G.gaq("/_trc/Repost/waterfall/popstart")}w(J,I,G,M,D)}}if(!m.G.getUSERID()){if(!this.attr("title")){this.attr("title","登录才能进行操作哦，点击就可以登录啦")}m(document).on(E,this.selector,function(F){F.stopPropagation();F.preventDefault();SUGAR.PopOut.login();return})}else{m(document).on(E,this.selector,B)}return this};m.fn.SGcomment=function(D){D=D||{};function C(I,H,M,L,N,K,J){var G=N.find(".re-comt");N.find(".re-comt").stop().clearQueue().animate({height:0},200).queue(function(){m.Woo.resetCol(-118,K,J);m.data(L[0],"comment",-1);G.find("textarea").blur()});m.data(L[0],"comment",0)}function F(V,W,I,X,O,T,P,J){if(typeof m.data(X[0],"comment")=="undefined"){var Y=m('<li class="re-comt"><img width="24" height="24" src='+USER.smallAvatar+'><form action="/comment/add/"><div class="pb8"><textarea class="txa" name="content" placeholder="发布评论..."></textarea><a class="abtn l" href="#"><u>评论</u></a></div><input type="hidden" name="_type" value=""/><input type="hidden" value="'+W+'" name="comment_message_id"></form></li>');O.after(Y);m.fn.at&&Y.find("textarea").at({pageMembers:T.find("li p a:first-child")});Y.find("a.abtn").click(function(ac){ac.stopPropagation();ac.preventDefault();var ad=m(this),ab=ad.closest("form"),Z=ab.find("textarea"),aa=m.trim(Z.val());if(!aa){alert("请输入内容！");return}if(ad.hasClass("abtn-no")){return}ad.addClass("abtn-no");m.ajax({url:"/comment/add/",data:ab.paramForm(getToken(2)),mysuccess:function(af,ag){var ae=m(['<li><a href="/myhome/" target="_blank"><img src="',af.data.replyerImg,'" width="24" height="24"></a><p><a href="/myhome/" target="_blank">我</a><br/><span>',af.data.content.replace(/<br\s*\/?>/i," ").replace(/@[\u2E80-\u9FFF\d\w]{1,20}/ig,""),"</span></p></li>"].join(""));Y.before(ae.css("display","none"));Z.val("");ae.slideDown(200,function(){m.Woo.resetCol(ae.outerHeight(true),P,J)});var ai=ad.closest(".woo").find(".d3"),ah=parseInt(ai.text())||0;ai.html(++ah).removeClass("dn")},myerror:function(){this.errormsg()}}).always(function(){ad.removeClass("abtn-no")})})}var Q=m(window),N=Q.height(),H=Q.scrollTop(),M=T.find(".re-comt"),R=M.offset(),K=R.top,L=K+118-(N+H);if(L>0){var S=m.browser,G=S.webkit,U=G?m("body"):m("html");U.animate({scrollTop:"+="+L},400,function(){})}M.stop().clearQueue().animate({height:118},200).queue(function(){m.Woo.resetCol(118,P,J);m.data(X[0],"comment",1);M.find("textarea").focus()});m.data(X[0],"comment",0)}function B(L){L.stopPropagation();L.preventDefault();var J=m(L.target).closest("a"),G=J.closest(".woo"),H=G.find(".f").last(),K=G.find("li").not(".re-comt").last(),S=J.closest(".collbtn").data("favorite"),S=S?S:H.data("favorite"),Q;if(!H.length&&S&&S.id){window.location.href="/people/mblog/"+S.id+"/detail/#reply";return}else{Q=m.data(H[0],"comment")}if(Q===0){return}var I=S.id,N=S.owner,R=m.data(m("#woo-holder")[0],"zindex")||10,Q=Q==o||Q<0?false:true,P=G[0].className,M=m.G.getNum(P.match(/\bco\d+\b/ig).toString()),O=parseInt(G.css("top"))||0;G.css("zIndex",++R);m.data(m("#woo-holder")[0],"zindex",R);if(Q){C(J,I,N,H,G,M,O)}else{F(J,I,N,H,K,G,M,O)}}var E="click";if(!m.G.getUSERID()){this.attr("title","登录才能评论，点击下就可以登录啦");m(document).on(E,this.selector,function(G){G.stopPropagation();G.preventDefault();SUGAR.PopOut.login();return})}else{m(document).on(E,this.selector,B)}return this};m.fn.SGlike=function(D){D=D||{};function F(H,G){if(H.hasClass("no-sub")){return}H.addClass("no-sub");m.ajax({url:"/like/",data:"object_id="+G+"&category=1&"+getToken(1),mysuccess:function(K,L){H.addClass("re-zan");var N=H.closest(".woo").find(".d2"),J=H.closest(".action").find("em"),I=N.html(),M=0,O;if(H.data("like")){H.data("like").likeid=K.data.like_id}else{H.data("like",{likeid:K.data.like_id+""})}if(I){M=parseInt(I)+1}else{M=1}N.length&&N.html(M).removeClass("dn")&&(H.find("i").length?H.find("i").html(M).addClass("z-done"):H.html(M).addClass("z-done"));if(J.length){J.each(function(){m(this).html(parseInt(J.html())+1)})}},myerror:function(){this.errormsg()}}).always(function(){H.removeClass("no-sub")})}function C(H,G){if(H.hasClass("no-sub")){return}if(H.data("like")){G=H.data("like").likeid}if(!G){return}H.addClass("no-sub");m.ajax({url:"/unlike/",data:"like_id="+G+"&"+getToken(1),mysuccess:function(K,L){H.removeClass("re-zan");var N=H.closest(".woo").find(".d2"),J=H.closest(".action").find("em"),I=N.html(),M=0,O;if(parseInt(I)>1){M=parseInt(I)-1}else{M=0}N.length&&(M?N.html(M):N.html(M).addClass("dn"))&&(H.find("i").length?H.find("i").html(M).removeClass("z-done"):H.html(M).removeClass("z-done"));if(J.length){J.each(function(){m(this).html(parseInt(J.html())-1<0?0:parseInt(J.html())-1)})}},myerror:function(){this.errormsg()}}).always(function(){H.removeClass("no-sub")})}function B(J){J.stopPropagation();J.preventDefault();var M=m(this),H=M.data("favorite"),H=H?H:M.closest(".collbtn").data("favorite"),G=H.id,L=H.owner,I=H.likeid,K;if(M.hasClass("re-zan")){C(M,I)}else{F(M,G)}}var E="click";if(!m.G.getUSERID()){if(!this.attr("title")){this.attr("title","登录之后才能赞哦！")}m(document).on(E,this.selector,function(G){G.stopPropagation();G.preventDefault();SUGAR.PopOut.login();return})}else{m(document).on(E,this.selector,B)}}})(jQuery);function callFavOffset(d){if(d.length){var c=d.find("div.woo-pcont:visible").offset(),b=c.top,a=c.left,f=parseInt(d.css("marginLeft"))||0;d.data("offset",{left:a-f,top:b})}}function callFavorite(){$("div.woo .collbtn .y").SGfavorite();$("div.woo .collbtn .x").SGcomment();$("div.woo .collbtn .z").SGlike();var c=$("#woo-holder"),d=$(window);if(c.length){var h=$.browser.msie,b=h&&$.browser.version==="6.0",f=-20,g=0,a=65;function j(l,k){if(k){l.addClass("woocov")}else{l.removeClass("woocov")}}if(b){c.delegate("div.woo","mousemove",function(o){callFavOffset(c);var p=$(this),k=parseInt(p.css("top"))||0,n=d.scrollTop(),m=c.data("offset"),l=m.top;j(p.find(".a u"),true);p.find(".collbtn").css({display:"block",top:Math.max(n-(l+k)-g+a,g)})})}else{c.delegate("div.woo","mouseenter",function(q){callFavOffset(c);var s=$(this),l=s.find(".collbtn"),m=parseInt(s.css("top"))||0,p=d.scrollTop(),o=c.data("offset"),n=o.top;j(s.find(".a u"),true);$("#collbtn").css("display","none").removeAttr("id").addClass("collbtn");l.attr("id","collbtn").addClass("collbtn");if(p-(n+m)+f+g+a>0){var k=s.offset().left;l.css({left:k,position:"fixed",top:g+a,display:"block"})}else{l.css({position:"absolute",left:0,top:g,display:"block"})}});c.delegate("div.woo","mousemove",function(l){var m=$(this),k=m.find(".collbtn");if($("#collbtn")[0]!=k[0]){$("#collbtn").css("display","none").removeAttr("id").addClass("collbtn")}k.attr("id","collbtn").addClass("collbtn")})}c.delegate("div.woo","mouseleave",function(k){var l=$(this);j(l.find(".a u"),false);l.find(".collbtn").css("display","none").removeAttr("id").addClass("collbtn")})}}$(function(){var a=$("#woo-holder");if(a.length){var b=$(window);b.scroll(function(){var l=b.scrollTop();var m=$("#collbtn");if(m.length&&!ie6){var n=a.data("offset"),g=0,f;if(n){var h=m.closest("div.woo"),c=parseInt(h.css("top"))||0,j=n.top,d=-20,k=65;if(l-(j+c)+d+g+k>0){var o=h.offset().left;h.find(".collbtn").css({left:o,position:"fixed",top:g+k,display:"block"})}else{h.find(".collbtn").css({position:"absolute",left:0,top:g,display:"block"})}}}})}});(function(a){a.fn.SGfollow=function(g,c,f){if(typeof g!=="function"){f=c;c=g;g=a.noop}if(typeof c!=="string"){f=c;c=""}f=a.extend({},f);var h=function(){var k=this,j=k.data("follow");if(j.rel>1){k.addClass("follow followed").removeClass("unfollow followeo")}else{k.addClass("follow").removeClass("unfollow")}k.html("<i></i>关注");j.rel+=-1};var d=function(){var k=this,j=k.data("follow");if(j.rel>1){k.addClass("unfollow followeo").removeClass("follow followed")}else{k.addClass("unfollow").removeClass("follow")}k.html("<i></i>已关注");j.rel+=1};var b=function(l){l.preventDefault();if(!a.G.getUSERID()){SUGAR.PopOut.login();return}var p=a(this),k=p.data("follow"),o=k.id,j="/people/follow/del/",n="/people/follow/add/",m;if(p.data("locked")){return}p.data("locked",1);a.ajax({url:k.rel%2?j:n,data:"follow_id="+o+"&"+getToken(),mysuccess:function(q,s){k.rel%2?h.call(p):d.call(p)}}).always(function(){p.removeData("locked")})};if(c){this.delegate(c,"click",b)}else{this.click(b)}return this}})(jQuery);$(function(){if($.G.getUSERID()){return}var a=$.browser.msie&&$.browser.version==="6.0",f=$.G.getCookie("ie6updated"),d;if(a&&!f){var c=$('<div id="pop-ie6update">想获得更好的浏览体验，堆糖建议你更新浏览器。推荐使用：<div class="clr ie6browser"><a target="_blank" class="chrome" href="http://www.google.cn/chrome/intl/zh-CN/landing_chrome.html?hl=zh-cn">Chrome</a><a target="_blank" class="jisu360" href="http://chrome.360.cn/">360极速</a><a target="_blank" class="ie9" href="http://www.microsoft.com/zh-cn/download/internet-explorer-8-details.aspx">IE8</a><a target="_blank" class="firefox" href="http://firefox.com.cn/download/">Firefox</a></div><div class="tr SG-sidebar mt8"><a href="javascript:;" class="SG-sideclose r graylk">知道了</a></div></div>').sidepop({id:"side-ie6update",dockSide:"left",width:"auto",scroll:2,departure:-4,baseline:"bottom",bias:-4,isFixed:true,zIndex:800,btnset:0}).closest(".side-ie6update");c.find(".SG-sideclose").click(function(g){$.G.setCookie("ie6updated",1)})}var b=function(){var j=$(window).scrollTop(),g=$(window).height(),h;if(a&&!f){c.css("visibility",j>1000?"visible":"hidden")}};$(window).scroll(b);b()});(function(b){var c,a;b.fn.verifCallBack=function(d){var g=b(window);g.data("verif",d.code);if(c){var h=b("#ver-iframe").closest(".mask-body"),f=h.closest(".blockPage");b.G.store(h),a.removeClass("abtn-no"),SUGAR.PopOut.go(-1),c.click();window.setTimeout(function(){b(window).removeData("verif")},100)}};b.fn.verif=function(g){var j=b(this),h=b.extend(true,{},b.fn.verif.defaults,g);f();function f(){c=j,a=j.attr("tagName")=="a"?j:j.closest("a"),d()}function d(){var k=b("#ver-iframe");if(!k.length){k=b('<iframe id="ver-iframe" style="display:block !important;width:100%;height:200px;" name="ver-iframe" src="about:blank" frameborder="0" scrolling="no"></iframe>')}k.attr("src","/webp/verif/");if(h.w){SUGAR.PopOut.alert(["请输入验证码",k],1)}}}})(jQuery);(function(b,c){var a=(function(){function f(h){this.url=h;(function(j){function k(){b.$.ajax({url:h,type:"GET",dataType:"json",cache:false,timeout:9999999,xhrFields:{withCredentials:true},crossDomain:true,complete:function(){if(j.onopen&&j.onopen.call){j.onopen.call(j.onopen)}},success:function(m,l){if(j.onmessage&&j.onmessage.call){j.onmessage.call(j.onmessage,{code:l,data:JSON.stringify(m)})}k()},error:function(){if(j.onerror&&j.onerror.call){j.onerror.call(j.onerror)}if(j.onclose&&j.onclose.call){j.onclose.call(j.onclose)}}})}k()})(this)}var g=f.prototype;g.send=function(h){b.$.ajax({url:this.url,type:"POST",dataType:"json",data:{msg:h},xhrFields:{withCredentials:true},crossDomain:true})};return f})();var d=(function(){function g(){this.supportWs="WebSocket" in b;this.url="http://ws.duitang.com/ws";this.wsUrl="ws://ws.duitang.com/ws";this.handlerList=[];this._handlerTrash=[];this.handlerMap={};this.ws=null;this.connectedTime=0;this.maxConnectedTime=30;this.connect()}var f=g.prototype;f.connect=function(){var h=this;if(!h.supportWs){h.ws=new a(h.url)}else{h.ws=new b.WebSocket(h.wsUrl)}$.get("/napi/da/?action=connect");h.connectedTime++;h.ws.onmessage=function(p){var o=JSON.parse(p.data),m=o.data.content_type.toLowerCase(),n=h.handlerMap[m];for(var k=0,j=h.handlerList.length;k<j;k++){h.handlerList[k].call(h.handlerList[k],o)}if(!n||!n.length){return}for(k=0,j=n.length;k<j;k++){n[k].call(n[k],o.data.content)}};h.ws.onopen=function(j){$.get("/napi/da/?action=onopen")};h.ws.onclose=function(j){if(h.connectedTime>h.maxConnectedTime){return}b.setTimeout(h.connect,300)}};f.on=function(k,j){var h=k.toLowerCase(),l=this.handlerMap[h];if(l){l.push(j);return}this.handlerMap[h]=[j]};f.handle=function(h){this.handlerList.push(h)};f.clearHandler=function(){this._handlerTrash=this.handlerList;this.handlerList=[]};return g})();b.$.G.ws=new d();b.$.G.ws.on("websocket",function(){new d()})})(window);(function(a){a.fn.uploadpic=function(m,g,j){var h=this;if(h.length<=0){return}if(typeof m!=="function"){j=g;g=m;m=a.noop}if(typeof g!=="string"){j=g;g=""}var b=a.extend({},a.fn.uploadpic.defaults,j),f;b.fn=m;l();function l(){var o=h;if(g){h.delegate(g,"mousemove",d).delegate(g+" "+b.sel_input,"change",c)}else{h.bind("mousemove",d).delegate(b.sel_input,"change",c);o=h.closest(b.sel_holder)}o.delegate("a.uploadpic-delthepic","click",n);h.delegate(g+" "+b.sel_input,"click",k)}function n(s){var q=a(this),p=q.closest(b.sel_holder),o=p.find(b.sel_uploading),t=p.find(b.sel_uploaded);p.find(b.sel_normal).removeClass("dn");o.addClass("dn");t.addClass("dn");t.find("a.uploadpic-thepic").remove();p.find("a.abtn-no").removeClass("abtn-no")}function k(p){if(!a.G.getUSERID()){p.preventDefault();p.stopPropagation();SUGAR.PopOut.login();return}var o=a(this);if(o.closest("a").hasClass("abtn-no")){p.preventDefault();p.stopPropagation()}}function d(q){var p=a(this),o=p.offset();p.find(b.sel_input).css({left:q.pageX-o.left-70,top:q.pageY-o.top-10})}function c(){var s=a(this),p=s.closest(b.sel_form),q=a(getToken(3)),o=parseInt(Math.random()*10000000000);if(s.val()===""){return}b.onupload();p.find("input[name=tid]").val(o).attr("uploadpic-tid",o).data("uploadpic-config",b).data("uploadpic-callback",function(B,w){var t=B.data("uploadpic-config");var x=B.closest(t.sel_holder);if(w.success){var u=x.find(t.sel_input),y=u.val();x.find(t.sel_form).closest("a").addClass("abtn-no").end().find("a.uploadpic-thepic").remove();var v=x.find(t.sel_input).blur();var z=v.clone();v.replaceWith(z);var A=x.find(t.sel_uploaded).removeClass("dn").prepend('<a class="uploadpic-thepic graylk" href="'+w.src+'" target="_blank">'+y.substr(y.lastIndexOf("\\")+1)+"</a>");if(!A.find("a.uploadpic-delthepic").length){A.append('<a class="uploadpic-delthepic ml8 mr8" href="javascript:;">x删除</a>')}}else{x.find(t.sel_error).removeClass("dn").html(mergeServerMessage(w.message)).end().find("a.abtn-no").removeClass("abtn-no")}x.find(t.sel_uploading).addClass("dn");if(a.isFunction(t.fn)){t.fn(w,x,t)}}).end().append(q).submit();q.remove();s.closest(b.sel_holder).find(b.sel_normal).addClass("dn").end().find(b.sel_error).addClass("dn").end().find(b.sel_uploaded).addClass("dn").end().find(b.sel_uploading).removeClass("dn");p.closest("a").addClass("abtn-no")}return this};a.fn.uploadpic.defaults={onupload:a.noop,sel_holder:"",sel_form:"",sel_input:"input[type=file]",sel_normal:"",sel_error:"",sel_uploading:"",sel_uploaded:""};a.fn.uploadpic.upPicCallBack=function(b){if(a.isPlainObject(b)){var c=a("input[uploadpic-tid="+b.tid+"]");if(c.length&&a.isFunction(c.data("uploadpic-callback"))){c.data("uploadpic-callback")(c,b)}}}})(jQuery);var template=function(b,a){return template[typeof a=="object"?"render":"compile"].apply(template,arguments)};(function(m,w){m.version="1.4.0",m.openTag="<%",m.closeTag="%>",m.parser=null,m.render=function(c,a){var f=h(c);return f===undefined?p({id:c,name:"Render Error",message:"Not Cache"}):f(a)},m.compile=function(f,n){function a(t){try{return(new l(t)).template}catch(s){return c?(s.id=f||n,s.name="Render Error",s.source=n,p(s)):m.compile(f,n,!0)(t)}}var c=arguments[2];typeof n!="string"&&(c=n,n=f,f=null);try{var l=k(n,c)}catch(y){return y.id=f||n,y.name="Syntax Error",p(y)}return a.prototype=l.prototype,a.toString=function(){return l.toString()},f&&(g[f]=a),a},m.helper=function(c,a){q[c]=a};var g={},b="".trim,j=b&&!w.document,x={},d=function(){var a=Array.prototype.forEach||function(l,c){var o=this.length>>>0;for(var f=0;f<o;f++){f in this&&l.call(c,this[f],f,this)}};return function(c,f){a.call(c,f)}}(),v=Object.create||function(c){function a(){}return a.prototype=c,new a},q=m.prototype={$forEach:d,$render:m.render,$getValue:function(a){return a===undefined?"":a}};d("break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield".split(","),function(a){x[a]=!0});var k=function(F,I){function z(c){return H+=c.split(/\n/).length-1,c=c.replace(/('|"|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n"),c=J[1]+"'"+c+"'"+J[2],c+"\n"}function a(f){var c=H;return K?f=K(f):I&&(f=f.replace(/\n/g,function(){return H++,"$line="+H+";"})),f.indexOf("=")===0&&(f=f.substring(1).replace(/[\s;]*$/,""),b&&(f="$getValue("+f+")"),f=J[1]+f+J[2]),I&&(f="$line="+c+";"+f),s(f),f+"\n"}function s(c){c=c.replace(/\/\*.*?\*\/|'[^']*'|"[^"]*"|\.[\$\w]+/g,""),d(c.split(/[^\$\w\d]+/),function(f){if(/^this$/.test(f)){throw {message:'Prohibit the use of the "'+f+'"'}}if(!f||x.hasOwnProperty(f)||/^\d/.test(f)){return}Q.hasOwnProperty(f)||(G(f),Q[f]=!0)})}function G(f){var c;f==="print"?c=u:f==="include"?c=U:q.hasOwnProperty(f)?c="$helpers."+f:c="$data."+f,B+=f+"="+c+","}var L=m.openTag,P=m.closeTag,K=m.parser,R=F,M="",H=1,Q={$out:!0,$line:!0},B="var $helpers=this,"+(I?"$line=0,":""),J=b?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],O=b?"if(content!==undefined){$out+=content;return content}":"$out.push(content);",u="function(content){"+O+"}",U="function(id,data){if(data===undefined){data=$data}var content=$helpers.$render(id,data);"+O+"}";d(R.split(L),function(l,c){l=l.split(P);var y=l[0],f=l[1];l.length===1?M+=z(y):(M+=a(y),f&&(M+=z(f)))}),R=M,I&&(R="try{"+R+"}catch(e){e.line=$line;throw e}"),R=B+J[0]+R+"this.template="+J[3];try{var A=new Function("$data",R),D=A.prototype=v(q);return D.toString=function(){return this.template},A}catch(o){throw o.temp="function anonymous($data) {"+R+"}",o}},h=function(a){var f=g[a];if(f===undefined&&!j){var c=document.getElementById(a);return c&&m.compile(a,c.value||c.innerHTML),g[a]}if(g.hasOwnProperty(a)){return f}},p=function(c){function a(){return a+""}var f="[template]:\n"+c.id+"\n\n[name]:\n"+c.name;return c.message&&(f+="\n\n[message]:\n"+c.message),c.line&&(f+="\n\n[line]:\n"+c.line,f+="\n\n[source]:\n"+c.source.split(/\n/)[c.line-1].replace(/^[\s\t]+/,"")),c.temp&&(f+="\n\n[temp]:\n"+c.temp),w.console&&console.error(f),a.toString=function(){return"{Template Error}"},a}})(template,this),typeof module!="undefined"&&module.exports&&(module.exports=template);(function(){if(!($.History||false)){$.History={options:{debug:false},timer:null,state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},extractHash:function(a){var b=a.replace(/^[^#]*#/,"").replace(/^#+|#+$/,"");return b},getState:function(){var a=$.History;return a.state},setState:function(b){var a=$.History;b=a.extractHash(b);a.state=b;return a.state},getHash:function(){var a=$.History;var b=a.extractHash(window.location.hash||location.hash);return b},setHash:function(b){var a=$.History;b=a.extractHash(b);if(typeof window.location.hash!=="undefined"){if(window.location.hash!==b){window.location.hash=b}}else{if(location.hash!==b){location.hash=b}}return b},go:function(d){var a=$.History;d=a.extractHash(d);var c=a.getHash(),b=a.getState();if(d!==c){a.setHash(d)}else{if(d!==b){a.setState(d)}a.trigger()}return true},hashchange:function(h,d,c){var f=$.History;if(!f.nativeSupport&&!f.notSupportTrigger){f.nativeSupport=true;if(f.timer){clearInterval(f.timer)}if(f.firedFirstTime){return false}}else{f.firedFirstTime=true;f.notSupportTrigger=false}var g=f.getHash();f.go(g);return true},bind:function(c,a){var b=$.History;if(a){if(typeof b.handlers.specific[c]==="undefined"){b.handlers.specific[c]=[]}b.handlers.specific[c].push(a)}else{a=c;b.handlers.generic.push(a)}return true},trigger:function(f){var c=$.History;if(typeof f==="undefined"){f=c.getState()}var a,g,b,d;if(typeof c.handlers.specific[f]!=="undefined"){d=c.handlers.specific[f];for(a=0,g=d.length;a<g;++a){b=d[a];b(f)}}d=c.handlers.generic;for(a=0,g=d.length;a<g;++a){b=d[a];b(f)}return true},construct:function(){var a=$.History;$(document).ready(function(){a.domReady()});return true},configure:function(a){var b=$.History;b.options=$.extend(b.options,a);return true},domReadied:false,domReady:function(){var a=$.History;if(a.domRedied){return}a.domRedied=true;a.$window=$(window);a.$window.bind("hashchange",this.hashchange);a.nativeSupport=a.nativeSupport();setTimeout(a.hashchangeLoader,200);return true},nativeSupport:function(c){c=c||$.browser;var b=c.version,a=parseInt(b,10),g=b.split(/[^0-9]/g),f=parseInt(g[0],10),d=parseInt(g[1],10),j=parseInt(g[2],10),h=false;if((c.msie||false)&&a>=8){h=true}else{if((c.webkit||false)&&a>=528){h=true}else{if((c.mozilla||false)){if(f>1){h=true}else{if(f===1){if(d>9){h=true}else{if(d===9){if(j>=2){h=true}}}}}}else{if((c.opera||false)){if(f>10){h=true}else{if(f===10){if(d>=60){h=true}}}}}}}return h},hashchangeLoader:function(){var b=$.History;if(!b.nativeSupport){var a;if($.browser.msie){b.$iframe=$('<iframe id="jquery-history-iframe" style="display: none;"></iframe>').prependTo(document.body)[0];b.$iframe.contentWindow.document.open();b.$iframe.contentWindow.document.close();var d=false;a=function(){var h=b.getHash();var g=b.getState();var f=b.extractHash(b.$iframe.contentWindow.document.location.hash);if(g!==h){if(!d){b.$iframe.contentWindow.document.open();b.$iframe.contentWindow.document.close();b.$iframe.contentWindow.document.location.hash=h}d=false;b.notSupportTrigger=true;b.$window.trigger("hashchange")}else{if(g!==f){d=true;b.setHash(f)}}}}else{a=function(){var g=b.getHash();var f=b.getState();if(f!==g){b.notSupportTrigger=true;b.$window.trigger("hashchange")}}}b.timer=setInterval(a,2000)}else{var c=b.getHash();if(c){b.$window.trigger("hashchange")}}return true}};$.History.construct()}else{window.console.warn("$.History has already been defined...")}})();(function(j,f){var b=j.location,k=$(j),d,t,m=$.History,s=0,c=false,l=false,n=false,q=false,o=false,g,h,x,u,v=[],a=[],w;var p=function(y){p.init(y)};$.extend(p,{dfConf:{formprefix:"#woo-form-",frame:["#woo-holder",".woo-swa",".woo-swb",".woo-pcont",".woo-pager",".woo-masned"],gopre:null,gonext:null,gotop:null,footer:null,unit:".woo",anchor:"woo-anchor",anchordiff:70,sink:$(null),sinkheight:0,sinkright:false,unitsnum:24,subpagenum:4,scrollwait:100,lbias:400,appendnum:12,batchopen:false,batchdelay:6,batchnum:2,nearbypagenum:3,ajaxdatatype:"text",ajaxcache:false,resize:false,refreshwhenswitch:false,exrecycle:false,exrecycletop:0.5,exrecyclebot:1,onScroll:function(y){},onFirstArrange:function(y){},onOnePageOver:function(z,y){},onLazyAddOver:function(z,y){},onTabSwitch:function(C,y,z,A,B){},requestAlways:function(z,y){}},init:function(F){if(typeof F.arrsplit==="string"){var B=F.arrsplit;F.arrsplit=[]}if(typeof F.arrmasnw==="number"){var C=F.arrmasnw;F.arrmasnw=[]}if(typeof F.arrmessw==="number"){var G=F.arrmessw;F.arrmessw=[]}if(typeof F.arrmargin==="number"){var I=F.arrmargin;F.arrmargin=[]}if(typeof F.arrfmasnw==="number"){var E=F.arrfmasnw;F.arrfmasnw=[]}if(typeof F.arrgap==="number"){var H=F.arrgap;F.arrgap=[]}for(var D=0;D<F.arrform.length;D++){B!==A&&F.arrsplit.push(B),C!==A&&F.arrmasnw.push(C),G!==A&&F.arrmessw.push(G),I!==A&&F.arrmargin.push(I),E!==A&&F.arrfmasnw.push(E);H!==A&&F.arrgap.push(H)}p._varClean();this.conf=$.extend({},this.dfConf,F);var F=this.conf,z=F.frame,y=$(z[1]),J=$(z[2]),A;this.$holder=u=$(z[0]);if(!u.length||!y.length||!J.length){return}this.$conts=J,this.$gonext=$(F.gonext),this.$gopre=$(F.gopre),this.$gotop=$(F.gotop),this.$footer=$(F.footer);w=p.WooTemp;d=k.height();if(m&&!m.getHash()||!m){p._switch(y,J)}m&&m.bind(function(L){if(!l){p._switch(y,J)}else{l=false}var M=L.split("-p"),K=parseInt(M[1])||1;if(K>1){p.$gopre.css("display","block")}else{p.$gopre.css("display","none")}});this.setClickGoPre(),this.setClickGoNext(),this.setClickGoTop();k.unbind("scroll.woo").bind("scroll.woo",p._winScroll),k.unbind("resize.woo").bind("resize",p._winResize)},_varClean:function(){c=false,l=false,n=false,q=false,v=[],a=[],p.masn=[],p.pagine=[]},_winScroll:function(){n=true;j.clearTimeout(x);x=j.setTimeout(function(){n=false},p.conf.scrollwait);var y=k.scrollTop();p.$gotop.css("visibility",y>100?"visible":"hidden")},_winResize:function(){p.throttle(function(){d=k.height();var y=p.conf;if(y.resize&&!y.exrecycle&&t!=(t=k.width())){p.resize()}},100)},$holder:$(null),masn:[],pagine:[],resetCol:function(y,D,C){var A=u.find(this.conf.frame[5]+":visible").not(".woo-tmpmasn"),z=p._getDataColY(A);if(z&&z[D]){z[D]+=y;var B=Math.max.apply(Math,z);A.data("colY",z).css({height:B});u.find("div.co"+D).each(function(E,G){var F=parseInt(G.style.top);if(F>C){G.style.top=(F+y)+"px"}})}},throttle:function(z,y){j.clearTimeout(p.throttle.timer);p.throttle.timer=setTimeout(function(){z.call(this)},y)},resize:function(){for(var y=0;y<a.length;y++){var z=a[y];if(y===s&&z){z.setCols(),z.figure(),z.arrangeContents(true)}else{if(z){z.resetDomWidth()}}}},recurseDo:function(A,y,C,z,B){if(C==0){if($.isFunction(B)){B()}return}y=A.apply(null,y);if(y[0].length){j.setTimeout(function(){p.recurseDo(A,y,--C,z,B)},z)}else{if($.isFunction(B)){B()}}},getFormAction:function(y){return encodeURI(y.attr("action"))},paramForm:function(y,A){var z={};$("input,select,textarea",y).not("[type=submit]").filter("[name]").each(function(C,B){if(($(B).attr("type")==="checkbox"||$(B).attr("type")==="radio")&&$(B).prop("checked")===true||($(B).attr("type")!=="checkbox"&&$(B).attr("type")!=="radio")){if(z[B.name]!==f){z[B.name]+=","+B.value}else{z[B.name]=B.value}}});if($.isPlainObject(A)){$.extend(z,A)}return $.param(z)},scrollTo:function(A,D,E){if(typeof jQuery!=="undefined"){$("body,html").animate({scrollTop:A},D,E);return}var y=parseInt(document.body.scrollTop),B=0,C=10;A=parseInt(A);D/=C;var z=setInterval(function(){B++;document.body.scrollTop=(A-y)/D*B+y;document.documentElement.scrollTop=(A-y)/D*B+y;if(B>=D){$.isFunction(E)&&E();clearInterval(z)}},C)},scrollToAnchor:function(){var z=$("body,html"),A=p.conf;$tohsh=$("a[name="+A.anchor+"]");if(A.anchor&&$tohsh.length){var y=$tohsh.offset().top-A.anchordiff||0;p.scrollTo(y,200)}else{if(!!j.ActiveXObject&&!j.XMLHttpRequest){p.scrollTo(y,200)}}},_clickGoTop:function(A){A.preventDefault(),A.stopPropagation();q=true;var z=this,y=$("body,html");p.scrollTo(0,200,function(){z.style.visibility="hidden",q=false})},setClickGoTop:function(){p.$gotop.unbind("click.woo").bind("click.woo",p._clickGoTop)},_clickGoPre:function(y){y.preventDefault();p._clickGo.call(this,-1)},setClickGoPre:function(){p.$gopre.unbind("click.woo").bind("click.woo",p._clickGoPre)},_clickGoNext:function(y){y.preventDefault();p._clickGo.call(this,1)},setClickGoNext:function(){p.$gonext.unbind("click.woo").bind("click.woo",p._clickGoNext)},_clickGo:function(B){var A=p.conf;$(this).css("display","none");if(v&&v[s]&&a&&a[s]){var z=u.find(A.frame[4]+":visible"),C=z.find(".woo-pbr").length,y=v[s]&&v[s].hasNextUpperPage,D=C&&y?false:true;if(C&&!y){return}v[s].isPagerClick=true;if(D){v[s].loading=false;v[s].lazyAdding=true;v[s].halting=true}v[s].slidePage(B,true)}},_switch:function(C,y){var z=p.conf,B=z.frame,A=z.arrform;C.unbind("click.woo").tabswitch(function(I,G,D,J,K){var E=I.eq(D),F=p._getPageNumFromHash();$.Woo.conf.onTabSwitch(I,G,D,J,K);if(!K){}else{F=v[D]&&D!=J&&!p.conf.refreshwhenswitch?v[D].getPageNum():1;c=true;l=true;if(m){var H="!"+A[D];m.setHash(H+(F>1?"-p"+F:""))}G.eq(D).find(p.conf.frame[3]).last().css("height",d)}if(v[J]){v[J].idata=[];v[J].$data=$(null)}p._pageInit(y,D,F)},{event:"click.woo",focus:"woo-cur",cont:B[2],index:p._getFocusIdx(C)})},_pageInit:function(I,ac,aa){p.idx=s=ac,o=false;j.clearTimeout(g);var ab=this.conf,z=ab.frame,R=ab.arrform,E=ab.arrsplit,F=ab.arrmasnw,J=ab.arrmessw,X=ab.arrmargin,Y=ab.arrfmasnw,ad=ab.arrgap,Q=$.isArray(E)?E[ac]:"",C=I.eq(ac),ae=C.find(z[3]).not(".woo-tmpmasn"),N=C.find(z[4]),D=parseInt(ae.data("totalunits")),ag=isNaN(D),af=ae.data("wootemp")||0,ah=ae.data("subpagenum")||ab.subpagenum,y=ae.data("unitsnum")||ab.unitsnum,A=ae.data("sink")?$(ae.data("sink")):$(ab.sink),S=ae.data("sinkheight")||ab.sinkheight,P=!!ae.data("sinkright")||ab.sinkright,T=ag?2:Math.ceil(D/y),Z=!!Y[ac],M=F[ac],B=$.isArray(J)?J[ac]:null,M=B?M-B:M,U=X[ac],G=ad[ac],H=Z?M+Y[ac]:M,O=H!=M,K=T>2?false:true,L;this.$footer.css("display",T==1?"block":"none");if(!v[ac]){var W,V=$(null);this.masn[ac]=a[ac]=new p.Masn(ae,{unit:ab.unit,gap:G||0,onAppend:p._doLoadImage,onFirstArrange:ab.onFirstArrange,onArrange:function(ai){if(ai.length){W=2;V=ai}if(v[ac]){v[ac].caching=1;v[ac].$data=ai}if(h){j.clearTimeout(h)}p._onscroll()},initAppendCounts:y,sinkWhat:A,firstHeight:S,rightAlignFirstBlock:P,specialColumnOpen:O,firstColumnWidth:H,columnMessWidth:B,columnWidth:M,columnMargin:U,batchOpen:ab.batchopen,batchDelay:ab.batchdelay,batchNum:ab.batchnum});this.pagine[ac]=v[ac]=new p.Pagine([ae,N],{identity:"!"+R[ac],arrRequestUrl:[$(ab.formprefix+R[ac])[0],Q],requestAlways:ab.requestAlways,onOnePageOver:ab.onOnePageOver,ajaxDataType:ab.ajaxdatatype,ajaxCache:ab.ajaxcache,scrollBias:ab.lbias,nearbyPageNum:ab.nearbypagenum,subPageNum:ah,unitsPerSub:y,currentUpperPage:aa,totalPageNum:T,caching:W,$data:V,nextMode:K,analyzeResponse:w?w.analyzeResponse[af]:$.noop,lazyAdd:function(ai){var aq=this,ar=aq.config;if(aq.$data.length===0&&aq.idata.length===0){aq.caching=0;if(aq.isLastSub()){aq.showFooter()}return}aq.lazyAdding=true,aq.caching=1;var au=aq.$data,av=aq.idata,an=au&&au.length||0,ak=av&&av.length||0,aj=an+ak,ao=ai?Math.max(aj+1,ar.unitsPerSub):p.conf.appendnum,at=an+ak-ao,aw=false;if(ai&&a[ac]){a[ac].clearColY(),aw=true}var am,al;if(ao<=an){am=au.slice(0,ao),aq.$data=au.slice(ao)}else{am=au,aq.$data=$(null),al=av.slice(0,ao-an),aq.idata=av.slice(ao-an)}var ap=w&&w.render[af]?w.render[af](al):al;a[ac].appendContents(am,ap,false,false,aw,p.conf.batchnum,function(){if(at<=0){aq.caching=0;var ay=aq.currentPage,ax=ar.subPageNum;if(ay%ax===0&&aq.currentPage!=aq.totalPageNum){j.setTimeout(function(){aq.prepareNext()},400)}if(aq.isLastSub()){aq.showFooter()}}else{aq.caching=at<=ar.unitsPerSub?1:2,aq.$pager.css({height:0,overflow:"hidden"})}j.setTimeout(function(){aq.lazyAdding=false;p.conf.onLazyAddOver(aq,s)},200)})}})}else{if(!v[ac].lazyAdding&&!v[ac].loading||!c){v[ac].lazyAdding=true,v[ac].scrollLoading=true,a[ac].standardUnitCount=0,a[ac].setCols();v[ac].refreshPage(aa)}}c=false,p.$gonext.css("visibility","hidden")},_getIdentityFromHash:function(){var y="";if(m){y=m.getHash(),y=y.split("-")[0]}return y},_getPageNumFromHash:function(){var z=1;if(m){var y=m.getHash();y=y.split("-p")[1];if(y){z=parseInt(y)||z}}return z},_getFocusIdx:function(C){var A=p.conf.arrform,z=p._getIdentityFromHash().substr(1),B=-1;for(var y=0;y<A.length;y++){if(A[y]===z){B=y;break}}if(B===-1){C.each(function(D,E){if($(E).hasClass("woo-cur")){B=D}})}B=B===-1?0:B;return B},_onscroll:function(){var C=k.scrollTop();if(!q&&!o){if(v[s]&&v[s].hasTouchedBottom()){v[s].doLazyAdd(),v[s].doLoadNext()}if(!n){p.conf.onScroll(C);if(u.length){var B=p.conf,y=p.$gopre,H=p.$gonext,D=u.find(B.frame[4]+":visible"),A=D.find(".woo-pbr").length,z=v[s]&&v[s].hasNextUpperPage;y.add(H).css("visibility",C>u.position().top&&(!A||A&&z)?"visible":"hidden")}}}if(p.conf.exrecycle&&a[s]){var F=a[s],G=a[s].$dom,E=G.position().top;F.exRecycleInvisibleUnits(C,E,1,4,-1);F.exRecycleInvisibleUnits(C,E,0,3,1)}j.clearTimeout(h),h=j.setTimeout(p._onscroll,100)},_doLoadImage:function(y){y.find("img[srcd]").each(function(A,C){var z=$(C),B=z.attr("srcd");if(B){z.css("display","none").one("load",function(){$(this).css({visibility:"visible"}).fadeIn(400)}).one("error",function(){var D=$(this);j.setTimeout(function(){D.one("error",function(){D.attr("src",B)}).attr("src",B)},1000)}).attr("src",B).removeAttr("srcd")}})},_getDataColY:function(y){var z=y.data("colY");return z}});p.Pagine=function(z,y){this.init(z,y)};p.Pagine.prototype={init:function(F,A){this.config=$.extend({},A);var E=this,D=E.config,y=D.currentUpperPage,z=D.subPageNum,C;E.hasNextUpperPage=true,E.caching=D.caching,E.$data=D.$data||$(null),E.idata=[],E.$dom=F[0],E.$pager=F[1],E.unitsPerSub=D.unitsPerSub,E.totalPageNum=D.totalPageNum,E.currentUpperPage=y,E.currentPage=(y-1)*z+1,E.$loadingsm=$('<div id="woo-loading" class="woo-loading"></div>');var B=D.arrRequestUrl;if($.type(B[0])==="object"&&B[0].tagName.toLowerCase()==="form"){E.arrurl=B}if(!E.$dom.find(":first-child").length){E.clearCont=false,E.loadPage(E.currentPage,1)}else{if(y>1){E.clearCont=true,E.loadPage(E.currentPage,1)}else{E.setPager()}}},loadPage:function(G,y,C){if(this.loading){this.scrollLoading=false;return}var E=this,F=E.config,B=F.subPageNum,z=y&&(G%B===1||B==1),D=false,A;!y&&p.scrollToAnchor(),E.$pager.css("display","none"),E.pagerVisible=false,E.loading=true,E.currentUpperPage=G;if(B>1&&!y){G=(G-1)*B+1}else{if(B>1&&y){E.currentUpperPage=Math.floor((G-0.1)/B)+1}}if((!y||z)&&E.clearCont){E.changeHashOnFirstLoad(F.identity,E.currentUpperPage);c=true,D=true,E.$dom.empty()}E.isPagerClick=false;E._requestData(G,y,C,false,D)},getPageNum:function(){return this.currentUpperPage},gotoPage:function(y){var z=this;z.clearCont=true,z.loadPage(y,false,true)},refreshPage:function(A){var z=this,y=A||z.currentUpperPage;z.$data=$(null),z.idata=[],z.caching=0,z.halting=true,z.loading=false,z.gotoPage(y)},slidePage:function(y,B){var A=this,z=A.currentUpperPage;A.clearCont=true,A.loadPage(z+y,false,B)},slideSubPage:function(y){var A=this,z=A.currentPage;A.clearCont=true,A.loadPage(z+y,1)},jumpPage:function(){var z=this,y=z.$pager.find("[type=text]").val()||0;if(y){z.clearCont=true,z.loadPage(y)}},prepareNext:function(){var z=this,y=z.currentPage;if(!z.prepare||z.prepare[0]!==y+1){z._requestData(y+1,true,false,true)}},requestOver:function(I,y,J,K,E){var F=this,H=F.config,A=!F.$dom.find(":first-child").length,D=H.subPageNum,z=I%D===1,C;F.hasNoMore=!K,F.currentPage=I,F.caching=2;if(E){F.totalPageNum=Math.ceil(E/H.unitsPerSub)}if(A){F.loading=true}var B=H.nextMode,M=F.currentPage,G=F.currentUpperPage||M,N=F.totalPageNum,L=F.$loadingsm,C;F.$dom.removeClass("woo-loading");if(!F.isLastSub()){L.css("visibility","hidden")}if(B||M===N){if(K){F.totalPageNum=M+1}else{F.totalPageNum=M}}else{if(!B){if(!K){F.totalPageNum=M}else{if(M>N){F.totalPageNum=M+1}}}}F.loadFromJson(J,A);if(!y||z||F.isLastSub()){F.setPager()}if(F.caching){F.$pager.css({display:"block",height:0,overflow:"hidden"})}else{if(F.isLastSub()){F.$pager.css({display:"block",height:"auto"})}}F.pagerVisible=true},loadFromJson:function(z,y){var B=this,A=B.config;B.idata=B.idata.concat(z);A.lazyAdd.call(B,y)},_requestAlways:function(){var z=this,y=z.config;z.loading=false,z.$dom.removeClass("woo-loading"),z.$loadingsm.css("visibility","hidden");$.isFunction(y.requestAlways)&&y.requestAlways(z,s)},_beforeRequest:function(A){var z=this,y=z.$loadingsm;z.$pager.after(y),p.$footer.css("display","none");if(A){z.$dom.addClass("woo-loading"),y.css("visibility","hidden"),w&&w.reset&&w.reset(),z.idata=[],z.$data=$(null);if(h){j.clearTimeout(h)}p._onscroll()}else{y.css("visibility","visible")}},_requestData:function(G,y,C,H,D){var E=this,F=E.config,B=F.subPageNum,z=E.arrurl,A;if(z){!H&&E._beforeRequest(D);if(E.prepare&&E.prepare[0]==G){w&&w.setUnitsFromLatest&&w.setUnitsFromLatest(),E.requestOver(G,y,E.prepare[1],E.prepare[2],E.prepare[3]),E.prepare=null,j.setTimeout(function(){E._requestAlways()},50);E.scrollLoading=false}else{var I=$(z[0]);$.ajax({type:"GET",dataType:F.ajaxDataType,cache:typeof DEBUG!=="undefined"&&DEBUG?false:!!F.ajaxCache,url:typeof DEBUG!=="undefined"&&DEBUG?"?page="+G:p.getFormAction(I)+G+z[1],data:p.paramForm(I),timeout:20000,success:function(K){typeof DEBUG!=="undefined"&&DEBUG&&(K=DEBUG_DATA[Math.floor((DEBUG_DATA.length-1)*Math.random())]);if(E.halting&&!C){return}if(C){E.halting=false,E.$dom.empty()}w&&w.resetLatestUnits&&w.resetLatestUnits();var L=F.analyzeResponse(K);if(H){E.prepare=[G,L[0],L[1],L[2]];var J=[];$(L[0]).find("img[srcd]").each(function(N,O){var M=$(O);J.push(M.attr("srcd"))});p.recurseDo(function(M){new Image().src=M.splice(0,1);return[M]},[J],J.length,200)}else{E.requestOver(G,y,L[0],L[1],L[2])}E.scrollLoading=false;E._requestAlways()},error:function(K,J){if(!H){$('<div id="woo-retry" style="text-align:center;padding:12px 0 0;height:28px">网络繁忙，<a href="javascript:;">点此重试~</a></div>').click(function(L){L.stopPropagation(),L.preventDefault(),E._requestData(G,y),$(this).remove();E.$loadingsm.css("display","block")}).insertAfter(E.$dom);E.$loadingsm.css("display","none")}E._requestAlways()}})}}},hasNextUpperPage:function(){var y=this;return y.hasNextUpperPage},isLastSub:function(){var y=this;return y.currentPage%y.config.subPageNum===0||y.currentPage===y.totalPageNum},showFooter:function(){var y=this;y.$pager.css({height:"auto"}),p.$footer.css("display","block"),y.$loadingsm.remove();j.clearTimeout(g);g=j.setTimeout(function(){if(y.isLastSub()&&y.$data.length===0&&y.idata.length===0){o=true;if(!p.conf.exrecycle){j.clearTimeout(h)}}},200);y.config.onOnePageOver(y,s)},setPager:function(){var B=this,C=B.config,F=B.currentUpperPage,E=C.nearbyPageNum,D=B.totalPageNum,A=C.subPageNum,y="",z;D=Math.floor((D-0.1)/A)+1;if((C.nextMode&&F>=D||!C.nextMode&&F>=D)&&B.hasNoMore){B.hasNextUpperPage=false}if(B.isLastSub()){y=['<div class="woo-pbr woo-mpbr"><ul class="woo-dib">',F==1?"":'<li><a class="woo-pre" href="javascript:;" pdir="-1" >上一页</a></li>',F==1?'<li class="woo-cur">1</li>':'<li><a href="javascript:;">1</a></li>',F-E>2?'<li class="woo-ell" >…</li>':"",(function(){var I="";for(var H=F-E;H<=F+E;H++){if(H==F&&H!=1){I+='<li class="woo-cur">'+H+"</li>"}else{if(H>1&&H<=D){I+='<li><a href="javascript:;">'+H+"</a></li>"}}}return I})(),F+E<D-1&&!C.nextMode?'<li class="woo-ell" >…</li>':"",F+E<D&&!C.nextMode?'<li><a href="javascript:;">'+D+"</a></li>":"",F==D?"":(C.nextMode?'<li class="woo-ell" >…</li>':"")+'<li><a class="woo-nxt" href="javascript:;"  pdir="1">下一页</a></li>',"</ul></div>"].join("");B.$pager.find(".woo-mpbr").remove(),B.$pager.append(y)}else{B.$pager.find(".woo-mpbr").remove(),B.$pager.append(y)}B.addEventOnPagerClick();var G=p.$gonext;G.css("display","block");if(B.$pager.find(".woo-pbr").length){G.css("visibility",B.hasNextUpperPage?"visible":"hidden")}B.pagerVisible=true,B.doLazyAdd()},changeHashOnFirstLoad:function(z,y){var C=this,A=z+(y>1?"-p"+y:""),B=m.getHash();if((B||C.isPagerClick)&&B!==A){m.setHash(A)}},_pagerClick:function(B){var C=B.data.pager,A=B.target;if(A&&A.tagName&&A.tagName.toLowerCase()!="a"){A=$(A).closest("a")[0]}if(C.$pager&&A&&A.tagName&&A.tagName.toLowerCase()==="a"&&!$(A).closest(".woo-nopagine",C.$pager.get(0)).length){B.preventDefault();B.stopPropagation();var y=parseInt(A.innerHTML),z=A.getAttribute("pdir");C.isPagerClick=true;if(y){C.gotoPage(y)}else{if(z==="jump"){C.jumpPage()}else{if(z==="sub"){C.slideSubPage(1)}else{if(z=parseInt(z)){C.slidePage(z)}}}}}},addEventOnPagerClick:function(){var y=this;y.$pager.unbind("click.woo").bind("click.woo",{pager:y},y._pagerClick)},hasTouchedBottom:function(y){var E=this,D=E.config,y=y===f?k.scrollTop():y,A=p._getDataColY(E.$dom),C=E.$dom.offset().top+(parseInt(E.$dom.get(0).style.height)||0)-y-d,B=Math.max.apply(Math,A),z=Math.min.apply(Math,A);return(C<D.scrollBias||C<B-z)},doLazyAdd:function(){var z=this,y=z.config;if(!z.lazyAdding&&z.pagerVisible&&z.caching){y.lazyAdd.call(z)}},doLoadNext:function(){var z=this,y=z.config;if(!z.lazyAdding&&!z.halting&&!z.scrollLoading&&z.pagerVisible&&(z.caching<2||!z.caching)&&!z.isLastSub()){z.scrollLoading=true,z.slideSubPage(1)}}};p.Masn=function(z,y){this.init(z,y)};p.Masn.prototype={init:function(z,y){this.opts=$.extend({},y);var A=this;A.$dom=$(z),A.domInitWidth=A.$dom.data("domwidth")||"auto",A.figure(),A.arrangeContents(),A.opts.onFirstArrange(s)},figure:function(){var B=this,A=B.$dom,C=B.opts,z=0,y=$("<div>");A.css({position:"relative"});B.colwf=B.colw=C.columnWidth;if(C.firstColumnWidth){B.colwf=C.firstColumnWidth}B.setCols(),B.clearColY();A.prepend(y),B.offset0=y.offset(),B.domtop0=A.offset().top,B.left0=Math.round(y.position().left),y.remove();if(C.firstHeight){B.firstWidth=B.colwf,B.firstHeight=C.firstHeight}},clearColY:function(){var A=this,y=[];A.unitCount=0;A.standardUnitCount=0;if(p.conf.exrecycle){A.arrColumnTail=[],A.posCoordination={},A.columnVisibleRange=[[],[]],A.unitCache={};for(var z=0;z<A.colCount;z++){A.columnVisibleRange[0][z]=A.columnVisibleRange[1][z]=z,y[z]=0}}else{for(var z=0;z<A.colCount;z++){y[z]=0}}A.$dom.data("colY",y)},exIsUnitVisible:function(E,H,z,G){var y=p.conf.exrecycletop,K=p.conf.exrecyclebot,J=y>-10&&y<10?y*d:y,A=K>-10&&K<10?K*d:K,D=-1,C=H+z+G,B=H+z,I=E-J,F=E+d+A;if(C>=I&&B<=F){D=0}else{if(C<I){D=1}}return D},exRecycleInvisibleUnits:function(E,H,z,A,J){var I=this,F=0,y=0,C;for(var D=0;D<I.colCount;D++){C=I.columnVisibleRange[1&z][D];y=I.columnVisibleRange[1^z][D];while(0<=F&&F<I.unitCount){F=C;var B=I.posCoordination[""+F];if(B===f){break}var G=I.exIsUnitVisible(E,H,B[0],B[1]);if(G==J){break}if(G===0&&!B[5]){I.unitCache[""+F]&&I.unitCache[""+F].appendTo(I.$dom);B[5]=1}I.columnVisibleRange[1&z][D]=F;if(B[A]==-1||B[A]==F){break}C=B[A]}while(0<=y&&y<I.unitCount){var B=I.posCoordination[""+y];if(B===f){break}var G=I.exIsUnitVisible(E,H,B[0],B[1]);if(G==0||G==J){break}if(B[5]){I.unitCache[""+y]&&I.unitCache[""+y].remove();B[5]=0}if(B[A]==-1){I.columnVisibleRange[1&z][D]=I.columnVisibleRange[1^z][D];break}else{if(B[A]==y){break}}y=I.columnVisibleRange[1^z][D]=B[A]}}},setContHeight:function(){var z=this,y=p._getDataColY(z.$dom);z.$dom.css({height:Math.max.apply(Math,y.concat(d-z.domtop0))}).data("colY",y)},setCols:function(){var C=this,D=C.opts,y=C.$dom,A=D.columnMessWidth||0,B=A?D.columnMargin:0,z;C.resetDomWidth(),z=C.domWidth,C.colCount=Math.max(Math.floor((z+D.columnMargin-C.colwf+C.colw-A)/C.colw),1),C.domWidth=C.colCount*C.colw+C.colwf-C.colw-D.columnMargin+A-B,y.css("width",C.domWidth)},resetDomWidth:function(){var z=this,y=z.$dom;y.css("width",z.domInitWidth),z.domWidth=z.domInitWidth==="auto"?y.parent().width():z.domInitWidth},arrangeContents:function(B){var E=this,z=E.$dom,F=E.opts,D=F.initAppendCounts,A,y;A=z.children().filter(F.unit),y=A.length;if(y){B&&(D=y);var C=A.slice(0,D);A=A.slice(D).addClass("woo-wait"),E.appendContents(C,null,true,B,!!F.firstHeight,D,$.noop),F.onAppend(C)}z.css("visibility","visible");if($.isFunction(F.onArrange)){F.onArrange(A)}},appendContents:function(B,K,E,z,M,N,I){var H=this,F=H.opts,y=H.$dom,G=p._getDataColY(y),N=N||F.batchNum,J,A;var D=H._placeEachUnit(H,F,y,B,K,E,z,M&&H.firstHeight),C=D[0],L=D[1];if(!E){C.appendTo(y);if(F.batchOpen){p.recurseDo(function(P,Q){var O=0;if(p.conf.exrecycle){P.each(function(R,T){var S=P.eq(R);H.unitCache[""+S.data("idx")]=S;O++;$(T).append(Q.eq(R).children())})}else{P.each(function(R,S){O++;$(S).append(Q.eq(R).children())})}F.onAppend(P),P=P.slice(N),Q=Q.slice(O),H.setContHeight();return[P,Q]},[C,L],Math.ceil(C.length/N),F.batchDelay,function(){I()})}else{if(p.conf.exrecycle){C.each(function(O,Q){var P=C.eq(O);H.unitCache[""+P.data("idx")]=P;$(Q).append(L.eq(O).children())})}else{C.each(function(O,P){$(P).append(L.eq(O).children())})}H.setContHeight(),F.onAppend(C),I()}}else{if(p.conf.exrecycle){L.each(function(O,Q){var P=L.eq(O);H.unitCache[""+P.data("idx")]=P})}F.onAppend(L);H.setContHeight()}},prePlaceUnit:function(z,J,D,A,E){var I=this,G=I.opts,F=D,C,K,B,H,y;C=Math.min.apply(Math,J);while(F--){if(J[F]==C){K=F}}if(I.colwf!=I.colw&&(K===0&&!G.rightAlignFirstBlock||K===D-1&&G.rightAlignFirstBlock)){y=I.colwf;!E&&(z.addClass("woo-spcol"))}if(A&&G.specialColumnOpen){z.removeData("ht").removeAttr("data-ht")}B=I.colw*K+I.left0+(!G.rightAlignFirstBlock&&K&&I.colwf!=I.colw?I.colwf-I.colw:0),H=E?I.firstHeight:z.data("ht")||(z.outerHeight?z.outerHeight(true):(z.height()+(parseInt(z.css("margin-top"))||0)+(parseInt(z.css("margin-bottom"))||0))),J[K]+=H+G.gap;return[C,K,B,H,y]},_placeEachUnit:function(M,T,B,D,A,Z,V,R){var aa=B.prev(),H=!!aa.length,J="",N=$(null),y=p._getDataColY(B),P=M.colCount,z,S,F,E,X,L,O=0,K,Q=V&&R,G;if(!H||H&&!aa.hasClass("woo-tmpmasn")){var I=p.conf.frame,C=(I[3].indexOf(0)=="."?I[3].substr(1):"")+" "+(I[5].indexOf(0)=="."?I[5].substr(1):"")+" woo-loading";aa=$('<div class="woo-tmpmasn '+B.attr("class")+'" style="position:relative;height:0;overflow:hidden;margin:0;padding:0;"></div>').removeClass(C),B.before(aa)}var U=D.add(A).removeClass("woo-wait"),Y=Z?U.parent():aa.append(U);N=Y.find(T.unit).not(".woo-f,.woo-wait").each(function(ac,ad){var ab=$(ad),ae=ab.data("id");if((ac===0&&R&&!T.rightAlignFirstBlock||ac===P-1&&R&&T.rightAlignFirstBlock)){z=M.prePlaceUnit(ab,y,P,V,R);S=z[0],F=z[1],E=z[2],X=z[3],L=z[4],K='<div class="woo woo-f co'+F+" "+(L?"woo-spcol":"")+'" data-ht="'+X+'" data-idx="'+M.unitCount+'" style="position:absolute;overflow:hidden;top:'+S+"px;left:"+E+"px;width:"+(M.firstWidth-T.columnMargin)+'px;"></div>',J+=K;if(Q){G=Y.find(".woo-f:first").css({left:E,top:S})}else{G=$(K).append(T.sinkWhat)}G.data("idx",M.unitCount);O=ac;if(p.conf.exrecycle){M.exCoordMap(S,X,F)}M.unitCount++}z=M.prePlaceUnit(ab,y,P,V);S=z[0],F=z[1],E=z[2],X=z[3],L=z[4],J+='<div class="'+T.unit.substr(1)+" co"+F+(L?" woo-spcol":"")+'" '+(ae?'data-id="'+ae+'"':"")+' data-ht="'+X+'" data-idx="'+M.unitCount+'" style="top:'+S+"px;left:"+E+'px;"></div>';ab.css({top:S,left:E}).data("ht",X).data("idx",M.unitCount);ab.removeClass(function(ag,af){return"woo-spcol "+(af.match(/co\d+/ig)||[]).join(" ")}).addClass((L?"woo-spcol ":"")+"co"+F);if(p.conf.exrecycle){M.exCoordMap(S,X,F)}M.unitCount++;M.standardUnitCount++});B.data("colY",y);if(!Q&&R){var W=N.toArray();N=$(W.slice(0,O).concat(G?G.toArray():[],W.slice(O)))}aa.empty();return[$(J),N]},exCoordMap:function(C,z,y){var D=this,B=D.arrColumnTail[y]||y;D.posCoordination[""+D.unitCount]=[C,z,y,B,-1,0],D.posCoordination[""+B]&&(D.posCoordination[""+B][4]=D.unitCount),D.arrColumnTail[y]=D.unitCount;var A=D.unitCount;j.setTimeout(function(){D.posCoordination[""+A][5]=1},800)}};$.Woo=p})(window);var _gaq=_gaq||[];_gaq.push(["_setAccount","UA-19056403-7"]);_gaq.push(["_setDomainName","duitang.com"]);_gaq.push(["_trackPageview"]);(function(){var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a)})();